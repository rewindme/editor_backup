var __hasProp = ({}).hasOwnProperty,
    __extends = function __extends(child, parent) {
	for (var key in parent) {
		if (__hasProp.call(parent, key)) child[key] = parent[key];
	}function ctor() {
		this.constructor = child;
	}ctor.prototype = parent.prototype;child.prototype = new ctor();child.__super__ = parent.prototype;return child;
},
    FS = require('fs-plus'),
    Path = require('path'),
    events = require('events'),
    FTP,
    SFTP,
    Directory = require('./directory');

module.exports = (function () {

	__extends(Client, events.EventEmitter);

	function Client() {
		this.info = null;
		this.connector = null;
		this._current = null;
		this._queue = [];

		this.root = new Directory({
			name: '/',
			path: '/',
			client: this,
			isExpanded: true
		});
	}

	__extends(Progress, events.EventEmitter);

	function Progress() {
		this.progress = -1;
		this._start = 0;
	}

	Progress.prototype.setProgress = function (progress) {
		progress = parseFloat(progress) || -1;

		if (this.progress == -1 && progress > -1) this._start = new Date().getTime();

		this.progress = progress;
		this.emit('progress', this.progress);

		if (this.progress == 1) this.emit('done');
	};

	Progress.prototype.isDone = function () {
		return this.progress >= 1;
	};

	Progress.prototype.getEta = function () {
		if (this.progress == -1) return Infinity;
		var now = new Date().getTime(),
		    elapse = now - this._start,
		    remaining = elapse * 1 / this.progress;
		//return 1 * delta / this.progress;
		return remaining - elapse;
	};

	Client.prototype.readConfig = function (callback) {
		var self = this;

		function e(err) {
			if (typeof callback === 'function') callback.apply(self, [err]);
		}

		FS.readFile(atom.project.getDirectories()[0].resolve('.ftpconfig'), 'utf8', function (err, data) {
			if (err) return e(err);

			var json;
			try {
				json = JSON.parse(data);
			} catch (err) {
				throw 'Parse error in `.ftpconfig` JSON : ' + err;
				//return e('Parse error in .ftpconfg\'s JSON :\n  '+ err);
			}

			self.info = json;
			self.root.name = '';
			self.root.path = '/' + self.info.remote.replace(/^\/+/, '');

			if (typeof callback === 'function') callback.apply(self, [err, json]);
		});
	};

	Client.prototype.isConnected = function (onconnect) {
		return this.connector && this.connector.isConnected();
	};

	Client.prototype.onceConnected = function (onconnect) {
		var self = this;
		if (self.connector && self.connector.isConnected()) {
			onconnect.apply(self);
			return true;
		} else if (typeof onconnect === 'function') {
			self.readConfig(function () {
				self.connect(true);
			});
			self.removeListener('connected', onconnect);
			self.once('connected', onconnect);
			return false;
		}
	};

	Client.prototype.connect = function (reconnect) {
		var self = this;

		if (reconnect !== true) self.disconnect();

		if (self.isConnected()) return;

		if (!self.info) return;

		atom.notifications.addInfo('Remote FTP: Connecting...');

		var info;
		switch (self.info.protocol) {
			case 'ftp':
				info = {
					host: self.info.host || '',
					port: self.info.port || 21,
					user: self.info.user || '',
					password: self.info.pass || '',
					secure: self.info.secure || '',
					secureOptions: self.info.secureOptions || '',
					connTimeout: self.info.timeout || 10000,
					pasvTimeout: self.info.timeout || 10000,
					keepalive: self.info.keepalive || 10000,
					debug: function debug(str) {
						var log = str.match(/^\[connection\] (>|<) '(.*?)(\\r\\n)?'$/);
						if (!log) return;
						if (log[2].match(/^PASS /)) log[2] = 'PASS ******';
						self.emit('debug', log[1] + ' ' + log[2]);
						console.debug(log[1] + ' ' + log[2]);
					}
				};
				if (!FTP) FTP = require('./connectors/ftp');
				self.connector = new FTP(self);
				break;
			case 'sftp':
				info = {
					host: self.info.host || '',
					port: self.info.port || 21,
					username: self.info.user || '',
					readyTimeout: self.info.connTimeout || 10000,
					pingInterval: self.info.keepalive || 10000
				};
				if (self.info.pass) info.password = self.info.pass;

				var pk;
				if (self.info.privatekey && (pk = FS.readFileSync(self.info.privatekey))) info.privateKey = pk;

				if (self.info.passphrase) info.passphrase = self.info.passphrase;

				if (self.info.agent) info.agent = self.info.agent;

				if (self.info.agent == 'env') info.agent = process.env.SSH_AUTH_SOCK;

				if (self.info.hosthash) info.hostHash = self.info.hosthash;

				if (self.info.ignorehost) info.hostVerifier = function () {
					return true;
				};

				if (self.info.keyboardInteractive) info.tryKeyboard = true;

				info.debug = function (str) {};

				if (!SFTP) SFTP = require('./connectors/sftp');
				self.connector = new SFTP(self);
				break;
			default:
				throw 'No `protocol` found in connection credential. Please recreate .ftpconfig file from Packages -> Remote-FTP -> Create (S)FTP config file.';
		}

		self.connector.connect(info, function () {
			if (self.root.status != 1) self.root.open();
			self.emit('connected');

			atom.notifications.addSuccess('Remote FTP: Connected');
		});

		//self.connector.on('greeting', function () {
		//	self.emit('greeting');
		//});
		self.connector.on('closed', function () {
			self.disconnect();
			self.emit('closed');

			atom.notifications.addInfo('Remote FTP: Connection closed');
		});
		self.connector.on('ended', function () {
			self.emit('ended');
		});
		self.connector.on('error', function (err) {
			//self.emit('error', err);
			//console.error(err);

			atom.notifications.addError('Remote FTP: ' + err);
		});
	};

	Client.prototype.disconnect = function () {
		var self = this;

		if (self.connector) {
			self.connector.disconnect();
			delete self.connector;
			self.connector = null;
		}

		if (self.root) {
			self.root.status = 0;
			self.root.destroy();
			//self.root = null;
		}

		self._current = null;
		self._queue = [];

		self.emit('disconnected');

		return self;
	};

	Client.prototype.toRemote = function (local) {
		var self = this;

		return Path.join(self.info.remote, atom.project.relativize(local)).replace(/\\/g, '/');
	};

	Client.prototype.toLocal = function (remote) {
		var self = this;

		return atom.project.getDirectories()[0].resolve('./' + remote.substr(self.info.remote.length).replace(/^\/+/, ''));
	};

	Client.prototype._next = function () {
		var self = this;

		if (!self.isConnected()) return;

		self._current = self._queue.shift();
		if (self._current) self._current[1].apply(self, [self._current[2]]);

		atom.project.remoteftp.emit('queue-changed');
	};

	Client.prototype._enqueue = function (func, desc) {
		var self = this,
		    progress = new Progress();

		self._queue.push([desc, func, progress]);
		if (self._queue.length == 1 && !self._current) self._next();else self.emit('queue-changed');

		return progress;
	};

	Client.prototype.abort = function () {
		var self = this;

		if (self.isConnected()) self.connector.abort(function () {
			self._next();
		});

		return self;
	};

	Client.prototype.abortAll = function () {
		var self = this;

		self._current = null;
		self._queue = [];

		if (self.isConnected()) self.connector.abort();

		self.emit('queue-changed');

		return self;
	};

	Client.prototype.list = function (remote, recursive, callback) {
		var self = this;

		//if (self.isConnected()) {
		self.onceConnected(function () {
			self._enqueue(function () {
				self.connector.list(remote, recursive, function () {
					if (typeof callback === 'function') callback.apply(null, arguments);
					self._next();
				});
			}, 'Listing ' + (recursive ? 'recursively ' : '') + Path.basename(remote));
		});

		return self;
	};

	Client.prototype.download = function (remote, recursive, callback) {
		var self = this;

		//if (self.isConnected()) {
		self.onceConnected(function () {
			self._enqueue(function (progress) {
				self.connector.get(remote, recursive, function () {
					if (typeof callback === 'function') callback.apply(null, arguments);
					self._next();
				}, function (percent) {
					progress.setProgress(percent);
				});
			}, 'Downloading ' + Path.basename(remote));
		});

		return self;
	};

	Client.prototype.upload = function (local, callback) {
		var self = this;

		//if (self.isConnected()) {
		self.onceConnected(function () {
			self._enqueue(function (progress) {
				self.connector.put(local, function () {
					if (typeof callback === 'function') callback.apply(null, arguments);
					self._next();
				}, function (percent) {
					progress.setProgress(percent);
				});
			}, 'Uploading ' + Path.basename(local));
		});

		return self;
	};

	Client.prototype._traverseTree = function (path, callback) {
		var list = [],
		    digg = 0;

		var e = function e() {
			list.forEach(function (item) {
				item.depth = item.name.split('/').length;
			});
			list.sort(function (a, b) {
				if (a.depth == b.depth) return 0;
				return a.depth > b.depth ? 1 : -1;
			});

			if (typeof callback === 'function') callback.apply(null, [list]);
		};
		var l = function l(p) {
			++digg;
			FS.readdir(p, function (err, lis) {
				if (err) return e();

				lis.forEach(function (name) {
					if (name == '.' || name == '..') return;

					name = Path.join(p, name);
					var stats = FS.statSync(name);
					list.push({
						name: name,
						size: stats.size,
						date: stats.mtime,
						type: stats.isFile() ? 'f' : 'd'
					});
					if (!stats.isFile()) {
						l(name);
					}
				});
				if (--digg == 0) return e();
			});
		};
		l(path);
	};

	Client.prototype.syncRemoteLocal = function (remote, callback) {
		var self = this;

		self.onceConnected(function () {
			self._enqueue(function (progress) {

				var local = self.toLocal(remote);

				self.connector.list(remote, true, function (err, remotes) {
					if (err) {
						if (typeof callback === 'function') callback.apply(null, [err]);
						return;
					}

					self._traverseTree(local, function (locals) {

						var e = function e() {
							if (typeof callback === 'function') callback.apply(null);
							self._next();
							return;
						};
						var n = function n() {
							var _again = true;

							_function: while (_again) {
								remote = toLocal = local = a = b = undefined;
								_again = false;

								var remote = remotes.shift();
								if (!remote) {
									return e();
								}

								if (remote.type == 'd') {
									_again = true;
									continue _function;
								}

								var toLocal = self.toLocal(remote.name),
								    local = null;

								for (var a = 0, b = locals.length; a < b; ++a) {
									if (locals[a].name == toLocal) {
										local = locals[a];
										break;
									}
								}

								// Download only if not present on local or size differ
								if (!local || remote.size != local.size) {
									self.connector.get(remote.name, false, function () {
										return n();
									});
								} else {
									n();
								}
							}
						};
						n();
					});
				});
			}, 'Sync local ' + Path.basename(remote));
		});

		return self;
	};

	Client.prototype.syncLocalRemote = function (local, callback) {
		var self = this;

		self.onceConnected(function () {
			self._enqueue(function (progress) {

				var remote = self.toRemote(local);
				self.connector.list(remote, true, function (err, remotes) {
					if (err) {
						if (typeof callback === 'function') callback.apply(null, [err]);
						return;
					}

					self._traverseTree(local, function (locals) {

						var e = function e() {
							if (typeof callback === 'function') callback.apply(null);
							self._next();
							return;
						};
						var n = function n() {
							var _again2 = true;

							_function2: while (_again2) {
								local = toRemote = remote = a = b = undefined;
								_again2 = false;

								var local = locals.shift();
								if (!local) {
									return e();
								}

								if (local.type == 'd') {
									_again2 = true;
									continue _function2;
								}

								var toRemote = self.toRemote(local.name),
								    remote = null;

								for (var a = 0, b = remotes.length; a < b; ++a) {
									if (remotes[a].name == toRemote) {
										remote = remotes[a];
										break;
									}
								}

								// Upload only if not present on remote or size differ
								if (!remote || remote.size != local.size) {
									self.connector.put(local.name, function () {
										return n();
									});
								} else {
									n();
								}
							}
						};
						n();
					});
				});
			}, 'Sync remote ' + Path.basename(local));
		});

		return self;
	};

	Client.prototype.mkdir = function (remote, recursive, callback) {
		var self = this;

		//if (self.isConnected()) {
		self.onceConnected(function () {
			self._enqueue(function () {
				self.connector.mkdir(remote, recursive, function () {
					if (typeof callback === 'function') callback.apply(null, arguments);
					self._next();
				});
			}, 'Creating folder ' + Path.basename(remote));
		});

		return self;
	};

	Client.prototype.mkfile = function (remote, callback) {
		var self = this;

		//if (self.isConnected()) {
		self.onceConnected(function () {
			self._enqueue(function () {
				self.connector.mkfile(remote, function () {
					if (typeof callback === 'function') callback.apply(null, arguments);
					self._next();
				});
			}, 'Creating file ' + Path.basename(remote));
		});

		return self;
	};

	Client.prototype.rename = function (source, dest, callback) {
		var self = this;

		//if (self.isConnected()) {
		self.onceConnected(function () {
			self._enqueue(function () {
				self.connector.rename(source, dest, function () {
					if (typeof callback === 'function') callback.apply(null, arguments);
					self._next();
				});
			}, 'Renaming ' + Path.basename(source));
		});

		return self;
	};

	Client.prototype['delete'] = function (remote, callback) {
		var self = this;

		//if (self.isConnected()) {
		self.onceConnected(function () {
			self._enqueue(function () {
				self.connector['delete'](remote, function () {
					if (typeof callback === 'function') callback.apply(null, arguments);
					self._next();
				});
			}, 'Deleting ' + Path.basename(remote));
		});

		return self;
	};

	return Client;
})();

/*var log = str.match(/^\[connection\] (>|<) '(.*?)(\\r\\n)?'$/);
if (!log) return;
if (log[2].match(/^PASS /))
	log[2] = 'PASS ******';
self.emit('debug', log[1] +' '+ log[2]);
console.debug(log[1] +' '+ log[2]);*/
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9uYXZlci8uYXRvbS9wYWNrYWdlcy9yZW1vdGUtZnRwL2xpYi9jbGllbnQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSSxTQUFTLEdBQUcsQ0FBQSxHQUFFLENBQUMsY0FBYztJQUNoQyxTQUFTLEdBQUcsU0FBWixTQUFTLENBQVksS0FBSyxFQUFFLE1BQU0sRUFBRTtBQUFFLE1BQUssSUFBSSxHQUFHLElBQUksTUFBTSxFQUFFO0FBQUUsTUFBSSxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsRUFBRSxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0VBQUUsQUFBQyxTQUFTLElBQUksR0FBRztBQUFFLE1BQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDO0VBQUUsQUFBQyxJQUFJLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQUFBQyxLQUFLLENBQUMsU0FBUyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsQUFBQyxLQUFLLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQUFBQyxPQUFPLEtBQUssQ0FBQztDQUFFO0lBQy9SLEVBQUUsR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDO0lBQ3ZCLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDO0lBQ3RCLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDO0lBQzFCLEdBQUc7SUFDSCxJQUFJO0lBQ0osU0FBUyxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQzs7QUFFcEMsTUFBTSxDQUFDLE9BQU8sR0FBRyxDQUFDLFlBQVk7O0FBRTdCLFVBQVMsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDOztBQUV2QyxVQUFTLE1BQU0sR0FBSTtBQUNsQixNQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztBQUNqQixNQUFJLENBQUMsU0FBUyxHQUFH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Q0FBQyxDQUFDO0dBQ3ZDLENBQUMsQ0FBQzs7QUFFSCxTQUFPLElBQUksQ0FBQztFQUNaLENBQUE7O0FBRUQsUUFBTyxNQUFNLENBQUM7Q0FDZCxDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiIvVXNlcnMvbmF2ZXIvLmF0b20vcGFja2FnZXMvcmVtb3RlLWZ0cC9saWIvY2xpZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuXHRfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfSxcblx0RlMgPSByZXF1aXJlKCdmcy1wbHVzJyksXG5cdFBhdGggPSByZXF1aXJlKCdwYXRoJyksXG5cdGV2ZW50cyA9IHJlcXVpcmUoJ2V2ZW50cycpLFxuXHRGVFAsXG5cdFNGVFAsXG5cdERpcmVjdG9yeSA9IHJlcXVpcmUoJy4vZGlyZWN0b3J5Jyk7XG5cbm1vZHVsZS5leHBvcnRzID0gKGZ1bmN0aW9uICgpIHtcblxuXHRfX2V4dGVuZHMoQ2xpZW50LCBldmVudHMuRXZlbnRFbWl0dGVyKTtcblxuXHRmdW5jdGlvbiBDbGllbnQgKCkge1xuXHRcdHRoaXMuaW5mbyA9IG51bGw7XG5cdFx0dGhpcy5jb25uZWN0b3IgPSBudWxsO1xuXHRcdHRoaXMuX2N1cnJlbnQgPSBudWxsO1xuXHRcdHRoaXMuX3F1ZXVlID0gW107XG5cblx0XHR0aGlzLnJvb3QgPSBuZXcgRGlyZWN0b3J5KHtcblx0XHRcdG5hbWU6ICcvJyxcblx0XHRcdHBhdGg6ICcvJyxcblx0XHRcdGNsaWVudDogdGhpcyxcblx0XHRcdGlzRXhwYW5kZWQ6IHRydWVcblx0XHR9KTtcblx0fVxuXG5cdF9fZXh0ZW5kcyhQcm9ncmVzcywgZXZlbnRzLkV2ZW50RW1pdHRlcik7XG5cblx0ZnVuY3Rpb24gUHJvZ3Jlc3MgKCkge1xuXHRcdHRoaXMucHJvZ3Jlc3MgPSAtMTtcblx0XHR0aGlzLl9zdGFydCA9IDA7XG5cdH1cblxuXHRQcm9ncmVzcy5wcm90b3R5cGUuc2V0UHJvZ3Jlc3MgPSBmdW5jdGlvbiAocHJvZ3Jlc3MpIHtcblx0XHRwcm9ncmVzcyA9IHBhcnNlRmxvYXQocHJvZ3Jlc3MpIHx8IC0xO1xuXG5cdFx0aWYgKHRoaXMucHJvZ3Jlc3MgPT0gLTEgJiYgcHJvZ3Jlc3MgPiAtMSlcblx0XHRcdHRoaXMuX3N0YXJ0ID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7XG5cblx0XHR0aGlzLnByb2dyZXNzID0gcHJvZ3Jlc3M7XG5cdFx0dGhpcy5lbWl0KCdwcm9ncmVzcycsIHRoaXMucHJvZ3Jlc3MpO1xuXG5cdFx0aWYgKHRoaXMucHJvZ3Jlc3MgPT0gMSlcblx0XHRcdHRoaXMuZW1pdCgnZG9uZScpO1xuXHR9XG5cblx0UHJvZ3Jlc3MucHJvdG90eXBlLmlzRG9uZSA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5wcm9ncmVzcyA+PSAxO1xuXHR9XG5cblx0UHJvZ3Jlc3MucHJvdG90eXBlLmdldEV0YSA9IGZ1bmN0aW9uICgpIHtcblx0XHRpZiAodGhpcy5wcm9ncmVzcyA9PSAtMSlcblx0XHRcdHJldHVybiBJbmZpbml0eTtcblx0XHR2YXIgbm93ID0gKG5ldyBEYXRlKS5nZXRUaW1lKCksXG5cdFx0XHRlbGFwc2UgPSBub3cgLSB0aGlzLl9zdGFydCxcblx0XHRcdHJlbWFpbmluZyA9IGVsYXBzZSAqIDEgLyB0aGlzLnByb2dyZXNzO1xuXHRcdC8vcmV0dXJuIDEgKiBkZWx0YSAvIHRoaXMucHJvZ3Jlc3M7XG5cdFx0cmV0dXJuIHJlbWFpbmluZyAtIGVsYXBzZTtcblx0fVxuXG5cdENsaWVudC5wcm90b3R5cGUucmVhZENvbmZpZyA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdGZ1bmN0aW9uIGUgKGVycikge1xuXHRcdFx0aWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0Y2FsbGJhY2suYXBwbHkoc2VsZiwgW2Vycl0pO1xuXHRcdH1cblxuXHRcdEZTLnJlYWRGaWxlKGF0b20ucHJvamVjdC5nZXREaXJlY3RvcmllcygpWzBdLnJlc29sdmUoJy5mdHBjb25maWcnKSwgJ3V0ZjgnLCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG5cdFx0XHRpZiAoZXJyKVxuXHRcdFx0XHRyZXR1cm4gZShlcnIpO1xuXG5cdFx0XHR2YXIganNvbjtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdGpzb24gPSBKU09OLnBhcnNlKGRhdGEpO1xuXHRcdFx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0XHRcdHRocm93IFwiUGFyc2UgZXJyb3IgaW4gYC5mdHBjb25maWdgIEpTT04gOiBcIiArIGVycjtcblx0XHRcdFx0Ly9yZXR1cm4gZSgnUGFyc2UgZXJyb3IgaW4gLmZ0cGNvbmZnXFwncyBKU09OIDpcXG4gICcrIGVycik7XG5cdFx0XHR9XG5cblx0XHRcdHNlbGYuaW5mbyA9IGpzb247XG5cdFx0XHRzZWxmLnJvb3QubmFtZSA9ICcnO1xuXHRcdFx0c2VsZi5yb290LnBhdGggPSAnLycgKyBzZWxmLmluZm8ucmVtb3RlLnJlcGxhY2UoL15cXC8rLywgJycpO1xuXG5cdFx0XHRpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRjYWxsYmFjay5hcHBseShzZWxmLCBbZXJyLCBqc29uXSk7XG5cdFx0fSk7XG5cdH1cblxuXHRDbGllbnQucHJvdG90eXBlLmlzQ29ubmVjdGVkID0gZnVuY3Rpb24gKG9uY29ubmVjdCkge1xuXHRcdHJldHVybiB0aGlzLmNvbm5lY3RvciAmJiB0aGlzLmNvbm5lY3Rvci5pc0Nvbm5lY3RlZCgpO1xuXHR9XG5cblx0Q2xpZW50LnByb3RvdHlwZS5vbmNlQ29ubmVjdGVkID0gZnVuY3Rpb24gKG9uY29ubmVjdCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblx0XHRpZiAoc2VsZi5jb25uZWN0b3IgJiYgc2VsZi5jb25uZWN0b3IuaXNDb25uZWN0ZWQoKSkge1xuXHRcdFx0b25jb25uZWN0LmFwcGx5KHNlbGYpO1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2Ygb25jb25uZWN0ID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHRzZWxmLnJlYWRDb25maWcoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRzZWxmLmNvbm5lY3QodHJ1ZSk7XG5cdFx0XHR9KTtcblx0XHRcdHNlbGYucmVtb3ZlTGlzdGVuZXIoJ2Nvbm5lY3RlZCcsIG9uY29ubmVjdCk7XG5cdFx0XHRzZWxmLm9uY2UoJ2Nvbm5lY3RlZCcsIG9uY29ubmVjdCk7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9XG5cblx0Q2xpZW50LnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gKHJlY29ubmVjdCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdGlmIChyZWNvbm5lY3QgIT09IHRydWUpXG5cdFx0XHRzZWxmLmRpc2Nvbm5lY3QoKTtcblxuXHRcdGlmIChzZWxmLmlzQ29ubmVjdGVkKCkpXG5cdFx0XHRyZXR1cm47XG5cblx0XHRpZiAoIXNlbGYuaW5mbylcblx0XHRcdHJldHVybjtcblxuXHRcdGF0b20ubm90aWZpY2F0aW9ucy5hZGRJbmZvKFwiUmVtb3RlIEZUUDogQ29ubmVjdGluZy4uLlwiKTtcblxuXHRcdHZhciBpbmZvO1xuXHRcdHN3aXRjaCAoc2VsZi5pbmZvLnByb3RvY29sKSB7XG5cdFx0XHRjYXNlICdmdHAnOlxuXHRcdFx0XHRpbmZvID0ge1xuXHRcdFx0XHRcdGhvc3Q6IHNlbGYuaW5mby5ob3N0IHx8ICcnLFxuXHRcdFx0XHRcdHBvcnQ6IHNlbGYuaW5mby5wb3J0IHx8IDIxLFxuXHRcdFx0XHRcdHVzZXI6IHNlbGYuaW5mby51c2VyIHx8ICcnLFxuXHRcdFx0XHRcdHBhc3N3b3JkOiBzZWxmLmluZm8ucGFzcyB8fCAnJyxcblx0XHRcdFx0XHRzZWN1cmU6IHNlbGYuaW5mby5zZWN1cmUgfHwgJycsXG5cdFx0XHRcdFx0c2VjdXJlT3B0aW9uczogc2VsZi5pbmZvLnNlY3VyZU9wdGlvbnMgfHwgJycsXG5cdFx0XHRcdFx0Y29ublRpbWVvdXQ6IHNlbGYuaW5mby50aW1lb3V0IHx8IDEwMDAwLFxuXHRcdFx0XHRcdHBhc3ZUaW1lb3V0OiBzZWxmLmluZm8udGltZW91dCB8fCAxMDAwMCxcblx0XHRcdFx0XHRrZWVwYWxpdmU6IHNlbGYuaW5mby5rZWVwYWxpdmUgfHwgMTAwMDAsXG5cdFx0XHRcdFx0ZGVidWc6IGZ1bmN0aW9uIChzdHIpIHtcblx0XHRcdFx0XHRcdHZhciBsb2cgPSBzdHIubWF0Y2goL15cXFtjb25uZWN0aW9uXFxdICg+fDwpICcoLio/KShcXFxcclxcXFxuKT8nJC8pO1xuXHRcdFx0XHRcdFx0aWYgKCFsb2cpIHJldHVybjtcblx0XHRcdFx0XHRcdGlmIChsb2dbMl0ubWF0Y2goL15QQVNTIC8pKVxuXHRcdFx0XHRcdFx0XHRsb2dbMl0gPSAnUEFTUyAqKioqKionO1xuXHRcdFx0XHRcdFx0c2VsZi5lbWl0KCdkZWJ1ZycsIGxvZ1sxXSArJyAnKyBsb2dbMl0pO1xuXHRcdFx0XHRcdFx0Y29uc29sZS5kZWJ1Zyhsb2dbMV0gKycgJysgbG9nWzJdKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH07XG5cdFx0XHRcdGlmICghRlRQKSBGVFAgPSByZXF1aXJlKCcuL2Nvbm5lY3RvcnMvZnRwJyk7XG5cdFx0XHRcdHNlbGYuY29ubmVjdG9yID0gbmV3IEZUUChzZWxmKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlICdzZnRwJzpcblx0XHRcdFx0aW5mbyA9IHtcblx0XHRcdFx0XHRob3N0OiBzZWxmLmluZm8uaG9zdCB8fCAnJyxcblx0XHRcdFx0XHRwb3J0OiBzZWxmLmluZm8ucG9ydCB8fCAyMSxcblx0XHRcdFx0XHR1c2VybmFtZTogc2VsZi5pbmZvLnVzZXIgfHwgJycsXG5cdFx0XHRcdFx0cmVhZHlUaW1lb3V0OiBzZWxmLmluZm8uY29ublRpbWVvdXQgfHwgMTAwMDAsXG5cdFx0XHRcdFx0cGluZ0ludGVydmFsOiBzZWxmLmluZm8ua2VlcGFsaXZlIHx8IDEwMDAwXG5cdFx0XHRcdH07XG5cdFx0XHRcdGlmIChzZWxmLmluZm8ucGFzcylcblx0XHRcdFx0XHRpbmZvLnBhc3N3b3JkID0gc2VsZi5pbmZvLnBhc3M7XG5cblx0XHRcdFx0dmFyIHBrO1xuXHRcdFx0XHRpZiAoc2VsZi5pbmZvLnByaXZhdGVrZXkgJiYgKHBrID0gRlMucmVhZEZpbGVTeW5jKHNlbGYuaW5mby5wcml2YXRla2V5KSkpXG5cdFx0XHRcdFx0aW5mby5wcml2YXRlS2V5ID0gcGs7XG5cblx0XHRcdFx0aWYgKHNlbGYuaW5mby5wYXNzcGhyYXNlKVxuXHRcdFx0XHRcdGluZm8ucGFzc3BocmFzZSA9IHNlbGYuaW5mby5wYXNzcGhyYXNlO1xuXG5cdFx0XHRcdGlmIChzZWxmLmluZm8uYWdlbnQpXG5cdFx0XHRcdFx0aW5mby5hZ2VudCA9IHNlbGYuaW5mby5hZ2VudDtcblxuXHRcdFx0XHRpZiAoc2VsZi5pbmZvLmFnZW50ID09ICdlbnYnKVxuXHRcdFx0XHRcdGluZm8uYWdlbnQgPSBwcm9jZXNzLmVudi5TU0hfQVVUSF9TT0NLO1xuXG5cdFx0XHRcdGlmIChzZWxmLmluZm8uaG9zdGhhc2gpXG5cdFx0XHRcdFx0aW5mby5ob3N0SGFzaCA9IHNlbGYuaW5mby5ob3N0aGFzaDtcblxuXHRcdFx0XHRpZiAoc2VsZi5pbmZvLmlnbm9yZWhvc3QpXG5cdFx0XHRcdFx0aW5mby5ob3N0VmVyaWZpZXIgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0cnVlOyB9XG5cblx0XHRcdFx0aWYgKHNlbGYuaW5mby5rZXlib2FyZEludGVyYWN0aXZlKVxuXHRcdFx0XHRcdGluZm8udHJ5S2V5Ym9hcmQgPSB0cnVlO1xuXG5cdFx0XHRcdGluZm8uZGVidWcgPSBmdW5jdGlvbiAoc3RyKSB7XG5cdFx0XHRcdFx0Lyp2YXIgbG9nID0gc3RyLm1hdGNoKC9eXFxbY29ubmVjdGlvblxcXSAoPnw8KSAnKC4qPykoXFxcXHJcXFxcbik/JyQvKTtcblx0XHRcdFx0XHRpZiAoIWxvZykgcmV0dXJuO1xuXHRcdFx0XHRcdGlmIChsb2dbMl0ubWF0Y2goL15QQVNTIC8pKVxuXHRcdFx0XHRcdFx0bG9nWzJdID0gJ1BBU1MgKioqKioqJztcblx0XHRcdFx0XHRzZWxmLmVtaXQoJ2RlYnVnJywgbG9nWzFdICsnICcrIGxvZ1syXSk7XG5cdFx0XHRcdFx0Y29uc29sZS5kZWJ1Zyhsb2dbMV0gKycgJysgbG9nWzJdKTsqL1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCFTRlRQKSBTRlRQID0gcmVxdWlyZSgnLi9jb25uZWN0b3JzL3NmdHAnKTtcblx0XHRcdFx0c2VsZi5jb25uZWN0b3IgPSBuZXcgU0ZUUChzZWxmKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHR0aHJvdyBcIk5vIGBwcm90b2NvbGAgZm91bmQgaW4gY29ubmVjdGlvbiBjcmVkZW50aWFsLiBQbGVhc2UgcmVjcmVhdGUgLmZ0cGNvbmZpZyBmaWxlIGZyb20gUGFja2FnZXMgLT4gUmVtb3RlLUZUUCAtPiBDcmVhdGUgKFMpRlRQIGNvbmZpZyBmaWxlLlwiO1xuXHRcdH1cblxuXHRcdHNlbGYuY29ubmVjdG9yLmNvbm5lY3QoaW5mbywgZnVuY3Rpb24gKCkge1xuXHRcdFx0aWYgKHNlbGYucm9vdC5zdGF0dXMgIT0gMSlcblx0XHRcdFx0c2VsZi5yb290Lm9wZW4oKTtcblx0XHRcdHNlbGYuZW1pdCgnY29ubmVjdGVkJyk7XG5cblx0XHRcdGF0b20ubm90aWZpY2F0aW9ucy5hZGRTdWNjZXNzKFwiUmVtb3RlIEZUUDogQ29ubmVjdGVkXCIpO1xuXHRcdH0pO1xuXG5cdFx0Ly9zZWxmLmNvbm5lY3Rvci5vbignZ3JlZXRpbmcnLCBmdW5jdGlvbiAoKSB7XG5cdFx0Ly9cdHNlbGYuZW1pdCgnZ3JlZXRpbmcnKTtcblx0XHQvL30pO1xuXHRcdHNlbGYuY29ubmVjdG9yLm9uKCdjbG9zZWQnLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRzZWxmLmRpc2Nvbm5lY3QoKTtcblx0XHRcdHNlbGYuZW1pdCgnY2xvc2VkJyk7XG5cblx0XHRcdGF0b20ubm90aWZpY2F0aW9ucy5hZGRJbmZvKFwiUmVtb3RlIEZUUDogQ29ubmVjdGlvbiBjbG9zZWRcIik7XG5cdFx0fSk7XG5cdFx0c2VsZi5jb25uZWN0b3Iub24oJ2VuZGVkJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0c2VsZi5lbWl0KCdlbmRlZCcpO1xuXHRcdH0pO1xuXHRcdHNlbGYuY29ubmVjdG9yLm9uKCdlcnJvcicsIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdC8vc2VsZi5lbWl0KCdlcnJvcicsIGVycik7XG5cdFx0XHQvL2NvbnNvbGUuZXJyb3IoZXJyKTtcblxuXHRcdFx0YXRvbS5ub3RpZmljYXRpb25zLmFkZEVycm9yKFwiUmVtb3RlIEZUUDogXCIgKyBlcnIpO1xuXHRcdH0pO1xuXHR9XG5cblx0Q2xpZW50LnByb3RvdHlwZS5kaXNjb25uZWN0ID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdGlmIChzZWxmLmNvbm5lY3Rvcikge1xuXHRcdFx0c2VsZi5jb25uZWN0b3IuZGlzY29ubmVjdCgpO1xuXHRcdFx0ZGVsZXRlIHNlbGYuY29ubmVjdG9yO1xuXHRcdFx0c2VsZi5jb25uZWN0b3IgPSBudWxsO1xuXHRcdH1cblxuXHRcdGlmIChzZWxmLnJvb3QpIHtcblx0XHRcdHNlbGYucm9vdC5zdGF0dXMgPSAwO1xuXHRcdFx0c2VsZi5yb290LmRlc3Ryb3koKTtcblx0XHRcdC8vc2VsZi5yb290ID0gbnVsbDtcblx0XHR9XG5cblx0XHRzZWxmLl9jdXJyZW50ID0gbnVsbDtcblx0XHRzZWxmLl9xdWV1ZSA9IFtdO1xuXG5cdFx0c2VsZi5lbWl0KCdkaXNjb25uZWN0ZWQnKTtcblxuXHRcdHJldHVybiBzZWxmO1xuXHR9XG5cblx0Q2xpZW50LnByb3RvdHlwZS50b1JlbW90ZSA9IGZ1bmN0aW9uIChsb2NhbCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHJldHVybiBQYXRoLmpvaW4oXG5cdFx0XHRzZWxmLmluZm8ucmVtb3RlLFxuXHRcdFx0YXRvbS5wcm9qZWN0LnJlbGF0aXZpemUobG9jYWwpXG5cdFx0KS5yZXBsYWNlKC9cXFxcL2csICcvJyk7XG5cdH1cblxuXHRDbGllbnQucHJvdG90eXBlLnRvTG9jYWwgPSBmdW5jdGlvbiAocmVtb3RlKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0cmV0dXJuIGF0b20ucHJvamVjdC5nZXREaXJlY3RvcmllcygpWzBdLnJlc29sdmUoXG5cdFx0XHQnLi8nICsgcmVtb3RlLnN1YnN0cihzZWxmLmluZm8ucmVtb3RlLmxlbmd0aCkucmVwbGFjZSgvXlxcLysvLCAnJylcblx0XHQpO1xuXHR9XG5cblx0Q2xpZW50LnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRpZiAoIXNlbGYuaXNDb25uZWN0ZWQoKSlcblx0XHRcdHJldHVybjtcblxuXHRcdHNlbGYuX2N1cnJlbnQgPSBzZWxmLl9xdWV1ZS5zaGlmdCgpO1xuXHRcdGlmIChzZWxmLl9jdXJyZW50KVxuXHRcdFx0c2VsZi5fY3VycmVudFsxXS5hcHBseShzZWxmLCBbc2VsZi5fY3VycmVudFsyXV0pO1xuXG5cdFx0YXRvbS5wcm9qZWN0LnJlbW90ZWZ0cC5lbWl0KCdxdWV1ZS1jaGFuZ2VkJyk7XG5cdH1cblxuXHRDbGllbnQucHJvdG90eXBlLl9lbnF1ZXVlID0gZnVuY3Rpb24gKGZ1bmMsIGRlc2MpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRwcm9ncmVzcyA9IG5ldyBQcm9ncmVzcygpO1xuXG5cdFx0c2VsZi5fcXVldWUucHVzaChbZGVzYywgZnVuYywgcHJvZ3Jlc3NdKTtcblx0XHRpZiAoc2VsZi5fcXVldWUubGVuZ3RoID09IDEgJiYgIXNlbGYuX2N1cnJlbnQpXG5cdFx0XHRzZWxmLl9uZXh0KCk7XG5cdFx0ZWxzZVxuXHRcdFx0c2VsZi5lbWl0KCdxdWV1ZS1jaGFuZ2VkJyk7XG5cblx0XHRyZXR1cm4gcHJvZ3Jlc3M7XG5cdH1cblxuXHRDbGllbnQucHJvdG90eXBlLmFib3J0ID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdGlmIChzZWxmLmlzQ29ubmVjdGVkKCkpXG5cdFx0XHRzZWxmLmNvbm5lY3Rvci5hYm9ydChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdHNlbGYuX25leHQoKTtcblx0XHRcdH0pO1xuXG5cdFx0cmV0dXJuIHNlbGY7XG5cdH1cblxuXHRDbGllbnQucHJvdG90eXBlLmFib3J0QWxsID0gZnVuY3Rpb24gKCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHNlbGYuX2N1cnJlbnQgPSBudWxsO1xuXHRcdHNlbGYuX3F1ZXVlID0gW107XG5cblx0XHRpZiAoc2VsZi5pc0Nvbm5lY3RlZCgpKVxuXHRcdFx0c2VsZi5jb25uZWN0b3IuYWJvcnQoKTtcblxuXHRcdFx0c2VsZi5lbWl0KCdxdWV1ZS1jaGFuZ2VkJyk7XG5cblx0XHRyZXR1cm4gc2VsZjtcblx0fVxuXG5cdENsaWVudC5wcm90b3R5cGUubGlzdCA9IGZ1bmN0aW9uIChyZW1vdGUsIHJlY3Vyc2l2ZSwgY2FsbGJhY2spIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHQvL2lmIChzZWxmLmlzQ29ubmVjdGVkKCkpIHtcblx0XHRzZWxmLm9uY2VDb25uZWN0ZWQoZnVuY3Rpb24gKCkge1xuXHRcdFx0c2VsZi5fZW5xdWV1ZShmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdHNlbGYuY29ubmVjdG9yLmxpc3QocmVtb3RlLCByZWN1cnNpdmUsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0Y2FsbGJhY2suYXBwbHkobnVsbCwgYXJndW1lbnRzKTtcblx0XHRcdFx0XHRzZWxmLl9uZXh0KCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSwgJ0xpc3RpbmcgJysgKHJlY3Vyc2l2ZT8ncmVjdXJzaXZlbHkgJzonJykgKyBQYXRoLmJhc2VuYW1lKHJlbW90ZSkpO1xuXHRcdH0pXG5cblx0XHRyZXR1cm4gc2VsZjtcblx0fVxuXG5cdENsaWVudC5wcm90b3R5cGUuZG93bmxvYWQgPSBmdW5jdGlvbiAocmVtb3RlLCByZWN1cnNpdmUsIGNhbGxiYWNrKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0Ly9pZiAoc2VsZi5pc0Nvbm5lY3RlZCgpKSB7XG5cdFx0c2VsZi5vbmNlQ29ubmVjdGVkKGZ1bmN0aW9uICgpIHtcblx0XHRcdHNlbGYuX2VucXVldWUoZnVuY3Rpb24gKHByb2dyZXNzKSB7XG5cdFx0XHRcdHNlbGYuY29ubmVjdG9yLmdldChyZW1vdGUsIHJlY3Vyc2l2ZSwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRjYWxsYmFjay5hcHBseShudWxsLCBhcmd1bWVudHMpO1xuXHRcdFx0XHRcdHNlbGYuX25leHQoKTtcblx0XHRcdFx0fSwgZnVuY3Rpb24gKHBlcmNlbnQpIHtcblx0XHRcdFx0XHRwcm9ncmVzcy5zZXRQcm9ncmVzcyhwZXJjZW50KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9LCAnRG93bmxvYWRpbmcgJysgUGF0aC5iYXNlbmFtZShyZW1vdGUpKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBzZWxmO1xuXHR9XG5cblx0Q2xpZW50LnByb3RvdHlwZS51cGxvYWQgPSBmdW5jdGlvbiAobG9jYWwsIGNhbGxiYWNrKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0Ly9pZiAoc2VsZi5pc0Nvbm5lY3RlZCgpKSB7XG5cdFx0c2VsZi5vbmNlQ29ubmVjdGVkKGZ1bmN0aW9uICgpIHtcblx0XHRcdHNlbGYuX2VucXVldWUoZnVuY3Rpb24gKHByb2dyZXNzKSB7XG5cdFx0XHRcdHNlbGYuY29ubmVjdG9yLnB1dChsb2NhbCwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRjYWxsYmFjay5hcHBseShudWxsLCBhcmd1bWVudHMpO1xuXHRcdFx0XHRcdHNlbGYuX25leHQoKTtcblx0XHRcdFx0fSwgZnVuY3Rpb24gKHBlcmNlbnQpIHtcblx0XHRcdFx0XHRwcm9ncmVzcy5zZXRQcm9ncmVzcyhwZXJjZW50KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9LCAnVXBsb2FkaW5nICcrIFBhdGguYmFzZW5hbWUobG9jYWwpKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBzZWxmO1xuXHR9XG5cblx0Q2xpZW50LnByb3RvdHlwZS5fdHJhdmVyc2VUcmVlID0gZnVuY3Rpb24gKHBhdGgsIGNhbGxiYWNrKSB7XG5cdFx0dmFyIGxpc3QgPSBbXSxcblx0XHRcdGRpZ2cgPSAwO1xuXG5cdFx0dmFyIGUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRsaXN0LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsgaXRlbS5kZXB0aCA9IGl0ZW0ubmFtZS5zcGxpdCgnLycpLmxlbmd0aDsgfSk7XG5cdFx0XHRsaXN0LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcblx0XHRcdFx0aWYgKGEuZGVwdGggPT0gYi5kZXB0aClcblx0XHRcdFx0XHRyZXR1cm4gMDtcblx0XHRcdFx0cmV0dXJuIGEuZGVwdGggPiBiLmRlcHRoID8gMSA6IC0xO1xuXHRcdFx0fSk7XG5cblx0XHRcdGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdGNhbGxiYWNrLmFwcGx5KG51bGwsIFtsaXN0XSk7XG5cdFx0fVxuXHRcdHZhciBsID0gZnVuY3Rpb24gKHApIHtcblx0XHRcdCsrZGlnZztcblx0XHRcdEZTLnJlYWRkaXIocCwgZnVuY3Rpb24gKGVyciwgbGlzKSB7XG5cdFx0XHRcdGlmIChlcnIpXG5cdFx0XHRcdFx0cmV0dXJuIGUoKTtcblxuXHRcdFx0XHRsaXMuZm9yRWFjaChmdW5jdGlvbiAobmFtZSkge1xuXHRcdFx0XHRcdGlmIChuYW1lID09ICcuJyB8fCBuYW1lID09ICcuLicpXG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cblx0XHRcdFx0XHRuYW1lID0gUGF0aC5qb2luKHAsIG5hbWUpO1xuXHRcdFx0XHRcdHZhciBzdGF0cyA9IEZTLnN0YXRTeW5jKG5hbWUpO1xuXHRcdFx0XHRcdGxpc3QucHVzaCh7XG5cdFx0XHRcdFx0XHRuYW1lOiBuYW1lLFxuXHRcdFx0XHRcdFx0c2l6ZTogc3RhdHMuc2l6ZSxcblx0XHRcdFx0XHRcdGRhdGU6IHN0YXRzLm10aW1lLFxuXHRcdFx0XHRcdFx0dHlwZTogc3RhdHMuaXNGaWxlKCkgPyAnZicgOiAnZCdcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRpZiAoIXN0YXRzLmlzRmlsZSgpKSB7XG5cdFx0XHRcdFx0XHRsKG5hbWUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHRcdGlmICgtLWRpZ2cgPT0gMClcblx0XHRcdFx0XHRyZXR1cm4gZSgpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdGwocGF0aCk7XG5cdH07XG5cblx0Q2xpZW50LnByb3RvdHlwZS5zeW5jUmVtb3RlTG9jYWwgPSBmdW5jdGlvbiAocmVtb3RlLCBjYWxsYmFjaykge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHNlbGYub25jZUNvbm5lY3RlZChmdW5jdGlvbiAoKSB7XG5cdFx0XHRzZWxmLl9lbnF1ZXVlKGZ1bmN0aW9uIChwcm9ncmVzcykge1xuXG5cdFx0XHRcdHZhciBsb2NhbCA9IHNlbGYudG9Mb2NhbChyZW1vdGUpO1xuXG5cdFx0XHRcdHNlbGYuY29ubmVjdG9yLmxpc3QocmVtb3RlLCB0cnVlLCBmdW5jdGlvbiAoZXJyLCByZW1vdGVzKSB7XG5cdFx0XHRcdFx0aWYgKGVycikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdFx0Y2FsbGJhY2suYXBwbHkobnVsbCwgW2Vycl0pO1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHNlbGYuX3RyYXZlcnNlVHJlZShsb2NhbCwgZnVuY3Rpb24gKGxvY2Fscykge1xuXG5cdFx0XHRcdFx0XHR2YXIgZSA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdFx0XHRjYWxsYmFjay5hcHBseShudWxsKTtcblx0XHRcdFx0XHRcdFx0c2VsZi5fbmV4dCgpO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR2YXIgbiA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0dmFyIHJlbW90ZSA9IHJlbW90ZXMuc2hpZnQoKTtcblx0XHRcdFx0XHRcdFx0aWYgKCFyZW1vdGUpIHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZSgpO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0aWYgKHJlbW90ZS50eXBlID09ICdkJylcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gbigpO1xuXG5cblx0XHRcdFx0XHRcdFx0dmFyIHRvTG9jYWwgPSBzZWxmLnRvTG9jYWwocmVtb3RlLm5hbWUpLFxuXHRcdFx0XHRcdFx0XHRcdGxvY2FsID0gbnVsbDtcblxuXHRcdFx0XHRcdFx0XHRmb3IgKHZhciBhID0gMCwgYiA9IGxvY2Fscy5sZW5ndGg7IGEgPCBiOyArK2EpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAobG9jYWxzW2FdLm5hbWUgPT0gdG9Mb2NhbCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0bG9jYWwgPSBsb2NhbHNbYV07XG5cdFx0XHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHQvLyBEb3dubG9hZCBvbmx5IGlmIG5vdCBwcmVzZW50IG9uIGxvY2FsIG9yIHNpemUgZGlmZmVyXG5cdFx0XHRcdFx0XHRcdGlmICghbG9jYWwgfHwgcmVtb3RlLnNpemUgIT0gbG9jYWwuc2l6ZSkge1xuXHRcdFx0XHRcdFx0XHRcdHNlbGYuY29ubmVjdG9yLmdldChyZW1vdGUubmFtZSwgZmFsc2UsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBuKCk7XG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0bigpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRuKCk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0fSk7XG5cblx0XHRcdH0sICdTeW5jIGxvY2FsICcrIFBhdGguYmFzZW5hbWUocmVtb3RlKSk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gc2VsZjtcblx0fVxuXG5cdENsaWVudC5wcm90b3R5cGUuc3luY0xvY2FsUmVtb3RlID0gZnVuY3Rpb24gKGxvY2FsLCBjYWxsYmFjaykge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHNlbGYub25jZUNvbm5lY3RlZChmdW5jdGlvbiAoKSB7XG5cdFx0XHRzZWxmLl9lbnF1ZXVlKGZ1bmN0aW9uIChwcm9ncmVzcykge1xuXG5cdFx0XHRcdHZhciByZW1vdGUgPSBzZWxmLnRvUmVtb3RlKGxvY2FsKTtcblx0XHRcdFx0c2VsZi5jb25uZWN0b3IubGlzdChyZW1vdGUsIHRydWUsIGZ1bmN0aW9uIChlcnIsIHJlbW90ZXMpIHtcblx0XHRcdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0XHRjYWxsYmFjay5hcHBseShudWxsLCBbZXJyXSk7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0c2VsZi5fdHJhdmVyc2VUcmVlKGxvY2FsLCBmdW5jdGlvbiAobG9jYWxzKSB7XG5cblx0XHRcdFx0XHRcdHZhciBlID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0XHRcdGNhbGxiYWNrLmFwcGx5KG51bGwpO1xuXHRcdFx0XHRcdFx0XHRzZWxmLl9uZXh0KCk7XG5cdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHZhciBuID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHR2YXIgbG9jYWwgPSBsb2NhbHMuc2hpZnQoKTtcblx0XHRcdFx0XHRcdFx0aWYgKCFsb2NhbCkge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBlKCk7XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRpZiAobG9jYWwudHlwZSA9PSAnZCcpXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIG4oKTtcblxuXHRcdFx0XHRcdFx0XHR2YXIgdG9SZW1vdGUgPSBzZWxmLnRvUmVtb3RlKGxvY2FsLm5hbWUpLFxuXHRcdFx0XHRcdFx0XHRcdHJlbW90ZSA9IG51bGw7XG5cblx0XHRcdFx0XHRcdFx0Zm9yICh2YXIgYSA9IDAsIGIgPSByZW1vdGVzLmxlbmd0aDsgYSA8IGI7ICsrYSkge1xuXHRcdFx0XHRcdFx0XHRcdGlmIChyZW1vdGVzW2FdLm5hbWUgPT0gdG9SZW1vdGUpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJlbW90ZSA9IHJlbW90ZXNbYV07XG5cdFx0XHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHQvLyBVcGxvYWQgb25seSBpZiBub3QgcHJlc2VudCBvbiByZW1vdGUgb3Igc2l6ZSBkaWZmZXJcblx0XHRcdFx0XHRcdFx0aWYgKCFyZW1vdGUgfHwgcmVtb3RlLnNpemUgIT0gbG9jYWwuc2l6ZSkge1xuXHRcdFx0XHRcdFx0XHRcdHNlbGYuY29ubmVjdG9yLnB1dChsb2NhbC5uYW1lLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gbigpO1xuXHRcdFx0XHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0bigpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRuKCk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0fSk7XG5cblx0XHRcdH0sICdTeW5jIHJlbW90ZSAnKyBQYXRoLmJhc2VuYW1lKGxvY2FsKSk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gc2VsZjtcblx0fVxuXG5cdENsaWVudC5wcm90b3R5cGUubWtkaXIgPSBmdW5jdGlvbiAocmVtb3RlLCByZWN1cnNpdmUsIGNhbGxiYWNrKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0Ly9pZiAoc2VsZi5pc0Nvbm5lY3RlZCgpKSB7XG5cdFx0c2VsZi5vbmNlQ29ubmVjdGVkKGZ1bmN0aW9uICgpIHtcblx0XHRcdHNlbGYuX2VucXVldWUoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRzZWxmLmNvbm5lY3Rvci5ta2RpcihyZW1vdGUsIHJlY3Vyc2l2ZSwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRjYWxsYmFjay5hcHBseShudWxsLCBhcmd1bWVudHMpO1xuXHRcdFx0XHRcdHNlbGYuX25leHQoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9LCAnQ3JlYXRpbmcgZm9sZGVyICcrIFBhdGguYmFzZW5hbWUocmVtb3RlKSk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gc2VsZjtcblx0fVxuXG5cdENsaWVudC5wcm90b3R5cGUubWtmaWxlID0gZnVuY3Rpb24gKHJlbW90ZSwgY2FsbGJhY2spIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHQvL2lmIChzZWxmLmlzQ29ubmVjdGVkKCkpIHtcblx0XHRzZWxmLm9uY2VDb25uZWN0ZWQoZnVuY3Rpb24gKCkge1xuXHRcdFx0c2VsZi5fZW5xdWV1ZShmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdHNlbGYuY29ubmVjdG9yLm1rZmlsZShyZW1vdGUsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0Y2FsbGJhY2suYXBwbHkobnVsbCwgYXJndW1lbnRzKTtcblx0XHRcdFx0XHRzZWxmLl9uZXh0KCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSwgJ0NyZWF0aW5nIGZpbGUgJysgUGF0aC5iYXNlbmFtZShyZW1vdGUpKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBzZWxmO1xuXHR9XG5cblx0Q2xpZW50LnByb3RvdHlwZS5yZW5hbWUgPSBmdW5jdGlvbiAoc291cmNlLCBkZXN0LCBjYWxsYmFjaykge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdC8vaWYgKHNlbGYuaXNDb25uZWN0ZWQoKSkge1xuXHRcdHNlbGYub25jZUNvbm5lY3RlZChmdW5jdGlvbiAoKSB7XG5cdFx0XHRzZWxmLl9lbnF1ZXVlKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0c2VsZi5jb25uZWN0b3IucmVuYW1lKHNvdXJjZSwgZGVzdCwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRjYWxsYmFjay5hcHBseShudWxsLCBhcmd1bWVudHMpO1xuXHRcdFx0XHRcdHNlbGYuX25leHQoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9LCAnUmVuYW1pbmcgJysgUGF0aC5iYXNlbmFtZShzb3VyY2UpKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBzZWxmO1xuXHR9XG5cblx0Q2xpZW50LnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbiAocmVtb3RlLCBjYWxsYmFjaykge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdC8vaWYgKHNlbGYuaXNDb25uZWN0ZWQoKSkge1xuXHRcdHNlbGYub25jZUNvbm5lY3RlZChmdW5jdGlvbiAoKSB7XG5cdFx0XHRzZWxmLl9lbnF1ZXVlKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0c2VsZi5jb25uZWN0b3IuZGVsZXRlKHJlbW90ZSwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRjYWxsYmFjay5hcHBseShudWxsLCBhcmd1bWVudHMpO1xuXHRcdFx0XHRcdHNlbGYuX25leHQoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9LCAnRGVsZXRpbmcgJysgUGF0aC5iYXNlbmFtZShyZW1vdGUpKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiBzZWxmO1xuXHR9XG5cblx0cmV0dXJuIENsaWVudDtcbn0pKCk7XG4iXX0=