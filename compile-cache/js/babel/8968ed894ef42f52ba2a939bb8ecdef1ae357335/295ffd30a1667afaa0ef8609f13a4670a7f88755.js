var __hasProp = ({}).hasOwnProperty,
    __extends = function __extends(child, parent) {
	for (var key in parent) {
		if (__hasProp.call(parent, key)) child[key] = parent[key];
	}function ctor() {
		this.constructor = child;
	}ctor.prototype = parent.prototype;child.prototype = new ctor();child.__super__ = parent.prototype;return child;
},
    FS = require('fs-plus'),
    Path = require('path'),
    FTP = require('ftp'),
    Connector = require('../connector');

module.exports = (function () {
	__extends(ConnectorFTP, Connector);

	function ConnectorFTP() {
		ConnectorFTP.__super__.constructor.apply(this, arguments);
		this.ftp = null;
	}

	ConnectorFTP.prototype.isConnected = function () {
		return this.ftp && this.ftp.connected;
	};

	ConnectorFTP.prototype.connect = function (info, completed) {
		var self = this;

		self.info = info;

		self.ftp = new FTP();
		self.ftp.on('greeting', function (msg) {
			self.emit('greeting', msg);
		});
		self.ftp.on('ready', function () {
			self.emit('connected');

			if (typeof completed === 'function') completed.apply(self, []);
		});
		/*self.ftp.on('close', function () {
  	self.emit('closed');
  });*/
		self.ftp.on('end', function () {
			self.emit('ended');
		});
		self.ftp.on('error', function (err) {
			self.emit('error', err);
		});
		self.info._debug = self.info.debug;
		self.info.debug = function (str) {
			var log = str.match(/^\[connection\] (>|<) '(.*?)(\\r\\n)?'$/);
			if (!log || log[1] != '<') return;

			var reply = log[2].match(/^[0-9]+/);
			if (reply) self.emit(reply[0], log[2]);

			if (typeof self.info._debug == 'function') self.info._debug.apply(null, [str]);
		};
		self.ftp.connect(self.info);

		return self;
	};

	ConnectorFTP.prototype.disconnect = function (completed) {
		var self = this;

		if (self.ftp) {
			self.ftp.destroy();
			self.ftp = null;
		}

		if (typeof completed === 'function') completed.apply(null, []);

		return self;
	};

	ConnectorFTP.prototype.abort = function (completed) {
		var self = this;

		if (self.isConnected()) {
			self.ftp.abort(function () {
				if (typeof completed === 'function') completed.apply(null, []);
			});
		} else {
			if (typeof completed === 'function') completed.apply(null, []);
		}

		return self;
	};

	ConnectorFTP.prototype.list = function (path, recursive, completed) {
		var self = this;

		if (self.isConnected()) {

			if (recursive) {
				var digg = 0,
				    list = [];

				var e = function e() {
					if (typeof completed === 'function') completed.apply(null, [null, list]);
				};
				var l = function l(p) {
					++digg;
					self.ftp.list(p, function (err, lis) {
						if (err) return e();

						lis.forEach(function (item) {
							if (item.name == '.' || item.name == '..') return;

							item.name = Path.join(p, item.name).replace(/\\/g, '/');
							list.push(item);
							if (item.type == 'd' || item.type == 'l') {
								l(item.name);
							} else {
								item.type = 'f';
							}
						});

						if (--digg == 0) e();
					});
				};
				l(path);
			} else {
				self.ftp.list(path, function (err, lis) {
					var list = [];

					if (!err) {
						lis.forEach(function (item) {
							if (item.type == 'd' || item.type == 'l') {
								if (item.name != '.' && item.name != '..') list.push(item);
							} else {
								item.type = 'f';
								list.push(item);
							}
						});
					}

					if (typeof completed === 'function') completed.apply(null, [err, list]);
				});
			}
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return this;
	};

	ConnectorFTP.prototype.get = function (path, recursive, completed, progress) {
		var self = this,
		    local = self.client.toLocal(path);

		if (self.isConnected()) {
			self.ftp.cwd(path, function (err) {
				self.ftp.cwd('/', function () {

					// File
					if (err) {
						FS.makeTreeSync(Path.dirname(local));
						var size = -1,
						    pool;
						self.once('150', function (reply) {
							var str = reply.match(/([0-9]+)\s*(bytes)/);
							if (str) {
								size = parseInt(str[1], 10) || -1;
								pool = setInterval(function () {
									if (!self.ftp._pasvSocket) return;
									var read = self.ftp._pasvSocket.bytesRead;
									if (typeof progress === 'function') progress.apply(null, [read / size]);
								}, 250);
							}
						});
						self.ftp.get(path, function (err, stream) {
							if (err) {
								if (pool) clearInterval(pool);
								if (typeof completed === 'function') completed.apply(null, [err]);
								return;
							}

							var dest = FS.createWriteStream(local);
							dest.on('unpipe', function () {
								if (pool) clearInterval(pool);
								if (typeof completed === 'function') completed.apply(null, []);
							});
							dest.on('error', function (err) {
								if (pool) clearInterval(pool);
								if (typeof completed === 'function') completed.apply(null, [err]);
							});
							stream.pipe(dest);
						});
					}

					// Folder
					else {

						self.list(path, recursive, function (err, list) {

							list.unshift({ name: path, type: 'd' });
							list.forEach(function (item) {
								item.depth = item.name.replace(/^\/+/, '').replace(/\/+$/).split('/').length;
							});
							list.sort(function (a, b) {
								if (a.depth == b.depth) return 0;
								return a.depth > b.depth ? 1 : -1;
							});

							var error = null,
							    total = list.length,
							    i = -1,
							    size = 0,
							    read = 0,
							    pool;
							var e = function e() {
								if (typeof completed === 'function') completed.apply(null, [error, list]);
							};
							var n = function n() {
								++i;
								if (pool) clearInterval(pool);
								if (typeof progress === 'function') progress.apply(null, [i / total]);

								var item = list.shift();
								if (item == null) return e();
								var local = self.client.toLocal(item.name);
								if (item.type == 'd' || item.type == 'l') {
									//mkdirp(local, function (err) {
									//FS.makeTree(local, function (err) {
									FS.makeTreeSync(local);
									n();
									//	if (err)
									//		error = err;
									//	return n();
									//});
								} else {
									size = 0;
									read = 0;
									self.once('150', function (reply) {
										var str = reply.match(/([0-9]+)\s*(bytes)/);
										if (str) {
											size = parseInt(str[1], 10) || -1;
											pool = setInterval(function () {
												if (!self.ftp._pasvSocket) return;
												read = self.ftp._pasvSocket.bytesRead;
												if (typeof progress === 'function') progress.apply(null, [i / total + read / size / total]);
											}, 250);
										}
									});
									self.ftp.get(item.name, function (err, stream) {
										if (err) {
											error = err;
											return n();
										}
										var dest = FS.createWriteStream(local);
										dest.on('unpipe', function () {
											return n();
										});
										dest.on('error', function (err) {
											return n();
										});
										stream.pipe(dest);
									});
								}
							};
							n();
						});
					}
				});
			});
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return self;
	};

	ConnectorFTP.prototype.put = function (path, completed, progress) {
		var self = this,
		    remote = self.client.toRemote(path);

		if (self.isConnected()) {
			// File
			if (FS.isFileSync(path)) {
				var stats = FS.statSync(path),
				    size = stats['size'],
				    written = 0,
				    pool;
				var e = function e(err) {
					if (typeof completed === 'function') completed.apply(null, [err ? err : null, [{ name: path, type: 'f' }]]);
				};
				pool = setInterval(function () {
					if (!self.ftp._pasvSocket) return;
					written = self.ftp._pasvSocket.bytesWritten;
					if (typeof progress === 'function') progress.apply(null, [written / size]);
				}, 250);
				self.ftp.put(path, remote, function (err) {
					if (err) {
						self.mkdir(Path.dirname(remote).replace(/\\/g, '/'), true, function (err) {
							self.ftp.put(path, remote, function (err) {
								if (pool) clearInterval(pool);
								return e(err);
							});
						});
						return;
					}
					if (pool) clearInterval(pool);
					return e();
				});
			}

			// Folder
			else {
				self.client._traverseTree(path, function (list) {
					self.mkdir(remote, true, function (err) {
						var error,
						    i = -1,
						    total = list.length,
						    size = 0,
						    written = 0,
						    pool = setInterval(function () {
							if (!self.ftp._pasvSocket) return;
							written = self.ftp._pasvSocket.bytesWritten;
							if (typeof progress === 'function') progress.apply(null, [i / total + written / size / total]);
						}, 250);
						var e = function e() {
							if (pool) clearInterval(pool);
							if (typeof completed === 'function') completed.apply(null, [error, list]);
						};
						var n = function n() {
							if (++i >= list.length) return e();
							var item = list[i],
							    remote = self.client.toRemote(item.name);
							if (item.type == 'd' || item.type == 'l') {
								self.ftp.mkdir(remote, function (err) {
									if (err) error = err;
									return n();
								});
							} else {
								var stats = FS.statSync(item.name);
								size = stats['size'];
								written = 0;
								self.ftp.put(item.name, remote, function (err) {
									if (err) error = err;
									return n();
								});
							}
						};
						return n();
					});
				});
			}
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return self;
	};

	ConnectorFTP.prototype.mkdir = function (path, recursive, completed) {
		var self = this,
		    remotes = path.replace(/^\/+/, '').replace(/\/+$/, '').split('/'),
		    dirs = ['/' + remotes.slice(0, remotes.length).join('/')];

		if (self.isConnected()) {
			if (recursive) {
				for (var a = remotes.length - 1; a > 0; --a) dirs.unshift('/' + remotes.slice(0, a).join('/'));
			}

			var n = function n() {
				var dir = dirs.shift(),
				    last = dirs.length == 0;

				self.ftp.mkdir(dir, function (err) {
					if (last) {
						if (typeof completed === 'function') completed.apply(null, [err ? err : null]);
					} else {
						return n();
					}
				});
			};
			n();
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return self;
	};

	ConnectorFTP.prototype.mkfile = function (path, completed) {
		var self = this,
		    local = self.client.toLocal(path),
		    empty = new Buffer('', 'utf8');

		if (self.isConnected()) {
			self.ftp.put(empty, path, function (err) {
				if (err) {
					if (typeof completed === 'function') completed.apply(null, [err]);
					return;
				}
				//mkdirp(Path.dirname(local), function (err1) {
				//FS.makeTree(Path.dirname(local), function (err1) {
				FS.makeTreeSync(Path.dirname(local));
				FS.writeFile(local, empty, function (err2) {
					if (typeof completed === 'function') completed.apply(null, [err2]);
				});
				//});
			});
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return self;
	};

	ConnectorFTP.prototype.rename = function (source, dest, completed) {
		var self = this;

		if (self.isConnected()) {
			self.ftp.rename(source, dest, function (err) {
				if (err) {
					if (typeof completed === 'function') completed.apply(null, [err]);
				} else {
					FS.rename(self.client.toLocal(source), self.client.toLocal(dest), function (err) {
						if (typeof completed === 'function') completed.apply(null, [err]);
					});
				}
			});
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return self;
	};

	ConnectorFTP.prototype['delete'] = function (path, completed) {
		var self = this;

		if (self.isConnected()) {
			self.ftp.cwd(path, function (err) {
				self.ftp.cwd('/', function () {

					// File
					if (err) {
						self.ftp['delete'](path, function (err) {
							if (typeof completed === 'function') completed.apply(null, [err, [{ name: path, type: 'f' }]]);
						});
					}

					// Folder
					else {
						self.list(path, true, function (err, list) {
							list.forEach(function (item) {
								item.depth = item.name.replace(/^\/+/, '').replace(/\/+$/).split('/').length;
							});
							list.sort(function (a, b) {
								if (a.depth == b.depth) return 0;
								return a.depth > b.depth ? -1 : 1;
							});

							var done = 0;

							var e = function e() {
								self.ftp.rmdir(path, function (err) {
									if (typeof completed === 'function') completed.apply(null, [err, list]);
								});
							};
							list.forEach(function (item) {
								++done;
								var fn = item.type == 'd' || item.type == 'l' ? 'rmdir' : 'delete';
								self.ftp[fn](item.name, function (err) {
									if (--done == 0) return e();
								});
							});
							if (list.length == 0) e();
						});
					}
				});
			});
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return self;
	};

	return ConnectorFTP;
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9uYXZlci8uYXRvbS9wYWNrYWdlcy9yZW1vdGUtZnRwL2xpYi9jb25uZWN0b3JzL2Z0cC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFJLFNBQVMsR0FBRyxDQUFBLEdBQUUsQ0FBQyxjQUFjO0lBQ2hDLFNBQVMsR0FBRyxTQUFaLFNBQVMsQ0FBWSxLQUFLLEVBQUUsTUFBTSxFQUFFO0FBQUUsTUFBSyxJQUFJLEdBQUcsSUFBSSxNQUFNLEVBQUU7QUFBRSxNQUFJLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxFQUFFLEtBQUssQ0FBQyxHQUFHLENBQUMsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7RUFBRSxBQUFDLFNBQVMsSUFBSSxHQUFHO0FBQUUsTUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUM7RUFBRSxBQUFDLElBQUksQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxBQUFDLEtBQUssQ0FBQyxTQUFTLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxBQUFDLEtBQUssQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxBQUFDLE9BQU8sS0FBSyxDQUFDO0NBQUU7SUFDL1IsRUFBRSxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUM7SUFDdkIsSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUM7SUFDdEIsR0FBRyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUM7SUFDcEIsU0FBUyxHQUFHLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQzs7QUFHckMsTUFBTSxDQUFDLE9BQU8sR0FBRyxDQUFDLFlBQVk7QUFDN0IsVUFBUyxDQUFDLFlBQVksRUFBRSxTQUFTLENBQUMsQ0FBQzs7QUFFbkMsVUFBUyxZQUFZLEdBQUk7QUFDeEIsY0FBWSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQztBQUMxRCxNQUFJLENB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LENBQUMsQ0FBQztRQUNILENBQUE7QUFDRCxXQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsSUFBSSxFQUFFO0FBQzVCLFVBQUUsSUFBSSxDQUFDO0FBQ1AsWUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksSUFBSSxHQUFHLEdBQUcsT0FBTyxHQUFHLFFBQVEsQ0FBQztBQUNuRSxZQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsVUFBVSxHQUFHLEVBQUU7QUFDdEMsYUFBSSxFQUFFLElBQUksSUFBSSxDQUFDLEVBQ2QsT0FBTyxDQUFDLEVBQUUsQ0FBQztTQUNaLENBQUMsQ0FBQztRQUNILENBQUMsQ0FBQztBQUNILFdBQUksSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLEVBQ25CLENBQUMsRUFBRSxDQUFDO09BQ0wsQ0FBQyxDQUFDO01BQ0g7S0FDRCxDQUFDLENBQUM7SUFDSCxDQUFDLENBQUM7R0FDSCxNQUNJO0FBQ0osT0FBSSxPQUFPLFNBQVMsS0FBSyxVQUFVLEVBQ2xDLFNBQVMsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQztHQUMxQzs7QUFFRCxTQUFPLElBQUksQ0FBQztFQUNaLENBQUE7O0FBRUQsUUFBTyxZQUFZLENBQUM7Q0FDcEIsQ0FBQSxFQUFHLENBQUMiLCJmaWxlIjoiL1VzZXJzL25hdmVyLy5hdG9tL3BhY2thZ2VzL3JlbW90ZS1mdHAvbGliL2Nvbm5lY3RvcnMvZnRwLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuXHRfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfSxcblx0RlMgPSByZXF1aXJlKCdmcy1wbHVzJyksXG5cdFBhdGggPSByZXF1aXJlKCdwYXRoJyksXG5cdEZUUCA9IHJlcXVpcmUoJ2Z0cCcpLFxuXHRDb25uZWN0b3IgPSByZXF1aXJlKCcuLi9jb25uZWN0b3InKTtcblxuXG5tb2R1bGUuZXhwb3J0cyA9IChmdW5jdGlvbiAoKSB7XG5cdF9fZXh0ZW5kcyhDb25uZWN0b3JGVFAsIENvbm5lY3Rvcik7XG5cblx0ZnVuY3Rpb24gQ29ubmVjdG9yRlRQICgpIHtcblx0XHRDb25uZWN0b3JGVFAuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG5cdFx0dGhpcy5mdHAgPSBudWxsO1xuXHR9XG5cblx0Q29ubmVjdG9yRlRQLnByb3RvdHlwZS5pc0Nvbm5lY3RlZCA9IGZ1bmN0aW9uICgpIHtcblx0XHRyZXR1cm4gdGhpcy5mdHAgJiYgdGhpcy5mdHAuY29ubmVjdGVkO1xuXHR9O1xuXG5cdENvbm5lY3RvckZUUC5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIChpbmZvLCBjb21wbGV0ZWQpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRzZWxmLmluZm8gPSBpbmZvO1xuXG5cdFx0c2VsZi5mdHAgPSBuZXcgRlRQKCk7XG5cdFx0c2VsZi5mdHAub24oJ2dyZWV0aW5nJywgZnVuY3Rpb24gKG1zZykge1xuXHRcdFx0c2VsZi5lbWl0KCdncmVldGluZycsIG1zZyk7XG5cdFx0fSk7XG5cdFx0c2VsZi5mdHAub24oJ3JlYWR5JywgZnVuY3Rpb24gKCkge1xuXHRcdFx0c2VsZi5lbWl0KCdjb25uZWN0ZWQnKTtcblxuXHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdGNvbXBsZXRlZC5hcHBseShzZWxmLCBbXSk7XG5cdFx0fSk7XG5cdFx0LypzZWxmLmZ0cC5vbignY2xvc2UnLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRzZWxmLmVtaXQoJ2Nsb3NlZCcpO1xuXHRcdH0pOyovXG5cdFx0c2VsZi5mdHAub24oJ2VuZCcsIGZ1bmN0aW9uICgpIHtcblx0XHRcdHNlbGYuZW1pdCgnZW5kZWQnKTtcblx0XHR9KTtcblx0XHRzZWxmLmZ0cC5vbignZXJyb3InLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRzZWxmLmVtaXQoJ2Vycm9yJywgZXJyKTtcblx0XHR9KTtcblx0XHRzZWxmLmluZm8uX2RlYnVnID0gc2VsZi5pbmZvLmRlYnVnO1xuXHRcdHNlbGYuaW5mby5kZWJ1ZyA9IGZ1bmN0aW9uIChzdHIpIHtcblx0XHRcdHZhciBsb2cgPSBzdHIubWF0Y2goL15cXFtjb25uZWN0aW9uXFxdICg+fDwpICcoLio/KShcXFxcclxcXFxuKT8nJC8pO1xuXHRcdFx0aWYgKCFsb2cgfHwgbG9nWzFdICE9ICc8JykgcmV0dXJuO1xuXG5cdFx0XHR2YXIgcmVwbHkgPSBsb2dbMl0ubWF0Y2goL15bMC05XSsvKTtcblx0XHRcdGlmIChyZXBseSlcblx0XHRcdFx0c2VsZi5lbWl0KHJlcGx5WzBdLCBsb2dbMl0pO1xuXG5cdFx0XHRpZiAodHlwZW9mIHNlbGYuaW5mby5fZGVidWcgPT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0c2VsZi5pbmZvLl9kZWJ1Zy5hcHBseShudWxsLCBbc3RyXSk7XG5cdFx0fVxuXHRcdHNlbGYuZnRwLmNvbm5lY3Qoc2VsZi5pbmZvKTtcblxuXHRcdHJldHVybiBzZWxmO1xuXHR9XG5cblx0Q29ubmVjdG9yRlRQLnByb3RvdHlwZS5kaXNjb25uZWN0ID0gZnVuY3Rpb24gKGNvbXBsZXRlZCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdGlmIChzZWxmLmZ0cCkge1xuXHRcdFx0c2VsZi5mdHAuZGVzdHJveSgpO1xuXHRcdFx0c2VsZi5mdHAgPSBudWxsO1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFtdKTtcblxuXHRcdHJldHVybiBzZWxmO1xuXHR9XG5cblx0Q29ubmVjdG9yRlRQLnByb3RvdHlwZS5hYm9ydCA9IGZ1bmN0aW9uIChjb21wbGV0ZWQpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRpZiAoc2VsZi5pc0Nvbm5lY3RlZCgpKSB7XG5cdFx0XHRzZWxmLmZ0cC5hYm9ydChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbXSk7XG5cdFx0XHR9KVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFtdKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gc2VsZjtcblx0fVxuXG5cdENvbm5lY3RvckZUUC5wcm90b3R5cGUubGlzdCA9IGZ1bmN0aW9uIChwYXRoLCByZWN1cnNpdmUsIGNvbXBsZXRlZCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdGlmIChzZWxmLmlzQ29ubmVjdGVkKCkpIHtcblxuXHRcdFx0aWYgKHJlY3Vyc2l2ZSkge1xuXHRcdFx0XHR2YXIgZGlnZyA9IDAsXG5cdFx0XHRcdFx0bGlzdCA9IFtdO1xuXG5cdFx0XHRcdHZhciBlID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFtudWxsLCBsaXN0XSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0dmFyIGwgPSBmdW5jdGlvbiAocCkge1xuXHRcdFx0XHRcdCsrZGlnZztcblx0XHRcdFx0XHRzZWxmLmZ0cC5saXN0KHAsIGZ1bmN0aW9uIChlcnIsIGxpcykge1xuXHRcdFx0XHRcdFx0aWYgKGVycilcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGUoKTtcblxuXHRcdFx0XHRcdFx0bGlzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdFx0XHRcdFx0aWYgKGl0ZW0ubmFtZSA9PSAnLicgfHwgaXRlbS5uYW1lID09ICcuLicpXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXG5cdFx0XHRcdFx0XHRcdGl0ZW0ubmFtZSA9IFBhdGguam9pbihwLCBpdGVtLm5hbWUpLnJlcGxhY2UoL1xcXFwvZywgJy8nKTtcblx0XHRcdFx0XHRcdFx0bGlzdC5wdXNoKGl0ZW0pO1xuXHRcdFx0XHRcdFx0XHRpZiAoaXRlbS50eXBlID09ICdkJyB8fCBpdGVtLnR5cGUgPT0gJ2wnKSB7XG5cdFx0XHRcdFx0XHRcdFx0bChpdGVtLm5hbWUpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdGl0ZW0udHlwZSA9ICdmJztcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdGlmICgtLWRpZ2cgPT0gMClcblx0XHRcdFx0XHRcdFx0ZSgpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGwocGF0aCk7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0c2VsZi5mdHAubGlzdChwYXRoLCBmdW5jdGlvbiAoZXJyLCBsaXMpIHtcblx0XHRcdFx0XHR2YXIgbGlzdCA9IFtdO1xuXG5cdFx0XHRcdFx0aWYgKCFlcnIpIHtcblx0XHRcdFx0XHRcdGxpcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChpdGVtLnR5cGUgPT0gJ2QnIHx8IGl0ZW0udHlwZSA9PSAnbCcpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAoaXRlbS5uYW1lICE9ICcuJyAmJiBpdGVtLm5hbWUgIT0gJy4uJylcblx0XHRcdFx0XHRcdFx0XHRcdGxpc3QucHVzaChpdGVtKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRpdGVtLnR5cGUgPSAnZic7XG5cdFx0XHRcdFx0XHRcdFx0bGlzdC5wdXNoKGl0ZW0pO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbZXJyLCBsaXN0XSk7XG5cdFx0XHRcdH0pXG5cdFx0XHR9XG5cblx0XHR9XG5cdFx0ZWxzZSB7XG5cdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFsnTm90IGNvbm5lY3RlZCddKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdENvbm5lY3RvckZUUC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKHBhdGgsIHJlY3Vyc2l2ZSwgY29tcGxldGVkLCBwcm9ncmVzcykge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdGxvY2FsID0gc2VsZi5jbGllbnQudG9Mb2NhbChwYXRoKTtcblxuXHRcdGlmIChzZWxmLmlzQ29ubmVjdGVkKCkpIHtcblx0XHRcdHNlbGYuZnRwLmN3ZChwYXRoLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdHNlbGYuZnRwLmN3ZCgnLycsIGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0XHRcdC8vIEZpbGVcblx0XHRcdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRGUy5tYWtlVHJlZVN5bmMoUGF0aC5kaXJuYW1lKGxvY2FsKSk7XG5cdFx0XHRcdFx0XHR2YXIgc2l6ZSA9IC0xLCBwb29sO1xuXHRcdFx0XHRcdFx0c2VsZi5vbmNlKCcxNTAnLCBmdW5jdGlvbiAocmVwbHkpIHtcblx0XHRcdFx0XHRcdFx0dmFyIHN0ciA9IHJlcGx5Lm1hdGNoKC8oWzAtOV0rKVxccyooYnl0ZXMpLyk7XG5cdFx0XHRcdFx0XHRcdGlmIChzdHIpIHtcblx0XHRcdFx0XHRcdFx0XHRzaXplID0gcGFyc2VJbnQoc3RyWzFdLCAxMCkgfHwgLTE7XG5cdFx0XHRcdFx0XHRcdFx0cG9vbCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGlmICghc2VsZi5mdHAuX3Bhc3ZTb2NrZXQpIHJldHVybjtcblx0XHRcdFx0XHRcdFx0XHRcdHZhciByZWFkID0gc2VsZi5mdHAuX3Bhc3ZTb2NrZXQuYnl0ZXNSZWFkO1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBwcm9ncmVzcyA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdFx0XHRcdFx0cHJvZ3Jlc3MuYXBwbHkobnVsbCwgW3JlYWQgLyBzaXplXSk7XG5cdFx0XHRcdFx0XHRcdFx0fSwgMjUwKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRzZWxmLmZ0cC5nZXQocGF0aCwgZnVuY3Rpb24gKGVyciwgc3RyZWFtKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChlcnIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAocG9vbClcblx0XHRcdFx0XHRcdFx0XHRcdGNsZWFySW50ZXJ2YWwocG9vbCk7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgW2Vycl0pO1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdHZhciBkZXN0ID0gRlMuY3JlYXRlV3JpdGVTdHJlYW0obG9jYWwpO1xuXHRcdFx0XHRcdFx0XHRkZXN0Lm9uKCd1bnBpcGUnLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHBvb2wpXG5cdFx0XHRcdFx0XHRcdFx0XHRjbGVhckludGVydmFsKHBvb2wpO1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFtdKTtcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdGRlc3Qub24oJ2Vycm9yJywgZnVuY3Rpb24gKGVycikge1xuXHRcdFx0XHRcdFx0XHRcdGlmIChwb29sKVxuXHRcdFx0XHRcdFx0XHRcdFx0Y2xlYXJJbnRlcnZhbChwb29sKTtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbZXJyXSk7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRzdHJlYW0ucGlwZShkZXN0KTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIEZvbGRlclxuXHRcdFx0XHRcdGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRzZWxmLmxpc3QocGF0aCwgcmVjdXJzaXZlLCBmdW5jdGlvbiAoZXJyLCBsaXN0KSB7XG5cblx0XHRcdFx0XHRcdFx0bGlzdC51bnNoaWZ0KHtuYW1lOiBwYXRoLCB0eXBlOiAnZCd9KTtcblx0XHRcdFx0XHRcdFx0bGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7IGl0ZW0uZGVwdGggPSBpdGVtLm5hbWUucmVwbGFjZSgvXlxcLysvLCAnJykucmVwbGFjZSgvXFwvKyQvKS5zcGxpdCgnLycpLmxlbmd0aDsgfSk7XG5cdFx0XHRcdFx0XHRcdGxpc3Quc29ydChmdW5jdGlvbiAoYSwgYikge1xuXHRcdFx0XHRcdFx0XHRcdGlmIChhLmRlcHRoID09IGIuZGVwdGgpXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gMDtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gYS5kZXB0aCA+IGIuZGVwdGggPyAxIDogLTE7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRcdHZhciBlcnJvciA9IG51bGwsXG5cdFx0XHRcdFx0XHRcdFx0dG90YWwgPSBsaXN0Lmxlbmd0aCxcblx0XHRcdFx0XHRcdFx0XHRpID0gLTEsXG5cdFx0XHRcdFx0XHRcdFx0c2l6ZSA9IDAsXG5cdFx0XHRcdFx0XHRcdFx0cmVhZCA9IDAsXG5cdFx0XHRcdFx0XHRcdFx0cG9vbDtcblx0XHRcdFx0XHRcdFx0dmFyIGUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgW2Vycm9yLCBsaXN0XSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0dmFyIG4gPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0KytpO1xuXHRcdFx0XHRcdFx0XHRcdGlmIChwb29sKVxuXHRcdFx0XHRcdFx0XHRcdFx0Y2xlYXJJbnRlcnZhbChwb29sKTtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mIHByb2dyZXNzID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0XHRcdFx0cHJvZ3Jlc3MuYXBwbHkobnVsbCwgW2kgLyB0b3RhbF0pO1xuXG5cdFx0XHRcdFx0XHRcdFx0dmFyIGl0ZW0gPSBsaXN0LnNoaWZ0KCk7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKGl0ZW0gPT0gbnVsbClcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBlKCk7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIGxvY2FsID0gc2VsZi5jbGllbnQudG9Mb2NhbChpdGVtLm5hbWUpO1xuXHRcdFx0XHRcdFx0XHRcdGlmIChpdGVtLnR5cGUgPT0gJ2QnIHx8IGl0ZW0udHlwZSA9PSAnbCcpIHtcblx0XHRcdFx0XHRcdFx0XHRcdC8vbWtkaXJwKGxvY2FsLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHQvL0ZTLm1ha2VUcmVlKGxvY2FsLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRGUy5tYWtlVHJlZVN5bmMobG9jYWwpO1xuXHRcdFx0XHRcdFx0XHRcdFx0bigpO1xuXHRcdFx0XHRcdFx0XHRcdFx0Ly9cdGlmIChlcnIpXG5cdFx0XHRcdFx0XHRcdFx0XHQvL1x0XHRlcnJvciA9IGVycjtcblx0XHRcdFx0XHRcdFx0XHRcdC8vXHRyZXR1cm4gbigpO1xuXHRcdFx0XHRcdFx0XHRcdFx0Ly99KTtcblx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0c2l6ZSA9IDA7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZWFkID0gMDtcblx0XHRcdFx0XHRcdFx0XHRcdHNlbGYub25jZSgnMTUwJywgZnVuY3Rpb24gKHJlcGx5KSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBzdHIgPSByZXBseS5tYXRjaCgvKFswLTldKylcXHMqKGJ5dGVzKS8pO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoc3RyKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0c2l6ZSA9IHBhcnNlSW50KHN0clsxXSwgMTApIHx8IC0xO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHBvb2wgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoIXNlbGYuZnRwLl9wYXN2U29ja2V0KSByZXR1cm47XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRyZWFkID0gc2VsZi5mdHAuX3Bhc3ZTb2NrZXQuYnl0ZXNSZWFkO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBwcm9ncmVzcyA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0cHJvZ3Jlc3MuYXBwbHkobnVsbCwgWyhpIC8gdG90YWwpICsgKHJlYWQgLyBzaXplIC8gdG90YWwpXSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fSwgMjUwKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRzZWxmLmZ0cC5nZXQoaXRlbS5uYW1lLCBmdW5jdGlvbiAoZXJyLCBzdHJlYW0pIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKGVycikge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGVycm9yID0gZXJyO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBuKCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIGRlc3QgPSBGUy5jcmVhdGVXcml0ZVN0cmVhbShsb2NhbCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGRlc3Qub24oJ3VucGlwZScsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gbigpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0ZGVzdC5vbignZXJyb3InLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIG4oKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHN0cmVhbS5waXBlKGRlc3QpO1xuXHRcdFx0XHRcdFx0XHRcdFx0fSlcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0bigpO1xuXHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0ZWxzZSB7XG5cdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFsnTm90IGNvbm5lY3RlZCddKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gc2VsZjtcblx0fVxuXG5cdENvbm5lY3RvckZUUC5wcm90b3R5cGUucHV0ID0gZnVuY3Rpb24gKHBhdGgsIGNvbXBsZXRlZCwgcHJvZ3Jlc3MpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRyZW1vdGUgPSBzZWxmLmNsaWVudC50b1JlbW90ZShwYXRoKTtcblxuXHRcdGlmIChzZWxmLmlzQ29ubmVjdGVkKCkpIHtcblx0XHRcdC8vIEZpbGVcblx0XHRcdGlmIChGUy5pc0ZpbGVTeW5jKHBhdGgpKSB7XG5cdFx0XHRcdHZhciBzdGF0cyA9IEZTLnN0YXRTeW5jKHBhdGgpLFxuXHRcdFx0XHRcdHNpemUgPSBzdGF0c1snc2l6ZSddLFxuXHRcdFx0XHRcdHdyaXR0ZW4gPSAwLFxuXHRcdFx0XHRcdHBvb2w7XG5cdFx0XHRcdHZhciBlID0gZnVuY3Rpb24gKGVycikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFtlcnIgPyBlcnIgOiBudWxsLCBbe25hbWU6IHBhdGgsIHR5cGU6ICdmJ31dXSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cG9vbCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRpZiAoIXNlbGYuZnRwLl9wYXN2U29ja2V0KSByZXR1cm47XG5cdFx0XHRcdFx0d3JpdHRlbiA9IHNlbGYuZnRwLl9wYXN2U29ja2V0LmJ5dGVzV3JpdHRlbjtcblx0XHRcdFx0XHRpZiAodHlwZW9mIHByb2dyZXNzID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0cHJvZ3Jlc3MuYXBwbHkobnVsbCwgW3dyaXR0ZW4gLyBzaXplXSk7XG5cdFx0XHRcdH0sIDI1MCk7XG5cdFx0XHRcdHNlbGYuZnRwLnB1dChwYXRoLCByZW1vdGUsIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRzZWxmLm1rZGlyKFBhdGguZGlybmFtZShyZW1vdGUpLnJlcGxhY2UoL1xcXFwvZywgJy8nKSwgdHJ1ZSwgZnVuY3Rpb24gKGVycikge1xuXHRcdFx0XHRcdFx0XHRzZWxmLmZ0cC5wdXQocGF0aCwgcmVtb3RlLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHBvb2wpXG5cdFx0XHRcdFx0XHRcdFx0XHRjbGVhckludGVydmFsKHBvb2wpO1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBlKGVycik7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmIChwb29sKVxuXHRcdFx0XHRcdFx0Y2xlYXJJbnRlcnZhbChwb29sKTtcblx0XHRcdFx0XHRyZXR1cm4gZSgpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gRm9sZGVyXG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0c2VsZi5jbGllbnQuX3RyYXZlcnNlVHJlZShwYXRoLCBmdW5jdGlvbiAobGlzdCkge1xuXHRcdFx0XHRcdHNlbGYubWtkaXIocmVtb3RlLCB0cnVlLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHR2YXIgZXJyb3IsXG5cdFx0XHRcdFx0XHRcdGkgPSAtMSxcblx0XHRcdFx0XHRcdFx0dG90YWwgPSBsaXN0Lmxlbmd0aCxcblx0XHRcdFx0XHRcdFx0c2l6ZSA9IDAsXG5cdFx0XHRcdFx0XHRcdHdyaXR0ZW4gPSAwLFxuXHRcdFx0XHRcdFx0XHRwb29sID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdGlmICghc2VsZi5mdHAuX3Bhc3ZTb2NrZXQpIHJldHVybjtcblx0XHRcdFx0XHRcdFx0XHR3cml0dGVuID0gc2VsZi5mdHAuX3Bhc3ZTb2NrZXQuYnl0ZXNXcml0dGVuO1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YgcHJvZ3Jlc3MgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRcdFx0XHRwcm9ncmVzcy5hcHBseShudWxsLCBbKGkgLyB0b3RhbCkgKyAod3JpdHRlbiAvIHNpemUgLyB0b3RhbCldKTtcblx0XHRcdFx0XHRcdFx0fSwgMjUwKTtcblx0XHRcdFx0XHRcdHZhciBlID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRpZiAocG9vbClcblx0XHRcdFx0XHRcdFx0XHRjbGVhckludGVydmFsKHBvb2wpO1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgW2Vycm9yLCBsaXN0XSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR2YXIgbiA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0aWYgKCsraSA+PSBsaXN0Lmxlbmd0aClcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZSgpO1xuXHRcdFx0XHRcdFx0XHR2YXIgaXRlbSA9IGxpc3RbaV0sXG5cdFx0XHRcdFx0XHRcdFx0cmVtb3RlID0gc2VsZi5jbGllbnQudG9SZW1vdGUoaXRlbS5uYW1lKTtcblx0XHRcdFx0XHRcdFx0aWYgKGl0ZW0udHlwZSA9PSAnZCcgfHwgaXRlbS50eXBlID09ICdsJykge1xuXHRcdFx0XHRcdFx0XHRcdHNlbGYuZnRwLm1rZGlyKHJlbW90ZSwgZnVuY3Rpb24gKGVycikge1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKGVycilcblx0XHRcdFx0XHRcdFx0XHRcdFx0ZXJyb3IgPSBlcnI7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gbigpO1xuXHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdHZhciBzdGF0cyA9IEZTLnN0YXRTeW5jKGl0ZW0ubmFtZSk7XG5cdFx0XHRcdFx0XHRcdFx0c2l6ZSA9IHN0YXRzWydzaXplJ107XG5cdFx0XHRcdFx0XHRcdFx0d3JpdHRlbiA9IDA7XG5cdFx0XHRcdFx0XHRcdFx0c2VsZi5mdHAucHV0KGl0ZW0ubmFtZSwgcmVtb3RlLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoZXJyKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRlcnJvciA9IGVycjtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBuKCk7XG5cdFx0XHRcdFx0XHRcdFx0fSlcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIG4oKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGVsc2Uge1xuXHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbJ05vdCBjb25uZWN0ZWQnXSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHNlbGY7XG5cdH1cblxuXHRDb25uZWN0b3JGVFAucHJvdG90eXBlLm1rZGlyID0gZnVuY3Rpb24gKHBhdGgsIHJlY3Vyc2l2ZSwgY29tcGxldGVkKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0cmVtb3RlcyA9IHBhdGgucmVwbGFjZSgvXlxcLysvLCAnJykucmVwbGFjZSgvXFwvKyQvLCAnJykuc3BsaXQoJy8nKSxcblx0XHRcdGRpcnMgPSBbJy8nICsgcmVtb3Rlcy5zbGljZSgwLCByZW1vdGVzLmxlbmd0aCkuam9pbignLycpXTtcblxuXHRcdGlmIChzZWxmLmlzQ29ubmVjdGVkKCkpIHtcblx0XHRcdGlmIChyZWN1cnNpdmUpIHtcblx0XHRcdFx0Zm9yICh2YXIgYSA9IHJlbW90ZXMubGVuZ3RoIC0gMTsgYSA+IDA7IC0tYSlcblx0XHRcdFx0XHRkaXJzLnVuc2hpZnQoJy8nICsgcmVtb3Rlcy5zbGljZSgwLCBhKS5qb2luKCcvJykpO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgbiA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0dmFyIGRpciA9IGRpcnMuc2hpZnQoKSxcblx0XHRcdFx0XHRsYXN0ID0gZGlycy5sZW5ndGggPT0gMDtcblxuXHRcdFx0XHRzZWxmLmZ0cC5ta2RpcihkaXIsIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0XHRpZiAobGFzdCkge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbZXJyID8gZXJyIDogbnVsbF0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gbigpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHRuKCk7XG5cdFx0fVxuXHRcdGVsc2Uge1xuXHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbJ05vdCBjb25uZWN0ZWQnXSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHNlbGY7XG5cdH1cblxuXHRDb25uZWN0b3JGVFAucHJvdG90eXBlLm1rZmlsZSA9IGZ1bmN0aW9uIChwYXRoLCBjb21wbGV0ZWQpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRsb2NhbCA9IHNlbGYuY2xpZW50LnRvTG9jYWwocGF0aCksXG5cdFx0XHRlbXB0eSA9IG5ldyBCdWZmZXIoJycsICd1dGY4Jyk7XG5cblx0XHRpZiAoc2VsZi5pc0Nvbm5lY3RlZCgpKSB7XG5cdFx0XHRzZWxmLmZ0cC5wdXQoZW1wdHksIHBhdGgsIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0aWYgKGVycikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFtlcnJdKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdFx0Ly9ta2RpcnAoUGF0aC5kaXJuYW1lKGxvY2FsKSwgZnVuY3Rpb24gKGVycjEpIHtcblx0XHRcdFx0Ly9GUy5tYWtlVHJlZShQYXRoLmRpcm5hbWUobG9jYWwpLCBmdW5jdGlvbiAoZXJyMSkge1xuXHRcdFx0XHRGUy5tYWtlVHJlZVN5bmMoUGF0aC5kaXJuYW1lKGxvY2FsKSk7XG5cdFx0XHRcdEZTLndyaXRlRmlsZShsb2NhbCwgZW1wdHksIGZ1bmN0aW9uIChlcnIyKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgW2VycjJdKTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdC8vfSk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0ZWxzZSB7XG5cdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFsnTm90IGNvbm5lY3RlZCddKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gc2VsZjtcblx0fVxuXG5cdENvbm5lY3RvckZUUC5wcm90b3R5cGUucmVuYW1lID0gZnVuY3Rpb24gKHNvdXJjZSwgZGVzdCwgY29tcGxldGVkKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0aWYgKHNlbGYuaXNDb25uZWN0ZWQoKSkge1xuXHRcdFx0c2VsZi5mdHAucmVuYW1lKHNvdXJjZSwgZGVzdCwgZnVuY3Rpb24gKGVycikge1xuXHRcdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgW2Vycl0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdEZTLnJlbmFtZShzZWxmLmNsaWVudC50b0xvY2FsKHNvdXJjZSksIHNlbGYuY2xpZW50LnRvTG9jYWwoZGVzdCksIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgW2Vycl0pO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0ZWxzZSB7XG5cdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFsnTm90IGNvbm5lY3RlZCddKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gc2VsZjtcblx0fVxuXG5cdENvbm5lY3RvckZUUC5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24gKHBhdGgsIGNvbXBsZXRlZCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdGlmIChzZWxmLmlzQ29ubmVjdGVkKCkpIHtcblx0XHRcdHNlbGYuZnRwLmN3ZChwYXRoLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdHNlbGYuZnRwLmN3ZCgnLycsIGZ1bmN0aW9uICgpIHtcblxuXHRcdFx0XHRcdC8vIEZpbGVcblx0XHRcdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRzZWxmLmZ0cC5kZWxldGUocGF0aCwgZnVuY3Rpb24gKGVycikge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgW2VyciwgW3tuYW1lOiBwYXRoLCB0eXBlOiAnZid9XV0pO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gRm9sZGVyXG5cdFx0XHRcdFx0ZWxzZSB7XG5cdFx0XHRcdFx0XHRzZWxmLmxpc3QocGF0aCwgdHJ1ZSwgZnVuY3Rpb24gKGVyciwgbGlzdCkge1xuXHRcdFx0XHRcdFx0XHRsaXN0LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsgaXRlbS5kZXB0aCA9IGl0ZW0ubmFtZS5yZXBsYWNlKC9eXFwvKy8sICcnKS5yZXBsYWNlKC9cXC8rJC8pLnNwbGl0KCcvJykubGVuZ3RoOyB9KTtcblx0XHRcdFx0XHRcdFx0bGlzdC5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKGEuZGVwdGggPT0gYi5kZXB0aClcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiAwO1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBhLmRlcHRoID4gYi5kZXB0aCA/IC0xIDogMTtcblx0XHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdFx0dmFyIGRvbmUgPSAwO1xuXG5cdFx0XHRcdFx0XHRcdHZhciBlID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdHNlbGYuZnRwLnJtZGlyKHBhdGgsIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgW2VyciwgbGlzdF0pO1xuXHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdGxpc3QuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0XHRcdFx0XHRcdCsrZG9uZTtcblx0XHRcdFx0XHRcdFx0XHR2YXIgZm4gPSBpdGVtLnR5cGUgPT0gJ2QnIHx8IGl0ZW0udHlwZSA9PSAnbCcgPyAncm1kaXInIDogJ2RlbGV0ZSc7XG5cdFx0XHRcdFx0XHRcdFx0c2VsZi5mdHBbZm5dKGl0ZW0ubmFtZSwgZnVuY3Rpb24gKGVycikge1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKC0tZG9uZSA9PSAwKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZSgpO1xuXHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0aWYgKGxpc3QubGVuZ3RoID09IDApXG5cdFx0XHRcdFx0XHRcdFx0ZSgpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH1cblx0XHRlbHNlIHtcblx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgWydOb3QgY29ubmVjdGVkJ10pO1xuXHRcdH1cblxuXHRcdHJldHVybiBzZWxmO1xuXHR9XG5cblx0cmV0dXJuIENvbm5lY3RvckZUUDtcbn0pKCk7XG4iXX0=