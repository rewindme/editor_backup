var __hasProp = ({}).hasOwnProperty,
    __extends = function __extends(child, parent) {
	for (var key in parent) {
		if (__hasProp.call(parent, key)) child[key] = parent[key];
	}function ctor() {
		this.constructor = child;
	}ctor.prototype = parent.prototype;child.prototype = new ctor();child.__super__ = parent.prototype;return child;
},
    FS = require('fs-plus'),
    Path = require('path'),
    FTP = require('ftp'),
    Connector = require('../connector');

module.exports = (function () {
	__extends(ConnectorFTP, Connector);

	function ConnectorFTP() {
		ConnectorFTP.__super__.constructor.apply(this, arguments);
		this.ftp = null;
	}

	ConnectorFTP.prototype.isConnected = function () {
		return this.ftp && this.ftp.connected;
	};

	ConnectorFTP.prototype.connect = function (info, completed) {
		var self = this;

		self.info = info;

		self.ftp = new FTP();
		self.ftp.on('greeting', function (msg) {
			self.emit('greeting', msg);
		});
		self.ftp.on('ready', function () {
			self.emit('connected');

			if (typeof completed === 'function') completed.apply(self, []);
		});
		/*self.ftp.on('close', function () {
  	self.emit('closed');
  });*/
		self.ftp.on('end', function () {
			self.emit('ended');
		});
		self.ftp.on('error', function (err) {
			self.emit('error', err);
		});
		self.info._debug = self.info.debug;
		self.info.debug = function (str) {
			var log = str.match(/^\[connection\] (>|<) '(.*?)(\\r\\n)?'$/);
			if (!log || log[1] != '<') return;

			var reply = log[2].match(/^[0-9]+/);
			if (reply) self.emit(reply[0], log[2]);

			if (typeof self.info._debug == 'function') self.info._debug.apply(null, [str]);
		};
		self.ftp.connect(self.info);

		return self;
	};

	ConnectorFTP.prototype.disconnect = function (completed) {
		var self = this;

		if (self.ftp) {
			self.ftp.destroy();
			self.ftp = null;
		}

		if (typeof completed === 'function') completed.apply(null, []);

		return self;
	};

	ConnectorFTP.prototype.abort = function (completed) {
		var self = this;

		if (self.isConnected()) {
			self.ftp.abort(function () {
				if (typeof completed === 'function') completed.apply(null, []);
			});
		} else {
			if (typeof completed === 'function') completed.apply(null, []);
		}

		return self;
	};

	ConnectorFTP.prototype.list = function (path, recursive, completed) {
		var self = this;

		if (self.isConnected()) {

			if (recursive) {
				var digg = 0,
				    list = [];

				var e = function e() {
					if (typeof completed === 'function') completed.apply(null, [null, list]);
				};
				var l = function l(p) {
					++digg;
					self.ftp.list(p, function (err, lis) {
						if (err) return e();

						lis.forEach(function (item) {
							if (item.name == '.' || item.name == '..') return;

							list.push(item);
							if (item.type == 'd' || item.type == 'l') {
								l(item.name);
							} else {
								item.type = 'f';
							}
						});

						if (--digg == 0) e();
					});
				};
				l(path);
			} else {
				self.ftp.list(path, function (err, lis) {
					var list = [];

					if (!err) {
						lis.forEach(function (item) {
							if (item.type == 'd' || item.type == 'l') {
								if (item.name != '.' && item.name != '..') list.push(item);
							} else {
								item.type = 'f';
								list.push(item);
							}
						});
					}

					if (typeof completed === 'function') completed.apply(null, [err, list]);
				});
			}
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return this;
	};

	ConnectorFTP.prototype.get = function (path, recursive, completed, progress) {
		var self = this,
		    local = self.client.toLocal(path);

		if (self.isConnected()) {
			self.ftp.cwd(path, function (err) {
				self.ftp.cwd('/', function () {

					// File
					if (err) {
						FS.makeTreeSync(Path.dirname(local));
						var size = -1,
						    pool;
						self.once('150', function (reply) {
							var str = reply.match(/([0-9]+)\s*(bytes)/);
							if (str) {
								size = parseInt(str[1], 10) || -1;
								pool = setInterval(function () {
									if (!self.ftp._pasvSocket) return;
									var read = self.ftp._pasvSocket.bytesRead;
									if (typeof progress === 'function') progress.apply(null, [read / size]);
								}, 250);
							}
						});
						self.ftp.get(path, function (err, stream) {
							if (err) {
								if (pool) clearInterval(pool);
								if (typeof completed === 'function') completed.apply(null, [err]);
								return;
							}

							var dest = FS.createWriteStream(local);
							dest.on('unpipe', function () {
								if (pool) clearInterval(pool);
								if (typeof completed === 'function') completed.apply(null, []);
							});
							dest.on('error', function (err) {
								if (pool) clearInterval(pool);
								if (typeof completed === 'function') completed.apply(null, [err]);
							});
							stream.pipe(dest);
						});
					}

					// Folder
					else {

						self.list(path, recursive, function (err, list) {

							list.unshift({ name: path, type: 'd' });
							list.forEach(function (item) {
								item.depth = item.name.replace(/^\/+/, '').replace(/\/+$/).split('/').length;
							});
							list.sort(function (a, b) {
								if (a.depth == b.depth) return 0;
								return a.depth > b.depth ? 1 : -1;
							});

							var error = null,
							    total = list.length,
							    i = -1,
							    size = 0,
							    read = 0,
							    pool;
							var e = function e() {
								if (typeof completed === 'function') completed.apply(null, [error, list]);
							};
							var n = function n() {
								++i;
								if (pool) clearInterval(pool);
								if (typeof progress === 'function') progress.apply(null, [i / total]);

								var item = list.shift();
								if (item == null) return e();
								var local = self.client.toLocal(item.name);
								if (item.type == 'd' || item.type == 'l') {
									//mkdirp(local, function (err) {
									//FS.makeTree(local, function (err) {
									FS.makeTreeSync(local);
									n();
									//	if (err)
									//		error = err;
									//	return n();
									//});
								} else {
									size = 0;
									read = 0;
									self.once('150', function (reply) {
										var str = reply.match(/([0-9]+)\s*(bytes)/);
										if (str) {
											size = parseInt(str[1], 10) || -1;
											pool = setInterval(function () {
												if (!self.ftp._pasvSocket) return;
												read = self.ftp._pasvSocket.bytesRead;
												if (typeof progress === 'function') progress.apply(null, [i / total + read / size / total]);
											}, 250);
										}
									});
									self.ftp.get(item.name, function (err, stream) {
										if (err) {
											error = err;
											return n();
										}
										var dest = FS.createWriteStream(local);
										dest.on('unpipe', function () {
											return n();
										});
										dest.on('error', function (err) {
											return n();
										});
										stream.pipe(dest);
									});
								}
							};
							n();
						});
					}
				});
			});
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return self;
	};

	ConnectorFTP.prototype.put = function (path, completed, progress) {
		var self = this,
		    remote = self.client.toRemote(path);

		if (self.isConnected()) {
			// File
			if (FS.isFileSync(path)) {
				var stats = FS.statSync(path),
				    size = stats['size'],
				    written = 0,
				    pool;
				var e = function e(err) {
					if (typeof completed === 'function') completed.apply(null, [err ? err : null, [{ name: path, type: 'f' }]]);
				};
				pool = setInterval(function () {
					if (!self.ftp._pasvSocket) return;
					written = self.ftp._pasvSocket.bytesWritten;
					if (typeof progress === 'function') progress.apply(null, [written / size]);
				}, 250);
				self.ftp.put(path, remote, function (err) {
					if (err) {
						self.mkdir(Path.dirname(remote).replace(/\\/g, '/'), true, function (err) {
							self.ftp.put(path, remote, function (err) {
								if (pool) clearInterval(pool);
								return e(err);
							});
						});
						return;
					}
					if (pool) clearInterval(pool);
					return e();
				});
			}

			// Folder
			else {
				self.client._traverseTree(path, function (list) {
					self.mkdir(remote, true, function (err) {
						var error,
						    i = -1,
						    total = list.length,
						    size = 0,
						    written = 0,
						    pool = setInterval(function () {
							if (!self.ftp._pasvSocket) return;
							written = self.ftp._pasvSocket.bytesWritten;
							if (typeof progress === 'function') progress.apply(null, [i / total + written / size / total]);
						}, 250);
						var e = function e() {
							if (pool) clearInterval(pool);
							if (typeof completed === 'function') completed.apply(null, [error, list]);
						};
						var n = function n() {
							if (++i >= list.length) return e();
							var item = list[i],
							    remote = self.client.toRemote(item.name);
							if (item.type == 'd' || item.type == 'l') {
								self.ftp.mkdir(remote, function (err) {
									if (err) error = err;
									return n();
								});
							} else {
								var stats = FS.statSync(item.name);
								size = stats['size'];
								written = 0;
								self.ftp.put(item.name, remote, function (err) {
									if (err) error = err;
									return n();
								});
							}
						};
						return n();
					});
				});
			}
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return self;
	};

	ConnectorFTP.prototype.mkdir = function (path, recursive, completed) {
		var self = this,
		    remotes = path.replace(/^\/+/, '').replace(/\/+$/, '').split('/'),
		    dirs = ['/' + remotes.slice(0, remotes.length).join('/')];

		if (self.isConnected()) {
			if (recursive) {
				for (var a = remotes.length - 1; a > 0; --a) dirs.unshift('/' + remotes.slice(0, a).join('/'));
			}

			var n = function n() {
				var dir = dirs.shift(),
				    last = dirs.length == 0;

				self.ftp.mkdir(dir, function (err) {
					if (last) {
						if (typeof completed === 'function') completed.apply(null, [err ? err : null]);
					} else {
						return n();
					}
				});
			};
			n();
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return self;
	};

	ConnectorFTP.prototype.mkfile = function (path, completed) {
		var self = this,
		    local = self.client.toLocal(path),
		    empty = new Buffer('', 'utf8');

		if (self.isConnected()) {
			self.ftp.put(empty, path, function (err) {
				if (err) {
					if (typeof completed === 'function') completed.apply(null, [err]);
					return;
				}
				//mkdirp(Path.dirname(local), function (err1) {
				//FS.makeTree(Path.dirname(local), function (err1) {
				FS.makeTreeSync(Path.dirname(local));
				FS.writeFile(local, empty, function (err2) {
					if (typeof completed === 'function') completed.apply(null, [err2]);
				});
				//});
			});
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return self;
	};

	ConnectorFTP.prototype.rename = function (source, dest, completed) {
		var self = this;

		if (self.isConnected()) {
			self.ftp.rename(source, dest, function (err) {
				if (err) {
					if (typeof completed === 'function') completed.apply(null, [err]);
				} else {
					FS.rename(self.client.toLocal(source), self.client.toLocal(dest), function (err) {
						if (typeof completed === 'function') completed.apply(null, [err]);
					});
				}
			});
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return self;
	};

	ConnectorFTP.prototype['delete'] = function (path, completed) {
		var self = this;

		if (self.isConnected()) {
			self.ftp.cwd(path, function (err) {
				self.ftp.cwd('/', function () {

					// File
					if (err) {
						self.ftp['delete'](path, function (err) {
							if (typeof completed === 'function') completed.apply(null, [err, [{ name: path, type: 'f' }]]);
						});
					}

					// Folder
					else {
						self.list(path, true, function (err, list) {
							list.forEach(function (item) {
								item.depth = item.name.replace(/^\/+/, '').replace(/\/+$/).split('/').length;
							});
							list.sort(function (a, b) {
								if (a.depth == b.depth) return 0;
								return a.depth > b.depth ? -1 : 1;
							});

							var done = 0;

							var e = function e() {
								self.ftp.rmdir(path, function (err) {
									if (typeof completed === 'function') completed.apply(null, [err, list]);
								});
							};
							list.forEach(function (item) {
								++done;
								var fn = item.type == 'd' || item.type == 'l' ? 'rmdir' : 'delete';
								self.ftp[fn](item.name, function (err) {
									if (--done == 0) return e();
								});
							});
							if (list.length == 0) e();
						});
					}
				});
			});
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return self;
	};

	return ConnectorFTP;
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9uYXZlci8uYXRvbS9wYWNrYWdlcy9yZW1vdGUtZnRwL2xpYi9jb25uZWN0b3JzL2Z0cC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFJLFNBQVMsR0FBRyxDQUFBLEdBQUUsQ0FBQyxjQUFjO0lBQ2hDLFNBQVMsR0FBRyxTQUFaLFNBQVMsQ0FBWSxLQUFLLEVBQUUsTUFBTSxFQUFFO0FBQUUsTUFBSyxJQUFJLEdBQUcsSUFBSSxNQUFNLEVBQUU7QUFBRSxNQUFJLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxFQUFFLEtBQUssQ0FBQyxHQUFHLENBQUMsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7RUFBRSxBQUFDLFNBQVMsSUFBSSxHQUFHO0FBQUUsTUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUM7RUFBRSxBQUFDLElBQUksQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxBQUFDLEtBQUssQ0FBQyxTQUFTLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxBQUFDLEtBQUssQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxBQUFDLE9BQU8sS0FBSyxDQUFDO0NBQUU7SUFDL1IsRUFBRSxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUM7SUFDdkIsSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUM7SUFDdEIsR0FBRyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUM7SUFDcEIsU0FBUyxHQUFHLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQzs7QUFHckMsTUFBTSxDQUFDLE9BQU8sR0FBRyxDQUFDLFlBQVk7QUFDN0IsVUFBUyxDQUFDLFlBQVksRUFBRSxTQUFTLENBQUMsQ0FBQzs7QUFFbkMsVUFBUyxZQUFZLEdBQUk7QUFDeEIsY0FBWSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQztBQUMxRCxNQUFJLENB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LElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLElBQUksR0FBRyxHQUFHLE9BQU8sR0FBRyxRQUFRLENBQUM7QUFDbkUsWUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLFVBQVUsR0FBRyxFQUFFO0FBQ3RDLGFBQUksRUFBRSxJQUFJLElBQUksQ0FBQyxFQUNkLE9BQU8sQ0FBQyxFQUFFLENBQUM7U0FDWixDQUFDLENBQUM7UUFDSCxDQUFDLENBQUM7QUFDSCxXQUFJLElBQUksQ0FBQyxNQUFNLElBQUksQ0FBQyxFQUNuQixDQUFDLEVBQUUsQ0FBQztPQUNMLENBQUMsQ0FBQztNQUNIO0tBQ0QsQ0FBQyxDQUFDO0lBQ0gsQ0FBQyxDQUFDO0dBQ0gsTUFDSTtBQUNKLE9BQUksT0FBTyxTQUFTLEtBQUssVUFBVSxFQUNsQyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUM7R0FDMUM7O0FBRUQsU0FBTyxJQUFJLENBQUM7RUFDWixDQUFBOztBQUVELFFBQU8sWUFBWSxDQUFDO0NBQ3BCLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6Ii9Vc2Vycy9uYXZlci8uYXRvbS9wYWNrYWdlcy9yZW1vdGUtZnRwL2xpYi9jb25uZWN0b3JzL2Z0cC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcblx0X19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH0sXG5cdEZTID0gcmVxdWlyZSgnZnMtcGx1cycpLFxuXHRQYXRoID0gcmVxdWlyZSgncGF0aCcpLFxuXHRGVFAgPSByZXF1aXJlKCdmdHAnKSxcblx0Q29ubmVjdG9yID0gcmVxdWlyZSgnLi4vY29ubmVjdG9yJyk7XG5cblxubW9kdWxlLmV4cG9ydHMgPSAoZnVuY3Rpb24gKCkge1xuXHRfX2V4dGVuZHMoQ29ubmVjdG9yRlRQLCBDb25uZWN0b3IpO1xuXG5cdGZ1bmN0aW9uIENvbm5lY3RvckZUUCAoKSB7XG5cdFx0Q29ubmVjdG9yRlRQLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuXHRcdHRoaXMuZnRwID0gbnVsbDtcblx0fVxuXG5cdENvbm5lY3RvckZUUC5wcm90b3R5cGUuaXNDb25uZWN0ZWQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuIHRoaXMuZnRwICYmIHRoaXMuZnRwLmNvbm5lY3RlZDtcblx0fTtcblxuXHRDb25uZWN0b3JGVFAucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiAoaW5mbywgY29tcGxldGVkKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0c2VsZi5pbmZvID0gaW5mbztcblxuXHRcdHNlbGYuZnRwID0gbmV3IEZUUCgpO1xuXHRcdHNlbGYuZnRwLm9uKCdncmVldGluZycsIGZ1bmN0aW9uIChtc2cpIHtcblx0XHRcdHNlbGYuZW1pdCgnZ3JlZXRpbmcnLCBtc2cpO1xuXHRcdH0pO1xuXHRcdHNlbGYuZnRwLm9uKCdyZWFkeScsIGZ1bmN0aW9uICgpIHtcblx0XHRcdHNlbGYuZW1pdCgnY29ubmVjdGVkJyk7XG5cblx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkoc2VsZiwgW10pO1xuXHRcdH0pO1xuXHRcdC8qc2VsZi5mdHAub24oJ2Nsb3NlJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0c2VsZi5lbWl0KCdjbG9zZWQnKTtcblx0XHR9KTsqL1xuXHRcdHNlbGYuZnRwLm9uKCdlbmQnLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRzZWxmLmVtaXQoJ2VuZGVkJyk7XG5cdFx0fSk7XG5cdFx0c2VsZi5mdHAub24oJ2Vycm9yJywgZnVuY3Rpb24gKGVycikge1xuXHRcdFx0c2VsZi5lbWl0KCdlcnJvcicsIGVycik7XG5cdFx0fSk7XG5cdFx0c2VsZi5pbmZvLl9kZWJ1ZyA9IHNlbGYuaW5mby5kZWJ1Zztcblx0XHRzZWxmLmluZm8uZGVidWcgPSBmdW5jdGlvbiAoc3RyKSB7XG5cdFx0XHR2YXIgbG9nID0gc3RyLm1hdGNoKC9eXFxbY29ubmVjdGlvblxcXSAoPnw8KSAnKC4qPykoXFxcXHJcXFxcbik/JyQvKTtcblx0XHRcdGlmICghbG9nIHx8IGxvZ1sxXSAhPSAnPCcpIHJldHVybjtcblxuXHRcdFx0dmFyIHJlcGx5ID0gbG9nWzJdLm1hdGNoKC9eWzAtOV0rLyk7XG5cdFx0XHRpZiAocmVwbHkpXG5cdFx0XHRcdHNlbGYuZW1pdChyZXBseVswXSwgbG9nWzJdKTtcblxuXHRcdFx0aWYgKHR5cGVvZiBzZWxmLmluZm8uX2RlYnVnID09ICdmdW5jdGlvbicpXG5cdFx0XHRcdHNlbGYuaW5mby5fZGVidWcuYXBwbHkobnVsbCwgW3N0cl0pO1xuXHRcdH1cblx0XHRzZWxmLmZ0cC5jb25uZWN0KHNlbGYuaW5mbyk7XG5cblx0XHRyZXR1cm4gc2VsZjtcblx0fVxuXG5cdENvbm5lY3RvckZUUC5wcm90b3R5cGUuZGlzY29ubmVjdCA9IGZ1bmN0aW9uIChjb21wbGV0ZWQpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRpZiAoc2VsZi5mdHApIHtcblx0XHRcdHNlbGYuZnRwLmRlc3Ryb3koKTtcblx0XHRcdHNlbGYuZnRwID0gbnVsbDtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbXSk7XG5cblx0XHRyZXR1cm4gc2VsZjtcblx0fVxuXG5cdENvbm5lY3RvckZUUC5wcm90b3R5cGUuYWJvcnQgPSBmdW5jdGlvbiAoY29tcGxldGVkKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0aWYgKHNlbGYuaXNDb25uZWN0ZWQoKSkge1xuXHRcdFx0c2VsZi5mdHAuYWJvcnQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgW10pO1xuXHRcdFx0fSlcblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbXSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHNlbGY7XG5cdH1cblxuXHRDb25uZWN0b3JGVFAucHJvdG90eXBlLmxpc3QgPSBmdW5jdGlvbiAocGF0aCwgcmVjdXJzaXZlLCBjb21wbGV0ZWQpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRpZiAoc2VsZi5pc0Nvbm5lY3RlZCgpKSB7XG5cblx0XHRcdGlmIChyZWN1cnNpdmUpIHtcblx0XHRcdFx0dmFyIGRpZ2cgPSAwLFxuXHRcdFx0XHRcdGxpc3QgPSBbXTtcblxuXHRcdFx0XHR2YXIgZSA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbbnVsbCwgbGlzdF0pO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHZhciBsID0gZnVuY3Rpb24gKHApIHtcblx0XHRcdFx0XHQrK2RpZ2c7XG5cdFx0XHRcdFx0c2VsZi5mdHAubGlzdChwLCBmdW5jdGlvbiAoZXJyLCBsaXMpIHtcblx0XHRcdFx0XHRcdGlmIChlcnIpXG5cdFx0XHRcdFx0XHRcdHJldHVybiBlKCk7XG5cblx0XHRcdFx0XHRcdGxpcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChpdGVtLm5hbWUgPT0gJy4nIHx8IGl0ZW0ubmFtZSA9PSAnLi4nKVxuXHRcdFx0XHRcdFx0XHRcdHJldHVybjtcblxuXHRcdFx0XHRcdFx0XHRsaXN0LnB1c2goaXRlbSk7XG5cdFx0XHRcdFx0XHRcdGlmIChpdGVtLnR5cGUgPT0gJ2QnIHx8IGl0ZW0udHlwZSA9PSAnbCcpIHtcblx0XHRcdFx0XHRcdFx0XHRsKGl0ZW0ubmFtZSk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0aXRlbS50eXBlID0gJ2YnO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0aWYgKC0tZGlnZyA9PSAwKVxuXHRcdFx0XHRcdFx0XHRlKCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0bChwYXRoKTtcblx0XHRcdH1cblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRzZWxmLmZ0cC5saXN0KHBhdGgsIGZ1bmN0aW9uIChlcnIsIGxpcykge1xuXHRcdFx0XHRcdHZhciBsaXN0ID0gW107XG5cblx0XHRcdFx0XHRpZiAoIWVycikge1xuXHRcdFx0XHRcdFx0bGlzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdFx0XHRcdFx0aWYgKGl0ZW0udHlwZSA9PSAnZCcgfHwgaXRlbS50eXBlID09ICdsJykge1xuXHRcdFx0XHRcdFx0XHRcdGlmIChpdGVtLm5hbWUgIT0gJy4nICYmIGl0ZW0ubmFtZSAhPSAnLi4nKVxuXHRcdFx0XHRcdFx0XHRcdFx0bGlzdC5wdXNoKGl0ZW0pO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdGl0ZW0udHlwZSA9ICdmJztcblx0XHRcdFx0XHRcdFx0XHRsaXN0LnB1c2goaXRlbSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFtlcnIsIGxpc3RdKTtcblx0XHRcdFx0fSlcblx0XHRcdH1cblxuXHRcdH1cblx0XHRlbHNlIHtcblx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgWydOb3QgY29ubmVjdGVkJ10pO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0Q29ubmVjdG9yRlRQLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAocGF0aCwgcmVjdXJzaXZlLCBjb21wbGV0ZWQsIHByb2dyZXNzKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0bG9jYWwgPSBzZWxmLmNsaWVudC50b0xvY2FsKHBhdGgpO1xuXG5cdFx0aWYgKHNlbGYuaXNDb25uZWN0ZWQoKSkge1xuXHRcdFx0c2VsZi5mdHAuY3dkKHBhdGgsIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0c2VsZi5mdHAuY3dkKCcvJywgZnVuY3Rpb24gKCkge1xuXG5cdFx0XHRcdFx0Ly8gRmlsZVxuXHRcdFx0XHRcdGlmIChlcnIpIHtcblx0XHRcdFx0XHRcdEZTLm1ha2VUcmVlU3luYyhQYXRoLmRpcm5hbWUobG9jYWwpKTtcblx0XHRcdFx0XHRcdHZhciBzaXplID0gLTEsIHBvb2w7XG5cdFx0XHRcdFx0XHRzZWxmLm9uY2UoJzE1MCcsIGZ1bmN0aW9uIChyZXBseSkge1xuXHRcdFx0XHRcdFx0XHR2YXIgc3RyID0gcmVwbHkubWF0Y2goLyhbMC05XSspXFxzKihieXRlcykvKTtcblx0XHRcdFx0XHRcdFx0aWYgKHN0cikge1xuXHRcdFx0XHRcdFx0XHRcdHNpemUgPSBwYXJzZUludChzdHJbMV0sIDEwKSB8fCAtMTtcblx0XHRcdFx0XHRcdFx0XHRwb29sID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKCFzZWxmLmZ0cC5fcGFzdlNvY2tldCkgcmV0dXJuO1xuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIHJlYWQgPSBzZWxmLmZ0cC5fcGFzdlNvY2tldC5ieXRlc1JlYWQ7XG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mIHByb2dyZXNzID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRwcm9ncmVzcy5hcHBseShudWxsLCBbcmVhZCAvIHNpemVdKTtcblx0XHRcdFx0XHRcdFx0XHR9LCAyNTApO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdHNlbGYuZnRwLmdldChwYXRoLCBmdW5jdGlvbiAoZXJyLCBzdHJlYW0pIHtcblx0XHRcdFx0XHRcdFx0aWYgKGVycikge1xuXHRcdFx0XHRcdFx0XHRcdGlmIChwb29sKVxuXHRcdFx0XHRcdFx0XHRcdFx0Y2xlYXJJbnRlcnZhbChwb29sKTtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbZXJyXSk7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0dmFyIGRlc3QgPSBGUy5jcmVhdGVXcml0ZVN0cmVhbShsb2NhbCk7XG5cdFx0XHRcdFx0XHRcdGRlc3Qub24oJ3VucGlwZScsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAocG9vbClcblx0XHRcdFx0XHRcdFx0XHRcdGNsZWFySW50ZXJ2YWwocG9vbCk7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgW10pO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0ZGVzdC5vbignZXJyb3InLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHBvb2wpXG5cdFx0XHRcdFx0XHRcdFx0XHRjbGVhckludGVydmFsKHBvb2wpO1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFtlcnJdKTtcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdHN0cmVhbS5waXBlKGRlc3QpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gRm9sZGVyXG5cdFx0XHRcdFx0ZWxzZSB7XG5cblx0XHRcdFx0XHRcdHNlbGYubGlzdChwYXRoLCByZWN1cnNpdmUsIGZ1bmN0aW9uIChlcnIsIGxpc3QpIHtcblxuXHRcdFx0XHRcdFx0XHRsaXN0LnVuc2hpZnQoe25hbWU6IHBhdGgsIHR5cGU6ICdkJ30pO1xuXHRcdFx0XHRcdFx0XHRsaXN0LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsgaXRlbS5kZXB0aCA9IGl0ZW0ubmFtZS5yZXBsYWNlKC9eXFwvKy8sICcnKS5yZXBsYWNlKC9cXC8rJC8pLnNwbGl0KCcvJykubGVuZ3RoOyB9KTtcblx0XHRcdFx0XHRcdFx0bGlzdC5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKGEuZGVwdGggPT0gYi5kZXB0aClcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiAwO1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBhLmRlcHRoID4gYi5kZXB0aCA/IDEgOiAtMTtcblx0XHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdFx0dmFyIGVycm9yID0gbnVsbCxcblx0XHRcdFx0XHRcdFx0XHR0b3RhbCA9IGxpc3QubGVuZ3RoLFxuXHRcdFx0XHRcdFx0XHRcdGkgPSAtMSxcblx0XHRcdFx0XHRcdFx0XHRzaXplID0gMCxcblx0XHRcdFx0XHRcdFx0XHRyZWFkID0gMCxcblx0XHRcdFx0XHRcdFx0XHRwb29sO1xuXHRcdFx0XHRcdFx0XHR2YXIgZSA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbZXJyb3IsIGxpc3RdKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR2YXIgbiA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHQrK2k7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHBvb2wpXG5cdFx0XHRcdFx0XHRcdFx0XHRjbGVhckludGVydmFsKHBvb2wpO1xuXHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YgcHJvZ3Jlc3MgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRcdFx0XHRwcm9ncmVzcy5hcHBseShudWxsLCBbaSAvIHRvdGFsXSk7XG5cblx0XHRcdFx0XHRcdFx0XHR2YXIgaXRlbSA9IGxpc3Quc2hpZnQoKTtcblx0XHRcdFx0XHRcdFx0XHRpZiAoaXRlbSA9PSBudWxsKVxuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGUoKTtcblx0XHRcdFx0XHRcdFx0XHR2YXIgbG9jYWwgPSBzZWxmLmNsaWVudC50b0xvY2FsKGl0ZW0ubmFtZSk7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKGl0ZW0udHlwZSA9PSAnZCcgfHwgaXRlbS50eXBlID09ICdsJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0Ly9ta2RpcnAobG9jYWwsIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdC8vRlMubWFrZVRyZWUobG9jYWwsIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdEZTLm1ha2VUcmVlU3luYyhsb2NhbCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRuKCk7XG5cdFx0XHRcdFx0XHRcdFx0XHQvL1x0aWYgKGVycilcblx0XHRcdFx0XHRcdFx0XHRcdC8vXHRcdGVycm9yID0gZXJyO1xuXHRcdFx0XHRcdFx0XHRcdFx0Ly9cdHJldHVybiBuKCk7XG5cdFx0XHRcdFx0XHRcdFx0XHQvL30pO1xuXHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRzaXplID0gMDtcblx0XHRcdFx0XHRcdFx0XHRcdHJlYWQgPSAwO1xuXHRcdFx0XHRcdFx0XHRcdFx0c2VsZi5vbmNlKCcxNTAnLCBmdW5jdGlvbiAocmVwbHkpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIHN0ciA9IHJlcGx5Lm1hdGNoKC8oWzAtOV0rKVxccyooYnl0ZXMpLyk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChzdHIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzaXplID0gcGFyc2VJbnQoc3RyWzFdLCAxMCkgfHwgLTE7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0cG9vbCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmICghc2VsZi5mdHAuX3Bhc3ZTb2NrZXQpIHJldHVybjtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHJlYWQgPSBzZWxmLmZ0cC5fcGFzdlNvY2tldC5ieXRlc1JlYWQ7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mIHByb2dyZXNzID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRwcm9ncmVzcy5hcHBseShudWxsLCBbKGkgLyB0b3RhbCkgKyAocmVhZCAvIHNpemUgLyB0b3RhbCldKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9LCAyNTApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0XHRcdHNlbGYuZnRwLmdldChpdGVtLm5hbWUsIGZ1bmN0aW9uIChlcnIsIHN0cmVhbSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0ZXJyb3IgPSBlcnI7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIG4oKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgZGVzdCA9IEZTLmNyZWF0ZVdyaXRlU3RyZWFtKGxvY2FsKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0ZGVzdC5vbigndW5waXBlJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBuKCk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRkZXN0Lm9uKCdlcnJvcicsIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gbigpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0c3RyZWFtLnBpcGUoZGVzdCk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRuKCk7XG5cdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH1cblx0XHRlbHNlIHtcblx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgWydOb3QgY29ubmVjdGVkJ10pO1xuXHRcdH1cblxuXHRcdHJldHVybiBzZWxmO1xuXHR9XG5cblx0Q29ubmVjdG9yRlRQLnByb3RvdHlwZS5wdXQgPSBmdW5jdGlvbiAocGF0aCwgY29tcGxldGVkLCBwcm9ncmVzcykge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdHJlbW90ZSA9IHNlbGYuY2xpZW50LnRvUmVtb3RlKHBhdGgpO1xuXG5cdFx0aWYgKHNlbGYuaXNDb25uZWN0ZWQoKSkge1xuXHRcdFx0Ly8gRmlsZVxuXHRcdFx0aWYgKEZTLmlzRmlsZVN5bmMocGF0aCkpIHtcblx0XHRcdFx0dmFyIHN0YXRzID0gRlMuc3RhdFN5bmMocGF0aCksXG5cdFx0XHRcdFx0c2l6ZSA9IHN0YXRzWydzaXplJ10sXG5cdFx0XHRcdFx0d3JpdHRlbiA9IDAsXG5cdFx0XHRcdFx0cG9vbDtcblx0XHRcdFx0dmFyIGUgPSBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgW2VyciA/IGVyciA6IG51bGwsIFt7bmFtZTogcGF0aCwgdHlwZTogJ2YnfV1dKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRwb29sID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdGlmICghc2VsZi5mdHAuX3Bhc3ZTb2NrZXQpIHJldHVybjtcblx0XHRcdFx0XHR3cml0dGVuID0gc2VsZi5mdHAuX3Bhc3ZTb2NrZXQuYnl0ZXNXcml0dGVuO1xuXHRcdFx0XHRcdGlmICh0eXBlb2YgcHJvZ3Jlc3MgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRwcm9ncmVzcy5hcHBseShudWxsLCBbd3JpdHRlbiAvIHNpemVdKTtcblx0XHRcdFx0fSwgMjUwKTtcblx0XHRcdFx0c2VsZi5mdHAucHV0KHBhdGgsIHJlbW90ZSwgZnVuY3Rpb24gKGVycikge1xuXHRcdFx0XHRcdGlmIChlcnIpIHtcblx0XHRcdFx0XHRcdHNlbGYubWtkaXIoUGF0aC5kaXJuYW1lKHJlbW90ZSkucmVwbGFjZSgvXFxcXC9nLCAnLycpLCB0cnVlLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdHNlbGYuZnRwLnB1dChwYXRoLCByZW1vdGUsIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAocG9vbClcblx0XHRcdFx0XHRcdFx0XHRcdGNsZWFySW50ZXJ2YWwocG9vbCk7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGUoZXJyKTtcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHBvb2wpXG5cdFx0XHRcdFx0XHRjbGVhckludGVydmFsKHBvb2wpO1xuXHRcdFx0XHRcdHJldHVybiBlKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBGb2xkZXJcblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRzZWxmLmNsaWVudC5fdHJhdmVyc2VUcmVlKHBhdGgsIGZ1bmN0aW9uIChsaXN0KSB7XG5cdFx0XHRcdFx0c2VsZi5ta2RpcihyZW1vdGUsIHRydWUsIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0XHRcdHZhciBlcnJvcixcblx0XHRcdFx0XHRcdFx0aSA9IC0xLFxuXHRcdFx0XHRcdFx0XHR0b3RhbCA9IGxpc3QubGVuZ3RoLFxuXHRcdFx0XHRcdFx0XHRzaXplID0gMCxcblx0XHRcdFx0XHRcdFx0d3JpdHRlbiA9IDAsXG5cdFx0XHRcdFx0XHRcdHBvb2wgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKCFzZWxmLmZ0cC5fcGFzdlNvY2tldCkgcmV0dXJuO1xuXHRcdFx0XHRcdFx0XHRcdHdyaXR0ZW4gPSBzZWxmLmZ0cC5fcGFzdlNvY2tldC5ieXRlc1dyaXR0ZW47XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBwcm9ncmVzcyA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdFx0XHRcdHByb2dyZXNzLmFwcGx5KG51bGwsIFsoaSAvIHRvdGFsKSArICh3cml0dGVuIC8gc2l6ZSAvIHRvdGFsKV0pO1xuXHRcdFx0XHRcdFx0XHR9LCAyNTApO1xuXHRcdFx0XHRcdFx0dmFyIGUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChwb29sKVxuXHRcdFx0XHRcdFx0XHRcdGNsZWFySW50ZXJ2YWwocG9vbCk7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbZXJyb3IsIGxpc3RdKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHZhciBuID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRpZiAoKytpID49IGxpc3QubGVuZ3RoKVxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBlKCk7XG5cdFx0XHRcdFx0XHRcdHZhciBpdGVtID0gbGlzdFtpXSxcblx0XHRcdFx0XHRcdFx0XHRyZW1vdGUgPSBzZWxmLmNsaWVudC50b1JlbW90ZShpdGVtLm5hbWUpO1xuXHRcdFx0XHRcdFx0XHRpZiAoaXRlbS50eXBlID09ICdkJyB8fCBpdGVtLnR5cGUgPT0gJ2wnKSB7XG5cdFx0XHRcdFx0XHRcdFx0c2VsZi5mdHAubWtkaXIocmVtb3RlLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoZXJyKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRlcnJvciA9IGVycjtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBuKCk7XG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIHN0YXRzID0gRlMuc3RhdFN5bmMoaXRlbS5uYW1lKTtcblx0XHRcdFx0XHRcdFx0XHRzaXplID0gc3RhdHNbJ3NpemUnXTtcblx0XHRcdFx0XHRcdFx0XHR3cml0dGVuID0gMDtcblx0XHRcdFx0XHRcdFx0XHRzZWxmLmZ0cC5wdXQoaXRlbS5uYW1lLCByZW1vdGUsIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGlmIChlcnIpXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGVycm9yID0gZXJyO1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIG4oKTtcblx0XHRcdFx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gbigpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cdFx0ZWxzZSB7XG5cdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFsnTm90IGNvbm5lY3RlZCddKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gc2VsZjtcblx0fVxuXG5cdENvbm5lY3RvckZUUC5wcm90b3R5cGUubWtkaXIgPSBmdW5jdGlvbiAocGF0aCwgcmVjdXJzaXZlLCBjb21wbGV0ZWQpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRyZW1vdGVzID0gcGF0aC5yZXBsYWNlKC9eXFwvKy8sICcnKS5yZXBsYWNlKC9cXC8rJC8sICcnKS5zcGxpdCgnLycpLFxuXHRcdFx0ZGlycyA9IFsnLycgKyByZW1vdGVzLnNsaWNlKDAsIHJlbW90ZXMubGVuZ3RoKS5qb2luKCcvJyldO1xuXG5cdFx0aWYgKHNlbGYuaXNDb25uZWN0ZWQoKSkge1xuXHRcdFx0aWYgKHJlY3Vyc2l2ZSkge1xuXHRcdFx0XHRmb3IgKHZhciBhID0gcmVtb3Rlcy5sZW5ndGggLSAxOyBhID4gMDsgLS1hKVxuXHRcdFx0XHRcdGRpcnMudW5zaGlmdCgnLycgKyByZW1vdGVzLnNsaWNlKDAsIGEpLmpvaW4oJy8nKSk7XG5cdFx0XHR9XG5cblx0XHRcdHZhciBuID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0XHR2YXIgZGlyID0gZGlycy5zaGlmdCgpLFxuXHRcdFx0XHRcdGxhc3QgPSBkaXJzLmxlbmd0aCA9PSAwO1xuXG5cdFx0XHRcdHNlbGYuZnRwLm1rZGlyKGRpciwgZnVuY3Rpb24gKGVycikge1xuXHRcdFx0XHRcdGlmIChsYXN0KSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFtlcnIgPyBlcnIgOiBudWxsXSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHJldHVybiBuKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRcdG4oKTtcblx0XHR9XG5cdFx0ZWxzZSB7XG5cdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFsnTm90IGNvbm5lY3RlZCddKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gc2VsZjtcblx0fVxuXG5cdENvbm5lY3RvckZUUC5wcm90b3R5cGUubWtmaWxlID0gZnVuY3Rpb24gKHBhdGgsIGNvbXBsZXRlZCkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdGxvY2FsID0gc2VsZi5jbGllbnQudG9Mb2NhbChwYXRoKSxcblx0XHRcdGVtcHR5ID0gbmV3IEJ1ZmZlcignJywgJ3V0ZjgnKTtcblxuXHRcdGlmIChzZWxmLmlzQ29ubmVjdGVkKCkpIHtcblx0XHRcdHNlbGYuZnRwLnB1dChlbXB0eSwgcGF0aCwgZnVuY3Rpb24gKGVycikge1xuXHRcdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgW2Vycl0pO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0XHQvL21rZGlycChQYXRoLmRpcm5hbWUobG9jYWwpLCBmdW5jdGlvbiAoZXJyMSkge1xuXHRcdFx0XHQvL0ZTLm1ha2VUcmVlKFBhdGguZGlybmFtZShsb2NhbCksIGZ1bmN0aW9uIChlcnIxKSB7XG5cdFx0XHRcdEZTLm1ha2VUcmVlU3luYyhQYXRoLmRpcm5hbWUobG9jYWwpKTtcblx0XHRcdFx0RlMud3JpdGVGaWxlKGxvY2FsLCBlbXB0eSwgZnVuY3Rpb24gKGVycjIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbZXJyMl0pO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0Ly99KTtcblx0XHRcdH0pO1xuXHRcdH1cblx0XHRlbHNlIHtcblx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgWydOb3QgY29ubmVjdGVkJ10pO1xuXHRcdH1cblxuXHRcdHJldHVybiBzZWxmO1xuXHR9XG5cblx0Q29ubmVjdG9yRlRQLnByb3RvdHlwZS5yZW5hbWUgPSBmdW5jdGlvbiAoc291cmNlLCBkZXN0LCBjb21wbGV0ZWQpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRpZiAoc2VsZi5pc0Nvbm5lY3RlZCgpKSB7XG5cdFx0XHRzZWxmLmZ0cC5yZW5hbWUoc291cmNlLCBkZXN0LCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdGlmIChlcnIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbZXJyXSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0RlMucmVuYW1lKHNlbGYuY2xpZW50LnRvTG9jYWwoc291cmNlKSwgc2VsZi5jbGllbnQudG9Mb2NhbChkZXN0KSwgZnVuY3Rpb24gKGVycikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbZXJyXSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblx0XHRlbHNlIHtcblx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgWydOb3QgY29ubmVjdGVkJ10pO1xuXHRcdH1cblxuXHRcdHJldHVybiBzZWxmO1xuXHR9XG5cblx0Q29ubmVjdG9yRlRQLnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbiAocGF0aCwgY29tcGxldGVkKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0aWYgKHNlbGYuaXNDb25uZWN0ZWQoKSkge1xuXHRcdFx0c2VsZi5mdHAuY3dkKHBhdGgsIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0c2VsZi5mdHAuY3dkKCcvJywgZnVuY3Rpb24gKCkge1xuXG5cdFx0XHRcdFx0Ly8gRmlsZVxuXHRcdFx0XHRcdGlmIChlcnIpIHtcblx0XHRcdFx0XHRcdHNlbGYuZnRwLmRlbGV0ZShwYXRoLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbZXJyLCBbe25hbWU6IHBhdGgsIHR5cGU6ICdmJ31dXSk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBGb2xkZXJcblx0XHRcdFx0XHRlbHNlIHtcblx0XHRcdFx0XHRcdHNlbGYubGlzdChwYXRoLCB0cnVlLCBmdW5jdGlvbiAoZXJyLCBsaXN0KSB7XG5cdFx0XHRcdFx0XHRcdGxpc3QuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgeyBpdGVtLmRlcHRoID0gaXRlbS5uYW1lLnJlcGxhY2UoL15cXC8rLywgJycpLnJlcGxhY2UoL1xcLyskLykuc3BsaXQoJy8nKS5sZW5ndGg7IH0pO1xuXHRcdFx0XHRcdFx0XHRsaXN0LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAoYS5kZXB0aCA9PSBiLmRlcHRoKVxuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIDA7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGEuZGVwdGggPiBiLmRlcHRoID8gLTEgOiAxO1xuXHRcdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0XHR2YXIgZG9uZSA9IDA7XG5cblx0XHRcdFx0XHRcdFx0dmFyIGUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdFx0c2VsZi5mdHAucm1kaXIocGF0aCwgZnVuY3Rpb24gKGVycikge1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbZXJyLCBsaXN0XSk7XG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0bGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRcdFx0XHRcdFx0Kytkb25lO1xuXHRcdFx0XHRcdFx0XHRcdHZhciBmbiA9IGl0ZW0udHlwZSA9PSAnZCcgfHwgaXRlbS50eXBlID09ICdsJyA/ICdybWRpcicgOiAnZGVsZXRlJztcblx0XHRcdFx0XHRcdFx0XHRzZWxmLmZ0cFtmbl0oaXRlbS5uYW1lLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoLS1kb25lID09IDApXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBlKCk7XG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRpZiAobGlzdC5sZW5ndGggPT0gMClcblx0XHRcdFx0XHRcdFx0XHRlKCk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdGVsc2Uge1xuXHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbJ05vdCBjb25uZWN0ZWQnXSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHNlbGY7XG5cdH1cblxuXHRyZXR1cm4gQ29ubmVjdG9yRlRQO1xufSkoKTtcbiJdfQ==