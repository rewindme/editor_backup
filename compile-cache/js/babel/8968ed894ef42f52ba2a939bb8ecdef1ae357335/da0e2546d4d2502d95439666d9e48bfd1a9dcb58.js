var __hasProp = ({}).hasOwnProperty,
    __extends = function __extends(child, parent) {
	for (var key in parent) {
		if (__hasProp.call(parent, key)) child[key] = parent[key];
	}function ctor() {
		this.constructor = child;
	}ctor.prototype = parent.prototype;child.prototype = new ctor();child.__super__ = parent.prototype;return child;
},
    $ = require('atom').$,
    DirectoryView = require('./directory-view'),
    View = require('atom').ScrollView;

function hideLocalTree() {
	if (atom.packages.loadedPackages['tree-view'] && atom.packages.loadedPackages['tree-view'].mainModule && atom.packages.loadedPackages['tree-view'].mainModule.treeView) atom.packages.loadedPackages['tree-view'].mainModule.treeView.detach();
}

function showLocalTree() {
	if (atom.packages.loadedPackages['tree-view'] && atom.packages.loadedPackages['tree-view'].mainModule && atom.packages.loadedPackages['tree-view'].mainModule.treeView) atom.packages.loadedPackages['tree-view'].mainModule.treeView.attach();
}

module.exports = TreeView = (function (parent) {
	__extends(TreeView, parent);

	function TreeView() {
		TreeView.__super__.constructor.apply(this, arguments);
	}

	TreeView.content = function () {
		return this.div({
			'class': 'remote-ftp-view tree-view-resizer tool-panel',
			'data-show-on-right-side': atom.config.get('tree-view.showOnRightSide')
		}, (function () {
			this.div({
				'class': 'scroller',
				'outlet': 'scroller'
			}, (function () {
				this.ol({
					'class': 'full-menu list-tree has-collapsable-children focusable-panel',
					'tabindex': -1,
					'outlet': 'list'
				});
			}).bind(this));
			this.div({
				'class': 'resize-handle',
				'outlet': 'horizontalResize'
			});
			this.div({
				'class': 'queue tool-panel panel-bottom',
				'tabindex': -1,
				'outlet': 'queue'
			}, (function () {
				this.ul({
					'class': 'progress tool-panel panel-top',
					'tabindex': -1,
					'outlet': 'progress'
				});
				this.ul({
					'class': 'list',
					'tabindex': -1,
					'outlet': 'debug'
				});
				return this.div({
					'class': 'resize-handle',
					'outlet': 'verticalResize'
				});
			}).bind(this));
			this.div({
				'class': 'offline',
				'tabindex': -1,
				'outlet': 'offline'
			});
		}).bind(this));
	};

	var elapsedTime = function elapsedTime(ms) {
		var days = Math.floor(ms / 86400000);
		ms %= 86400000;
		var hours = Math.floor(ms / 3600000);
		ms %= 3600000;
		var mins = Math.floor(ms / 60000);
		ms %= 60000;
		var secs = Math.floor(ms / 1000);
		ms %= 1000;

		return ((days ? days + 'd ' : '') + (hours ? (days && hours < 10 ? '0' : '') + hours + 'h ' : '') + (mins ? ((days || hours) && mins < 10 ? '0' : '') + mins + 'm ' : '') + (secs ? ((days || hours || mins) && secs < 10 ? '0' : '') + secs + 's ' : '')).replace(/^[dhms]\s+/, '').replace(/[dhms]\s+[dhms]/g, '').replace(/^\s+/, '').replace(/\s+$/, '') || '0s';
	};

	TreeView.prototype.initialize = function (state) {
		TreeView.__super__.initialize.apply(this, arguments);

		var self = this;

		//self.addClass(atom.config.get('tree-view.showOnRightSide') ? 'panel-right' : 'panel-left');

		self.offline.html('<p><a role="connect">Connect</a>, <br /><a role="configure">edit configuration</a> or <br /><a role="toggle">close panel<a></p>');
		if (atom.project.remoteftp.isConnected()) self.showOnline();else self.showOffline();

		self.root = new DirectoryView(atom.project.remoteftp.root);
		self.root.expand();
		self.list.append(self.root);

		//self.attach();

		// Events
		atom.config.observe('tree-view.showOnRightSide', { callNow: true }, function () {
			if (self.isVisible()) {
				setTimeout(function () {
					self.detach();
					self.attach();
				}, 1);
			}
		});
		atom.config.observe('remote-ftp.hideLocalWhenDisplayed', { callNow: true }, function () {
			if (atom.config.get('remote-ftp.hideLocalWhenDisplayed')) {
				if (self.isVisible()) {
					hideLocalTree();
				}
			} else {
				if (self.isVisible()) {
					self.detach();
					showLocalTree();
					self.attach();
				} else {
					showLocalTree();
				}
			}
		});

		atom.project.remoteftp.on('debug', function (msg) {
			self.debug.prepend('<li>' + msg + '</li>');
			var children = self.debug.children();
			if (children.length > 20) children.last().remove();
		});
		atom.project.remoteftp.on('queue-changed', function () {
			self.progress.empty();

			var queue = [];
			if (atom.project.remoteftp._current) queue.push(atom.project.remoteftp._current);
			for (var i = 0, l = atom.project.remoteftp._queue.length; i < l; ++i) queue.push(atom.project.remoteftp._queue[i]);

			if (queue.length == 0) self.progress.hide();else {
				self.progress.show();

				queue.forEach(function (queue) {
					var $li = $('<li><progress class="inline-block" /><div class="name">' + queue[0] + '</div><div class="eta">-</div></li>'),
					    $progress = $li.children('progress'),
					    $eta = $li.children('.eta'),
					    progress = queue[2];
					self.progress.append($li);

					progress.on('progress', function (percent) {
						if (percent == -1) {
							$progress.removeAttr('max').removeAttr('value');
							$eta.text('-');
						} else {
							$progress.attr('max', 100).attr('value', parseInt(percent * 100, 10));
							var eta = progress.getEta();
							$eta.text(elapsedTime(eta));
						}
					});
					progress.once('done', function () {
						progress.removeAllListeners('progress');
					});
				});
			}
		});

		self.offline.on('click', '[role="connect"]', function (e) {
			atom.project.remoteftp.readConfig(function () {
				atom.project.remoteftp.connect();
			});
		});
		self.offline.on('click', '[role="configure"]', function (e) {
			atom.workspace.open(atom.project.resolve('.ftpconfig'));
		});
		self.offline.on('click', '[role="toggle"]', function (e) {
			self.toggle();
		});
		self.horizontalResize.on('dblclick', function (e) {
			self.resizeToFitContent(e);
		});
		self.horizontalResize.on('mousedown', function (e) {
			self.resizeHorizontalStarted(e);
		});
		self.verticalResize.on('mousedown', function (e) {
			self.resizeVerticalStarted(e);
		});

		atom.project.remoteftp.on('connected', function () {
			self.showOnline();
		});
		//atom.project.remoteftp.on('closed', function () {
		atom.project.remoteftp.on('disconnected', function () {
			self.showOffline();
		});
	};

	TreeView.prototype.attach = function () {
		if (atom.config.get('tree-view.showOnRightSide')) {
			this.panel = atom.workspace.addRightPanel({ item: this });
		} else {
			this.panel = atom.workspace.addLeftPanel({ item: this });
		}

		if (atom.config.get('remote-ftp.hideLocalWhenDisplayed')) hideLocalTree();else showLocalTree();
	};

	TreeView.prototype.detach = function () {
		TreeView.__super__.detach.apply(this, arguments);

		if (this.panel) {
			this.panel.destroy();
			this.panel = null;
		}

		showLocalTree();
	};

	TreeView.prototype.toggle = function () {
		if (this.isVisible()) {
			this.detach();
		} else {
			this.attach();
		}
	};

	TreeView.prototype.showOffline = function () {
		this.list.hide();
		this.queue.hide();
		this.offline.css('display', 'flex');
	};

	TreeView.prototype.showOnline = function () {
		this.list.show();
		this.queue.show();
		this.offline.hide();
	};

	TreeView.prototype.resolve = function (path) {
		var view = $('.remote-ftp-view [data-path="' + path + '"]').map(function () {
			var v = $(this).view();
			return v ? v : null;
		}).get(0);

		return view;
	};

	TreeView.prototype.getSelected = function () {
		var views = $('.remote-ftp-view .selected').map(function () {
			var v = $(this).view();
			return v ? v : null;
		}).get();

		return views;
	};

	TreeView.prototype.resizeVerticalStarted = function (e) {
		e.preventDefault();

		this.resizeHeightStart = this.queue.height();
		this.resizeMouseStart = e.pageY;
		$(document).on('mousemove', this.resizeVerticalView.bind(this));
		$(document).on('mouseup', this.resizeVerticalStopped);
	};

	TreeView.prototype.resizeVerticalStopped = function () {
		delete this.resizeHeightStart;
		delete this.resizeMouseStart;
		$(document).off('mousemove', this.resizeVerticalView);
		$(document).off('mouseup', this.resizeVerticalStopped);
	};

	TreeView.prototype.resizeVerticalView = function (e) {
		if (e.which !== 1) return this.resizeStopped();

		var delta = e.pageY - this.resizeMouseStart,
		    height = Math.max(26, this.resizeHeightStart - delta);

		this.queue.height(height);
		this.scroller.css('bottom', height + 'px');
	};

	TreeView.prototype.resizeHorizontalStarted = function (e) {
		e.preventDefault();

		this.resizeWidthStart = this.width();
		this.resizeMouseStart = e.pageX;
		$(document).on('mousemove', this.resizeHorizontalView.bind(this));
		$(document).on('mouseup', this.resizeHorizontalStopped);
	};

	TreeView.prototype.resizeHorizontalStopped = function () {
		delete this.resizeWidthStart;
		delete this.resizeMouseStart;
		$(document).off('mousemove', this.resizeHorizontalView);
		$(document).off('mouseup', this.resizeHorizontalStopped);
	};

	TreeView.prototype.resizeHorizontalView = function (e) {
		if (e.which !== 1) return this.resizeStopped();

		var delta = e.pageX - this.resizeMouseStart,
		    width = Math.max(50, this.resizeWidthStart + delta);

		this.width(width);
	};

	TreeView.prototype.resizeToFitContent = function (e) {
		e.preventDefault();

		this.width(1);
		this.width(this.list.outerWidth());
	};

	return TreeView;
})(View);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9uYXZlci8uYXRvbS9wYWNrYWdlcy9yZW1vdGUtZnRwL2xpYi92aWV3cy90cmVlLXZpZXcuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSSxTQUFTLEdBQUcsQ0FBQSxHQUFFLENBQUMsY0FBYztJQUNoQyxTQUFTLEdBQUcsU0FBWixTQUFTLENBQVksS0FBSyxFQUFFLE1BQU0sRUFBRTtBQUFFLE1BQUssSUFBSSxHQUFHLElBQUksTUFBTSxFQUFFO0FBQUUsTUFBSSxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsRUFBRSxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0VBQUUsQUFBQyxTQUFTLElBQUksR0FBRztBQUFFLE1BQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDO0VBQUUsQUFBQyxJQUFJLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQUFBQyxLQUFLLENBQUMsU0FBUyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsQUFBQyxLQUFLLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQUFBQyxPQUFPLEtBQUssQ0FBQztDQUFFO0lBQy9SLENBQUMsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUNyQixhQUFhLEdBQUcsT0FBTyxDQUFDLGtCQUFrQixDQUFDO0lBQzNDLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsVUFBVSxDQUFDOztBQUVuQyxTQUFTLGFBQWEsR0FBSTtBQUN6QixLQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUNy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LmF0b20vcGFja2FnZXMvcmVtb3RlLWZ0cC9saWIvdmlld3MvdHJlZS12aWV3LmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuXHRfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfSxcblx0JCA9IHJlcXVpcmUoJ2F0b20nKS4kLFxuXHREaXJlY3RvcnlWaWV3ID0gcmVxdWlyZSgnLi9kaXJlY3RvcnktdmlldycpLFxuXHRWaWV3ID0gcmVxdWlyZSgnYXRvbScpLlNjcm9sbFZpZXc7XG5cbmZ1bmN0aW9uIGhpZGVMb2NhbFRyZWUgKCkge1xuXHRpZiAoYXRvbS5wYWNrYWdlcy5sb2FkZWRQYWNrYWdlc1sndHJlZS12aWV3J10gJiYgYXRvbS5wYWNrYWdlcy5sb2FkZWRQYWNrYWdlc1sndHJlZS12aWV3J10ubWFpbk1vZHVsZSAmJiBhdG9tLnBhY2thZ2VzLmxvYWRlZFBhY2thZ2VzWyd0cmVlLXZpZXcnXS5tYWluTW9kdWxlLnRyZWVWaWV3KVxuXHRcdGF0b20ucGFja2FnZXMubG9hZGVkUGFja2FnZXNbJ3RyZWUtdmlldyddLm1haW5Nb2R1bGUudHJlZVZpZXcuZGV0YWNoKCk7XG59XG5cbmZ1bmN0aW9uIHNob3dMb2NhbFRyZWUgKCkge1xuXHRpZiAoYXRvbS5wYWNrYWdlcy5sb2FkZWRQYWNrYWdlc1sndHJlZS12aWV3J10gJiYgYXRvbS5wYWNrYWdlcy5sb2FkZWRQYWNrYWdlc1sndHJlZS12aWV3J10ubWFpbk1vZHVsZSAmJiBhdG9tLnBhY2thZ2VzLmxvYWRlZFBhY2thZ2VzWyd0cmVlLXZpZXcnXS5tYWluTW9kdWxlLnRyZWVWaWV3KVxuXHRcdGF0b20ucGFja2FnZXMubG9hZGVkUGFja2FnZXNbJ3RyZWUtdmlldyddLm1haW5Nb2R1bGUudHJlZVZpZXcuYXR0YWNoKCk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gVHJlZVZpZXcgPSAoZnVuY3Rpb24gKHBhcmVudCkge1xuXHRfX2V4dGVuZHMoVHJlZVZpZXcsIHBhcmVudCk7XG5cblx0ZnVuY3Rpb24gVHJlZVZpZXcgKCkge1xuXHRcdFRyZWVWaWV3Ll9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuXG5cdH1cblxuXHRUcmVlVmlldy5jb250ZW50ID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzLmRpdih7XG5cdFx0XHQnY2xhc3MnOiAncmVtb3RlLWZ0cC12aWV3IHRyZWUtdmlldy1yZXNpemVyIHRvb2wtcGFuZWwnLFxuXHRcdFx0J2RhdGEtc2hvdy1vbi1yaWdodC1zaWRlJzogYXRvbS5jb25maWcuZ2V0KCd0cmVlLXZpZXcuc2hvd09uUmlnaHRTaWRlJylcblx0XHR9LCBmdW5jdGlvbiAoKSB7XG5cdFx0XHR0aGlzLmRpdih7XG5cdFx0XHRcdCdjbGFzcyc6ICdzY3JvbGxlcicsXG5cdFx0XHRcdCdvdXRsZXQnOiAnc2Nyb2xsZXInXG5cdFx0XHR9LCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdHRoaXMub2woe1xuXHRcdFx0XHRcdCdjbGFzcyc6ICdmdWxsLW1lbnUgbGlzdC10cmVlIGhhcy1jb2xsYXBzYWJsZS1jaGlsZHJlbiBmb2N1c2FibGUtcGFuZWwnLFxuXHRcdFx0XHRcdCd0YWJpbmRleCc6IC0xLFxuXHRcdFx0XHRcdCdvdXRsZXQnOiAnbGlzdCdcblx0XHRcdFx0fSlcblx0XHRcdH0uYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLmRpdih7XG5cdFx0XHRcdCdjbGFzcyc6ICdyZXNpemUtaGFuZGxlJyxcblx0XHRcdFx0J291dGxldCc6ICdob3Jpem9udGFsUmVzaXplJ1xuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLmRpdih7XG5cdFx0XHRcdCdjbGFzcyc6ICdxdWV1ZSB0b29sLXBhbmVsIHBhbmVsLWJvdHRvbScsXG5cdFx0XHRcdCd0YWJpbmRleCc6IC0xLFxuXHRcdFx0XHQnb3V0bGV0JzogJ3F1ZXVlJ1xuXHRcdFx0fSwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHR0aGlzLnVsKHtcblx0XHRcdFx0XHQnY2xhc3MnOiAncHJvZ3Jlc3MgdG9vbC1wYW5lbCBwYW5lbC10b3AnLFxuXHRcdFx0XHRcdCd0YWJpbmRleCc6IC0xLFxuXHRcdFx0XHRcdCdvdXRsZXQnOiAncHJvZ3Jlc3MnXG5cdFx0XHRcdH0pO1xuXHRcdFx0XHR0aGlzLnVsKHtcblx0XHRcdFx0XHQnY2xhc3MnOiAnbGlzdCcsXG5cdFx0XHRcdFx0J3RhYmluZGV4JzogLTEsXG5cdFx0XHRcdFx0J291dGxldCc6ICdkZWJ1Zydcblx0XHRcdFx0fSlcblx0XHRcdFx0cmV0dXJuIHRoaXMuZGl2KHtcblx0XHRcdFx0XHQnY2xhc3MnOiAncmVzaXplLWhhbmRsZScsXG5cdFx0XHRcdFx0J291dGxldCc6ICd2ZXJ0aWNhbFJlc2l6ZSdcblx0XHRcdFx0fSlcblx0XHRcdH0uYmluZCh0aGlzKSk7XG5cdFx0XHR0aGlzLmRpdih7XG5cdFx0XHRcdCdjbGFzcyc6ICdvZmZsaW5lJyxcblx0XHRcdFx0J3RhYmluZGV4JzogLTEsXG5cdFx0XHRcdCdvdXRsZXQnOiAnb2ZmbGluZSdcblx0XHRcdH0pO1xuXHRcdH0uYmluZCh0aGlzKSk7XG5cdH1cblxuXHR2YXIgZWxhcHNlZFRpbWUgPSBmdW5jdGlvbiAobXMpIHtcblx0XHR2YXIgZGF5cyA9IE1hdGguZmxvb3IobXMgLyA4NjQwMDAwMCk7XG5cdFx0bXMgJT0gODY0MDAwMDA7XG5cdFx0dmFyIGhvdXJzID0gTWF0aC5mbG9vcihtcyAvIDM2MDAwMDApO1xuXHRcdG1zICU9IDM2MDAwMDA7XG5cdFx0dmFyIG1pbnMgPSBNYXRoLmZsb29yKG1zIC8gNjAwMDApO1xuXHRcdG1zICU9IDYwMDAwO1xuXHRcdHZhciBzZWNzID0gTWF0aC5mbG9vcihtcyAvIDEwMDApO1xuXHRcdG1zICU9IDEwMDA7XG5cblx0XHRyZXR1cm4gKChkYXlzID8gZGF5cyArICdkICcgOiAnJykgK1xuXHRcdFx0XHQoaG91cnMgPyAoKGRheXMpICYmIGhvdXJzIDwgMTAgPyAnMCcgOiAnJykgKyBob3VycyArICdoICcgOiAnJykgK1xuXHRcdFx0XHQobWlucyA/ICgoZGF5cyB8fCBob3VycykgJiYgbWlucyA8IDEwID8gJzAnIDogJycpICsgbWlucyArICdtICcgOiAnJykgK1xuXHRcdFx0XHQoc2VjcyA/ICgoZGF5cyB8fCBob3VycyB8fCBtaW5zKSAmJiBzZWNzIDwgMTAgPyAnMCcgOiAnJykgKyBzZWNzICsgJ3MgJyA6ICcnKSkucmVwbGFjZSgvXltkaG1zXVxccysvLCAnJykucmVwbGFjZSgvW2RobXNdXFxzK1tkaG1zXS9nLCAnJykucmVwbGFjZSgvXlxccysvLCAnJykucmVwbGFjZSgvXFxzKyQvLCAnJykgfHwgJzBzJztcblx0fVxuXG5cdFRyZWVWaWV3LnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKHN0YXRlKSB7XG5cdFx0VHJlZVZpZXcuX19zdXBlcl9fLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcblxuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdC8vc2VsZi5hZGRDbGFzcyhhdG9tLmNvbmZpZy5nZXQoJ3RyZWUtdmlldy5zaG93T25SaWdodFNpZGUnKSA/ICdwYW5lbC1yaWdodCcgOiAncGFuZWwtbGVmdCcpO1xuXG5cdFx0c2VsZi5vZmZsaW5lLmh0bWwoJzxwPjxhIHJvbGU9XCJjb25uZWN0XCI+Q29ubmVjdDwvYT4sIDxiciAvPjxhIHJvbGU9XCJjb25maWd1cmVcIj5lZGl0IGNvbmZpZ3VyYXRpb248L2E+IG9yIDxiciAvPjxhIHJvbGU9XCJ0b2dnbGVcIj5jbG9zZSBwYW5lbDxhPjwvcD4nKTtcblx0XHRpZiAoYXRvbS5wcm9qZWN0LnJlbW90ZWZ0cC5pc0Nvbm5lY3RlZCgpKVxuXHRcdFx0c2VsZi5zaG93T25saW5lKCk7XG5cdFx0ZWxzZVxuXHRcdFx0c2VsZi5zaG93T2ZmbGluZSgpO1xuXG5cdFx0c2VsZi5yb290ID0gbmV3IERpcmVjdG9yeVZpZXcoYXRvbS5wcm9qZWN0LnJlbW90ZWZ0cC5yb290KTtcblx0XHRzZWxmLnJvb3QuZXhwYW5kKCk7XG5cdFx0c2VsZi5saXN0LmFwcGVuZChzZWxmLnJvb3QpO1xuXG5cdFx0Ly9zZWxmLmF0dGFjaCgpO1xuXG5cdFx0Ly8gRXZlbnRzXG5cdFx0YXRvbS5jb25maWcub2JzZXJ2ZSgndHJlZS12aWV3LnNob3dPblJpZ2h0U2lkZScsIHtjYWxsTm93OiB0cnVlfSwgZnVuY3Rpb24gKCkge1xuXHRcdFx0aWYgKHNlbGYuaXNWaXNpYmxlKCkpIHtcblx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0c2VsZi5kZXRhY2goKTtcblx0XHRcdFx0XHRzZWxmLmF0dGFjaCgpO1xuXHRcdFx0XHR9LCAxKVxuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdGF0b20uY29uZmlnLm9ic2VydmUoJ3JlbW90ZS1mdHAuaGlkZUxvY2FsV2hlbkRpc3BsYXllZCcsIHtjYWxsTm93OiB0cnVlfSwgZnVuY3Rpb24gKCkge1xuXHRcdFx0aWYgKGF0b20uY29uZmlnLmdldCgncmVtb3RlLWZ0cC5oaWRlTG9jYWxXaGVuRGlzcGxheWVkJykpIHtcblx0XHRcdFx0aWYgKHNlbGYuaXNWaXNpYmxlKCkpIHtcblx0XHRcdFx0XHRoaWRlTG9jYWxUcmVlKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmIChzZWxmLmlzVmlzaWJsZSgpKSB7XG5cdFx0XHRcdFx0c2VsZi5kZXRhY2goKTtcblx0XHRcdFx0XHRzaG93TG9jYWxUcmVlKCk7XG5cdFx0XHRcdFx0c2VsZi5hdHRhY2goKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRzaG93TG9jYWxUcmVlKCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGF0b20ucHJvamVjdC5yZW1vdGVmdHAub24oJ2RlYnVnJywgZnVuY3Rpb24gKG1zZykge1xuXHRcdFx0c2VsZi5kZWJ1Zy5wcmVwZW5kKCc8bGk+Jyttc2crJzwvbGk+Jyk7XG5cdFx0XHR2YXIgY2hpbGRyZW4gPSBzZWxmLmRlYnVnLmNoaWxkcmVuKCk7XG5cdFx0XHRpZiAoY2hpbGRyZW4ubGVuZ3RoID4gMjApXG5cdFx0XHRcdGNoaWxkcmVuLmxhc3QoKS5yZW1vdmUoKTtcblx0XHR9KTtcblx0XHRhdG9tLnByb2plY3QucmVtb3RlZnRwLm9uKCdxdWV1ZS1jaGFuZ2VkJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0c2VsZi5wcm9ncmVzcy5lbXB0eSgpO1xuXG5cdFx0XHR2YXIgcXVldWUgPSBbXTtcblx0XHRcdGlmIChhdG9tLnByb2plY3QucmVtb3RlZnRwLl9jdXJyZW50KVxuXHRcdFx0XHRxdWV1ZS5wdXNoKGF0b20ucHJvamVjdC5yZW1vdGVmdHAuX2N1cnJlbnQpO1xuXHRcdFx0Zm9yICh2YXIgaSA9IDAsIGwgPSBhdG9tLnByb2plY3QucmVtb3RlZnRwLl9xdWV1ZS5sZW5ndGg7IGkgPCBsOyArK2kpXG5cdFx0XHRcdHF1ZXVlLnB1c2goYXRvbS5wcm9qZWN0LnJlbW90ZWZ0cC5fcXVldWVbaV0pO1xuXG5cdFx0XHRpZiAocXVldWUubGVuZ3RoID09IDApXG5cdFx0XHRcdHNlbGYucHJvZ3Jlc3MuaGlkZSgpO1xuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdHNlbGYucHJvZ3Jlc3Muc2hvdygpO1xuXG5cdFx0XHRcdHF1ZXVlLmZvckVhY2goZnVuY3Rpb24gKHF1ZXVlKSB7XG5cdFx0XHRcdFx0dmFyICRsaSA9ICQoJzxsaT48cHJvZ3Jlc3MgY2xhc3M9XCJpbmxpbmUtYmxvY2tcIiAvPjxkaXYgY2xhc3M9XCJuYW1lXCI+JysgcXVldWVbMF0gKyc8L2Rpdj48ZGl2IGNsYXNzPVwiZXRhXCI+LTwvZGl2PjwvbGk+JyksXG5cdFx0XHRcdFx0XHQkcHJvZ3Jlc3MgPSAkbGkuY2hpbGRyZW4oJ3Byb2dyZXNzJyksXG5cdFx0XHRcdFx0XHQkZXRhID0gJGxpLmNoaWxkcmVuKCcuZXRhJyksXG5cdFx0XHRcdFx0XHRwcm9ncmVzcyA9IHF1ZXVlWzJdO1xuXHRcdFx0XHRcdHNlbGYucHJvZ3Jlc3MuYXBwZW5kKCRsaSk7XG5cblx0XHRcdFx0XHRwcm9ncmVzcy5vbigncHJvZ3Jlc3MnLCBmdW5jdGlvbiAocGVyY2VudCkge1xuXHRcdFx0XHRcdFx0aWYgKHBlcmNlbnQgPT0gLTEpIHtcblx0XHRcdFx0XHRcdFx0JHByb2dyZXNzLnJlbW92ZUF0dHIoJ21heCcpLnJlbW92ZUF0dHIoJ3ZhbHVlJyk7XG5cdFx0XHRcdFx0XHRcdCRldGEudGV4dCgnLScpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0JHByb2dyZXNzLmF0dHIoJ21heCcsIDEwMCkuYXR0cigndmFsdWUnLCBwYXJzZUludChwZXJjZW50ICogMTAwLCAxMCkpO1xuXHRcdFx0XHRcdFx0XHR2YXIgZXRhID0gcHJvZ3Jlc3MuZ2V0RXRhKCk7XG5cdFx0XHRcdFx0XHRcdCRldGEudGV4dChlbGFwc2VkVGltZShldGEpKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRwcm9ncmVzcy5vbmNlKCdkb25lJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0cHJvZ3Jlc3MucmVtb3ZlQWxsTGlzdGVuZXJzKCdwcm9ncmVzcycpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9KVxuXG5cdFx0c2VsZi5vZmZsaW5lLm9uKCdjbGljaycsICdbcm9sZT1cImNvbm5lY3RcIl0nLCBmdW5jdGlvbiAoZSkge1xuXHRcdFx0YXRvbS5wcm9qZWN0LnJlbW90ZWZ0cC5yZWFkQ29uZmlnKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0YXRvbS5wcm9qZWN0LnJlbW90ZWZ0cC5jb25uZWN0KCk7XG5cdFx0XHR9KTtcblx0XHR9KTtcblx0XHRzZWxmLm9mZmxpbmUub24oJ2NsaWNrJywgJ1tyb2xlPVwiY29uZmlndXJlXCJdJywgZnVuY3Rpb24gKGUpIHtcblx0XHRcdGF0b20ud29ya3NwYWNlLm9wZW4oYXRvbS5wcm9qZWN0LnJlc29sdmUoJy5mdHBjb25maWcnKSk7XG5cdFx0fSk7XG5cdFx0c2VsZi5vZmZsaW5lLm9uKCdjbGljaycsICdbcm9sZT1cInRvZ2dsZVwiXScsIGZ1bmN0aW9uIChlKSB7XG5cdFx0XHRzZWxmLnRvZ2dsZSgpO1xuXHRcdH0pO1xuXHRcdHNlbGYuaG9yaXpvbnRhbFJlc2l6ZS5vbignZGJsY2xpY2snLCBmdW5jdGlvbiAoZSkgeyBzZWxmLnJlc2l6ZVRvRml0Q29udGVudChlKTsgfSk7XG5cdFx0c2VsZi5ob3Jpem9udGFsUmVzaXplLm9uKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZSkgeyBzZWxmLnJlc2l6ZUhvcml6b250YWxTdGFydGVkKGUpOyB9KTtcblx0XHRzZWxmLnZlcnRpY2FsUmVzaXplLm9uKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZSkgeyBzZWxmLnJlc2l6ZVZlcnRpY2FsU3RhcnRlZChlKTsgfSk7XG5cblx0XHRhdG9tLnByb2plY3QucmVtb3RlZnRwLm9uKCdjb25uZWN0ZWQnLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRzZWxmLnNob3dPbmxpbmUoKTtcblx0XHR9KTtcblx0XHQvL2F0b20ucHJvamVjdC5yZW1vdGVmdHAub24oJ2Nsb3NlZCcsIGZ1bmN0aW9uICgpIHtcblx0XHRhdG9tLnByb2plY3QucmVtb3RlZnRwLm9uKCdkaXNjb25uZWN0ZWQnLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRzZWxmLnNob3dPZmZsaW5lKCk7XG5cdFx0fSk7XG5cdH07XG5cblx0VHJlZVZpZXcucHJvdG90eXBlLmF0dGFjaCA9IGZ1bmN0aW9uICgpIHtcblx0XHRpZiAoYXRvbS5jb25maWcuZ2V0KCd0cmVlLXZpZXcuc2hvd09uUmlnaHRTaWRlJykpIHtcblx0XHRcdHRoaXMucGFuZWwgPSBhdG9tLndvcmtzcGFjZS5hZGRSaWdodFBhbmVsKHtpdGVtOiB0aGlzfSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMucGFuZWwgPSBhdG9tLndvcmtzcGFjZS5hZGRMZWZ0UGFuZWwoe2l0ZW06IHRoaXN9KTtcblx0XHR9XG5cblx0XHRpZiAoYXRvbS5jb25maWcuZ2V0KCdyZW1vdGUtZnRwLmhpZGVMb2NhbFdoZW5EaXNwbGF5ZWQnKSlcblx0XHRcdGhpZGVMb2NhbFRyZWUoKTtcblx0XHRlbHNlXG5cdFx0XHRzaG93TG9jYWxUcmVlKCk7XG5cdH1cblxuXHRUcmVlVmlldy5wcm90b3R5cGUuZGV0YWNoID0gZnVuY3Rpb24gKCkge1xuXHRcdFRyZWVWaWV3Ll9fc3VwZXJfXy5kZXRhY2guYXBwbHkodGhpcywgYXJndW1lbnRzKTtcblxuXHRcdGlmICh0aGlzLnBhbmVsKSB7XG5cdFx0XHR0aGlzLnBhbmVsLmRlc3Ryb3koKTtcblx0XHRcdHRoaXMucGFuZWwgPSBudWxsO1xuXHRcdH1cblxuXHRcdHNob3dMb2NhbFRyZWUoKTtcblx0fVxuXG5cdFRyZWVWaWV3LnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0aWYgKHRoaXMuaXNWaXNpYmxlKCkpIHtcblx0XHRcdHRoaXMuZGV0YWNoKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuYXR0YWNoKCk7XG5cdFx0fVxuXHR9XG5cblx0VHJlZVZpZXcucHJvdG90eXBlLnNob3dPZmZsaW5lID0gZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMubGlzdC5oaWRlKCk7XG5cdFx0dGhpcy5xdWV1ZS5oaWRlKCk7XG5cdFx0dGhpcy5vZmZsaW5lLmNzcygnZGlzcGxheScsICdmbGV4Jyk7XG5cdH1cblxuXHRUcmVlVmlldy5wcm90b3R5cGUuc2hvd09ubGluZSA9IGZ1bmN0aW9uICgpIHtcblx0XHR0aGlzLmxpc3Quc2hvdygpO1xuXHRcdHRoaXMucXVldWUuc2hvdygpO1xuXHRcdHRoaXMub2ZmbGluZS5oaWRlKCk7XG5cdH1cblxuXHRUcmVlVmlldy5wcm90b3R5cGUucmVzb2x2ZSA9IGZ1bmN0aW9uIChwYXRoKSB7XG5cdFx0dmFyIHZpZXcgPSAkKCcucmVtb3RlLWZ0cC12aWV3IFtkYXRhLXBhdGg9XCInKyBwYXRoICsnXCJdJykubWFwKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0dmFyIHYgPSAkKHRoaXMpLnZpZXcoKTtcblx0XHRcdFx0cmV0dXJuIHYgPyB2IDogbnVsbFxuXHRcdFx0fSkuZ2V0KDApO1xuXG5cdFx0cmV0dXJuIHZpZXc7XG5cdH1cblxuXHRUcmVlVmlldy5wcm90b3R5cGUuZ2V0U2VsZWN0ZWQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIHZpZXdzID0gJCgnLnJlbW90ZS1mdHAtdmlldyAuc2VsZWN0ZWQnKS5tYXAoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHR2YXIgdiA9ICQodGhpcykudmlldygpO1xuXHRcdFx0XHRyZXR1cm4gdiA/IHYgOiBudWxsXG5cdFx0XHR9KS5nZXQoKTtcblxuXHRcdHJldHVybiB2aWV3cztcblx0fVxuXG5cdFRyZWVWaWV3LnByb3RvdHlwZS5yZXNpemVWZXJ0aWNhbFN0YXJ0ZWQgPSBmdW5jdGlvbiAoZSkge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdHRoaXMucmVzaXplSGVpZ2h0U3RhcnQgPSB0aGlzLnF1ZXVlLmhlaWdodCgpO1xuXHRcdHRoaXMucmVzaXplTW91c2VTdGFydCA9IGUucGFnZVk7XG5cdFx0JChkb2N1bWVudCkub24oJ21vdXNlbW92ZScsIHRoaXMucmVzaXplVmVydGljYWxWaWV3LmJpbmQodGhpcykpO1xuXHRcdCQoZG9jdW1lbnQpLm9uKCdtb3VzZXVwJywgdGhpcy5yZXNpemVWZXJ0aWNhbFN0b3BwZWQpO1xuXHR9XG5cblx0VHJlZVZpZXcucHJvdG90eXBlLnJlc2l6ZVZlcnRpY2FsU3RvcHBlZCA9IGZ1bmN0aW9uICgpIHtcblx0XHRkZWxldGUgdGhpcy5yZXNpemVIZWlnaHRTdGFydDtcblx0XHRkZWxldGUgdGhpcy5yZXNpemVNb3VzZVN0YXJ0O1xuXHRcdCQoZG9jdW1lbnQpLm9mZignbW91c2Vtb3ZlJywgdGhpcy5yZXNpemVWZXJ0aWNhbFZpZXcpO1xuXHRcdCQoZG9jdW1lbnQpLm9mZignbW91c2V1cCcsIHRoaXMucmVzaXplVmVydGljYWxTdG9wcGVkKTtcblx0fVxuXG5cdFRyZWVWaWV3LnByb3RvdHlwZS5yZXNpemVWZXJ0aWNhbFZpZXcgPSBmdW5jdGlvbiAoZSkge1xuXHRcdGlmIChlLndoaWNoICE9PSAxKVxuXHRcdFx0cmV0dXJuIHRoaXMucmVzaXplU3RvcHBlZCgpO1xuXG5cdFx0dmFyIGRlbHRhID0gZS5wYWdlWSAtIHRoaXMucmVzaXplTW91c2VTdGFydCxcblx0XHRcdGhlaWdodCA9IE1hdGgubWF4KDI2LCB0aGlzLnJlc2l6ZUhlaWdodFN0YXJ0IC0gZGVsdGEpO1xuXG5cdFx0dGhpcy5xdWV1ZS5oZWlnaHQoaGVpZ2h0KTtcblx0XHR0aGlzLnNjcm9sbGVyLmNzcygnYm90dG9tJywgaGVpZ2h0ICsgJ3B4Jyk7XG5cdH1cblxuXHRUcmVlVmlldy5wcm90b3R5cGUucmVzaXplSG9yaXpvbnRhbFN0YXJ0ZWQgPSBmdW5jdGlvbiAoZSkge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdHRoaXMucmVzaXplV2lkdGhTdGFydCA9IHRoaXMud2lkdGgoKTtcblx0XHR0aGlzLnJlc2l6ZU1vdXNlU3RhcnQgPSBlLnBhZ2VYO1xuXHRcdCQoZG9jdW1lbnQpLm9uKCdtb3VzZW1vdmUnLCB0aGlzLnJlc2l6ZUhvcml6b250YWxWaWV3LmJpbmQodGhpcykpO1xuXHRcdCQoZG9jdW1lbnQpLm9uKCdtb3VzZXVwJywgdGhpcy5yZXNpemVIb3Jpem9udGFsU3RvcHBlZCk7XG5cdH1cblxuXHRUcmVlVmlldy5wcm90b3R5cGUucmVzaXplSG9yaXpvbnRhbFN0b3BwZWQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0ZGVsZXRlIHRoaXMucmVzaXplV2lkdGhTdGFydDtcblx0XHRkZWxldGUgdGhpcy5yZXNpemVNb3VzZVN0YXJ0O1xuXHRcdCQoZG9jdW1lbnQpLm9mZignbW91c2Vtb3ZlJywgdGhpcy5yZXNpemVIb3Jpem9udGFsVmlldyk7XG5cdFx0JChkb2N1bWVudCkub2ZmKCdtb3VzZXVwJywgdGhpcy5yZXNpemVIb3Jpem9udGFsU3RvcHBlZCk7XG5cdH1cblxuXHRUcmVlVmlldy5wcm90b3R5cGUucmVzaXplSG9yaXpvbnRhbFZpZXcgPSBmdW5jdGlvbiAoZSkge1xuXHRcdGlmIChlLndoaWNoICE9PSAxKVxuXHRcdFx0cmV0dXJuIHRoaXMucmVzaXplU3RvcHBlZCgpO1xuXG5cdFx0dmFyIGRlbHRhID0gZS5wYWdlWCAtIHRoaXMucmVzaXplTW91c2VTdGFydCxcblx0XHRcdHdpZHRoID0gTWF0aC5tYXgoNTAsIHRoaXMucmVzaXplV2lkdGhTdGFydCArIGRlbHRhKTtcblxuXHRcdHRoaXMud2lkdGgod2lkdGgpO1xuXHR9XG5cblx0VHJlZVZpZXcucHJvdG90eXBlLnJlc2l6ZVRvRml0Q29udGVudCA9IGZ1bmN0aW9uIChlKSB7XG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0dGhpcy53aWR0aCgxKTtcblx0XHR0aGlzLndpZHRoKHRoaXMubGlzdC5vdXRlcldpZHRoKCkpO1xuXHR9XG5cblx0cmV0dXJuIFRyZWVWaWV3O1xuXG59KShWaWV3KVxuIl19