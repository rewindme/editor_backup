var __hasProp = ({}).hasOwnProperty,
    __extends = function __extends(child, parent) {
	for (var key in parent) {
		if (__hasProp.call(parent, key)) child[key] = parent[key];
	}function ctor() {
		this.constructor = child;
	}ctor.prototype = parent.prototype;child.prototype = new ctor();child.__super__ = parent.prototype;return child;
},
    FS = require('fs-plus'),
    Path = require('path'),
    SSH2 = require('ssh2'),
    Connector = require('../connector');

module.exports = (function () {
	__extends(ConnectorSFTP, Connector);

	function ConnectorSFTP() {
		ConnectorSFTP.__super__.constructor.apply(this, arguments);
		this.ssh2 = null;
		this.sftp = null;
		this.status = 'disconnected';
	}

	ConnectorSFTP.prototype.isConnected = function () {
		var self = this;

		return self.status != 'disconnected' && self.sftp;
	};

	ConnectorSFTP.prototype.connect = function (info, completed) {
		var self = this;
		self.info = info;

		var debug = self.info.debug;
		self.info.debug = true;

		self.status = 'connecting';

		self.ssh2 = new SSH2();
		self.ssh2.on('banner', function (msg, lang) {
			self.emit('greeting', msg);
		});
		self.ssh2.on('ready', function () {
			self.ssh2.sftp(function (err, sftp) {
				if (err) {
					self.disconnect();
					return;
				}

				self.status = 'connected';

				self.sftp = sftp;
				self.sftp.on('end', function () {
					self.disconnect();
					self.emit('ended');
				});

				self.emit('connected');

				if (typeof completed === 'function') completed.apply(self, []);
			});
		});
		self.ssh2.on('end', function () {
			self.disconnect();
			self.emit('ended');
		});
		self.ssh2.on('close', function () {
			self.disconnect();
			self.emit('closed');
		});
		self.ssh2.on('error', function (err) {
			self.emit('error', err);
		});
		self.ssh2.on('debug', function (str) {
			if (typeof debug == 'function') debug.apply(null, [str]);
		});
		self.ssh2.on('keyboard-interactive', function (name, instructions, instructionsLang, prompts, finish) {
			finish([self.info.password]);
		});
		self.ssh2.connect(self.info);

		return self;
	};

	ConnectorSFTP.prototype.disconnect = function (completed) {
		var self = this;

		self.status = 'disconnected';

		if (self.sftp) {
			self.sftp.end();
			self.sftp = null;
		}

		if (self.ssh2) {
			self.ssh2.end();
			self.ssh2 = null;
		}

		if (typeof completed === 'function') completed.apply(null, []);

		return self;
	};

	ConnectorSFTP.prototype.abort = function (completed) {

		// TODO find a way to abort current operation

		if (typeof completed === 'function') completed.apply(null, []);

		return this;
	};

	ConnectorSFTP.prototype.list = function (path, recursive, completed) {
		var self = this;

		if (self.isConnected()) {
			if (recursive) {
				var digg = 0,
				    list = [];

				var e = function e() {
					if (typeof completed === 'function') completed.apply(null, [null, list]);
				};
				var l = function l(p) {
					++digg;
					self.sftp.readdir(p, function (err, lis) {
						if (err) return e();

						lis.forEach(function (item) {
							item.filename = Path.join(p, item.filename).replace(/\\/g, '/');
							item.date = new Date();
							item.date.setTime(item.attrs.mtime * 1000);
							list.push({
								name: item.filename,
								type: item.attrs.isFile() ? 'f' : 'd',
								size: item.attrs.size,
								date: item.date
							});
							if (!item.attrs.isFile()) {
								l(item.filename);
							}
						});

						if (--digg == 0) e();
					});
				};
				l(path);
			} else {
				self.sftp.readdir(path, function (err, lis) {
					var list = [];

					if (!err) {
						lis.forEach(function (item) {
							item.filename = Path.join(path, item.filename).replace(/\\/g, '/');
							item.date = new Date();
							item.date.setTime(item.attrs.mtime * 1000);
							list.push({
								name: item.filename,
								type: item.attrs.isFile() ? 'f' : 'd',
								size: item.attrs.size,
								date: item.date
							});
						});
					}

					if (typeof completed === 'function') completed.apply(null, [err, list]);
				});
			}
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return this;
	};

	ConnectorSFTP.prototype.get = function (path, recursive, completed, progress) {
		var self = this,
		    local = self.client.toLocal(path);

		if (self.isConnected()) {
			self.sftp.stat(path, function (err, stats) {
				if (err) {
					if (typeof completed === 'function') completed.apply(null, [err]);
					return;
				}

				if (stats.isFile()) {
					// File
					FS.makeTreeSync(Path.dirname(local));
					self.sftp.fastGet(path, local, {
						step: function step(read, chunk, size) {
							if (typeof progress === 'function') progress.apply(null, [read / size]);
						}
					}, function (err) {
						if (typeof completed === 'function') completed.apply(null, [err]);
						return;
					});
				} else {
					// Directory

					self.list(path, recursive, function (err, list) {
						list.unshift({ name: path, type: 'd' });
						list.forEach(function (item) {
							item.depth = item.name.replace(/^\/+/, '').replace(/\/+$/).split('/').length;
						});
						list.sort(function (a, b) {
							if (a.depth == b.depth) return 0;
							return a.depth > b.depth ? 1 : -1;
						});

						var error = null,
						    total = list.length,
						    i = -1;
						var e = function e() {
							if (typeof completed === 'function') completed.apply(null, [error, list]);
						};
						var n = function n() {
							++i;
							if (typeof progress === 'function') progress.apply(null, [i / total]);

							var item = list.shift();
							if (item == null) return e();
							var local = self.client.toLocal(item.name);
							if (item.type == 'd' || item.type == 'l') {
								//mkdirp(local, function (err) {
								FS.makeTree(local, function (err) {
									if (err) error = err;
									return n();
								});
							} else {
								self.sftp.fastGet(item.name, local, {
									step: function step(read, chunk, size) {
										if (typeof progress === 'function') progress.apply(null, [i / total + read / size / total]);
									}
								}, function (err) {
									if (err) error = err;
									return n();
								});
							}
						};
						n();
					});
				}
			});
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return self;
	};

	ConnectorSFTP.prototype.put = function (path, completed, progress) {
		var self = this,
		    remote = self.client.toRemote(path);

		if (self.isConnected()) {
			// File
			if (FS.isFileSync(path)) {
				var e = function e(err) {
					if (typeof completed === 'function') completed.apply(null, [err ? err : null, [{ name: path, type: 'f' }]]);
				};
				self.sftp.fastPut(path, remote, {
					step: function step(written, chunk, size) {
						if (typeof progress === 'function') progress.apply(null, [written / size]);
					}
				}, function (err) {
					if (err) {
						if (err.type == 'NO_SUCH_FILE') {
							self.mkdir(Path.dirname(remote).replace(/\\/g, '/'), true, function (err) {
								if (err) return e(err);

								self.sftp.fastPut(path, remote, {
									step: function step(written, chunk, size) {
										if (typeof progress === 'function') progress.apply(null, [written / size]);
									}
								}, function (err) {
									return e(err);
								});
							});
							return;
						}
						return e(err);
					}

					return e();
				});
			}

			// Folder
			else {
				self.client._traverseTree(path, function (list) {
					self.mkdir(remote, true, function (err) {
						var error,
						    i = -1,
						    total = list.length;
						var e = function e() {
							if (typeof completed === 'function') completed.apply(null, [error, list]);
						};
						var n = function n() {
							if (++i >= list.length) return e();
							var item = list[i],
							    remote = self.client.toRemote(item.name);
							if (item.type == 'd' || item.type == 'l') {
								self.sftp.mkdir(remote, {}, function (err) {
									if (err) error = err;
									return n();
								});
							} else {
								self.sftp.fastPut(item.name, remote, {
									step: function step(written, chunk, size) {
										if (typeof progress === 'function') progress.apply(null, [i / total + written / size / total]);
									}
								}, function (err) {
									if (err) error = err;
									return n();
								});
							}
						};
						return n();
					});
				});
			}
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return self;
	};

	ConnectorSFTP.prototype.mkdir = function (path, recursive, completed) {
		var self = this,
		    remotes = path.replace(/^\/+/, '').replace(/\/+$/, '').split('/'),
		    dirs = ['/' + remotes.slice(0, remotes.length).join('/')];

		if (self.isConnected()) {
			if (recursive) {
				for (var a = remotes.length - 1; a > 0; --a) dirs.unshift('/' + remotes.slice(0, a).join('/'));
			}

			var n = function n() {
				var dir = dirs.shift(),
				    last = dirs.length == 0;

				self.sftp.mkdir(dir, {}, function (err) {
					if (last) {
						if (typeof completed === 'function') completed.apply(null, [err ? err : null]);
					} else {
						return n();
					}
				});
			};
			n();
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return self;
	};

	ConnectorSFTP.prototype.mkfile = function (path, completed) {
		var self = this,
		    local = self.client.toLocal(path),
		    empty = new Buffer('', 'utf8');

		if (self.isConnected()) {
			self.sftp.open(path, 'w', {}, function (err, handle) {
				if (err) {
					if (typeof completed === 'function') completed.apply(null, [err]);
					return;
				}
				self.sftp.write(handle, empty, 0, 0, 0, function (err) {
					if (err) {
						if (typeof completed === 'function') completed.apply(null, [err]);
						return;
					}
					//mkdirp(Path.dirname(local), function (err1) {
					FS.makeTree(Path.dirname(local), function (err1) {
						FS.writeFile(local, empty, function (err2) {
							if (typeof completed === 'function') completed.apply(null, [err1 || err2]);
						});
					});
				});
			});
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return self;
	};

	ConnectorSFTP.prototype.rename = function (source, dest, completed) {
		var self = this;

		if (self.isConnected()) {
			self.sftp.rename(source, dest, function (err) {
				if (err) {
					if (typeof completed === 'function') completed.apply(null, [err]);
				} else {
					FS.rename(self.client.toLocal(source), self.client.toLocal(dest), function (err) {
						if (typeof completed === 'function') completed.apply(null, [err]);
					});
				}
			});
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return self;
	};

	ConnectorSFTP.prototype['delete'] = function (path, completed) {
		var self = this;

		if (self.isConnected()) {
			self.sftp.stat(path, function (err, stats) {
				if (err) {
					if (typeof completed === 'function') completed.apply(null, [err]);
					return;
				}

				if (stats.isFile()) {
					// File
					self.sftp.unlink(path, function (err) {
						if (typeof completed === 'function') completed.apply(null, [err, [{ name: path, type: 'f' }]]);
					});
				} else {
					// Directory
					self.list(path, true, function (err, list) {
						list.forEach(function (item) {
							item.depth = item.name.replace(/^\/+/, '').replace(/\/+$/).split('/').length;
						});
						list.sort(function (a, b) {
							if (a.depth == b.depth) return 0;
							return a.depth > b.depth ? -1 : 1;
						});

						var done = 0;

						var e = function e() {
							self.sftp.rmdir(path, function (err) {
								if (typeof completed === 'function') completed.apply(null, [err, list]);
							});
						};
						list.forEach(function (item) {
							++done;
							var fn = item.type == 'd' || item.type == 'l' ? 'rmdir' : 'unlink';
							self.sftp[fn](item.name, function (err) {
								if (--done == 0) return e();
							});
						});
						if (list.length == 0) e();
					});
				}
			});
		} else {
			if (typeof completed === 'function') completed.apply(null, ['Not connected']);
		}

		return self;
	};

	return ConnectorSFTP;
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9uYXZlci8uYXRvbS9wYWNrYWdlcy9yZW1vdGUtZnRwL2xpYi9jb25uZWN0b3JzL3NmdHAuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSSxTQUFTLEdBQUcsQ0FBQSxHQUFFLENBQUMsY0FBYztJQUNoQyxTQUFTLEdBQUcsU0FBWixTQUFTLENBQVksS0FBSyxFQUFFLE1BQU0sRUFBRTtBQUFFLE1BQUssSUFBSSxHQUFHLElBQUksTUFBTSxFQUFFO0FBQUUsTUFBSSxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsRUFBRSxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0VBQUUsQUFBQyxTQUFTLElBQUksR0FBRztBQUFFLE1BQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDO0VBQUUsQUFBQyxJQUFJLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQUFBQyxLQUFLLENBQUMsU0FBUyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsQUFBQyxLQUFLLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQUFBQyxPQUFPLEtBQUssQ0FBQztDQUFFO0lBQy9SLEVBQUUsR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDO0lBQ3ZCLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDO0lBQ3RCLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDO0lBQ3RCLFNBQVMsR0FBRyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUM7O0FBR3JDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsQ0FBQyxZQUFZO0FBQzdCLFVBQVMsQ0FBQyxhQUFhLEVBQUUsU0FBUyxDQUFDLENBQUM7O0FBRXBDLFVBQVMsYUFBYSxHQUFJO0FBQ3pCLGVBQWEsQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7QUFDM0QsTUFBSSxD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RyxDQUFDIiwiZmlsZSI6Ii9Vc2Vycy9uYXZlci8uYXRvbS9wYWNrYWdlcy9yZW1vdGUtZnRwL2xpYi9jb25uZWN0b3JzL3NmdHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG5cdF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9LFxuXHRGUyA9IHJlcXVpcmUoJ2ZzLXBsdXMnKSxcblx0UGF0aCA9IHJlcXVpcmUoJ3BhdGgnKSxcblx0U1NIMiA9IHJlcXVpcmUoJ3NzaDInKSxcblx0Q29ubmVjdG9yID0gcmVxdWlyZSgnLi4vY29ubmVjdG9yJyk7XG5cblxubW9kdWxlLmV4cG9ydHMgPSAoZnVuY3Rpb24gKCkge1xuXHRfX2V4dGVuZHMoQ29ubmVjdG9yU0ZUUCwgQ29ubmVjdG9yKTtcblxuXHRmdW5jdGlvbiBDb25uZWN0b3JTRlRQICgpIHtcblx0XHRDb25uZWN0b3JTRlRQLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuXHRcdHRoaXMuc3NoMiA9IG51bGw7XG5cdFx0dGhpcy5zZnRwID0gbnVsbDtcblx0XHR0aGlzLnN0YXR1cyA9ICdkaXNjb25uZWN0ZWQnO1xuXHR9XG5cblx0Q29ubmVjdG9yU0ZUUC5wcm90b3R5cGUuaXNDb25uZWN0ZWQgPSBmdW5jdGlvbiAoKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0cmV0dXJuIHNlbGYuc3RhdHVzICE9ICdkaXNjb25uZWN0ZWQnICYmIHNlbGYuc2Z0cDtcblx0fTtcblxuXHRDb25uZWN0b3JTRlRQLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gKGluZm8sIGNvbXBsZXRlZCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblx0XHRzZWxmLmluZm8gPSBpbmZvO1xuXG5cdFx0dmFyIGRlYnVnID0gc2VsZi5pbmZvLmRlYnVnO1xuXHRcdHNlbGYuaW5mby5kZWJ1ZyA9IHRydWU7XG5cblx0XHRzZWxmLnN0YXR1cyA9ICdjb25uZWN0aW5nJztcblxuXHRcdHNlbGYuc3NoMiA9IG5ldyBTU0gyKCk7XG5cdFx0c2VsZi5zc2gyLm9uKCdiYW5uZXInLCBmdW5jdGlvbiAobXNnLCBsYW5nKSB7XG5cdFx0XHRzZWxmLmVtaXQoJ2dyZWV0aW5nJywgbXNnKTtcblx0XHR9KTtcblx0XHRzZWxmLnNzaDIub24oJ3JlYWR5JywgZnVuY3Rpb24gKCkge1xuXHRcdFx0c2VsZi5zc2gyLnNmdHAoZnVuY3Rpb24gKGVyciwgc2Z0cCkge1xuXHRcdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdFx0c2VsZi5kaXNjb25uZWN0KCk7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZi5zdGF0dXMgPSAnY29ubmVjdGVkJztcblxuXHRcdFx0XHRzZWxmLnNmdHAgPSBzZnRwO1xuXHRcdFx0XHRzZWxmLnNmdHAub24oJ2VuZCcsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRzZWxmLmRpc2Nvbm5lY3QoKTtcblx0XHRcdFx0XHRzZWxmLmVtaXQoJ2VuZGVkJyk7XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdHNlbGYuZW1pdCgnY29ubmVjdGVkJyk7XG5cblx0XHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KHNlbGYsIFtdKTtcblx0XHRcdH0pO1xuXG5cdFx0fSk7XG5cdFx0c2VsZi5zc2gyLm9uKCdlbmQnLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRzZWxmLmRpc2Nvbm5lY3QoKTtcblx0XHRcdHNlbGYuZW1pdCgnZW5kZWQnKTtcblx0XHR9KTtcblx0XHRzZWxmLnNzaDIub24oJ2Nsb3NlJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0c2VsZi5kaXNjb25uZWN0KCk7XG5cdFx0XHRzZWxmLmVtaXQoJ2Nsb3NlZCcpO1xuXHRcdH0pO1xuXHRcdHNlbGYuc3NoMi5vbignZXJyb3InLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRzZWxmLmVtaXQoJ2Vycm9yJywgZXJyKTtcblx0XHR9KTtcblx0XHRzZWxmLnNzaDIub24oJ2RlYnVnJywgZnVuY3Rpb24gKHN0cikge1xuXHRcdFx0aWYgKHR5cGVvZiBkZWJ1ZyA9PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRkZWJ1Zy5hcHBseShudWxsLCBbc3RyXSk7XG5cdFx0fSk7XG5cdFx0c2VsZi5zc2gyLm9uKCdrZXlib2FyZC1pbnRlcmFjdGl2ZScsIGZ1bmN0aW9uIChuYW1lLCBpbnN0cnVjdGlvbnMsIGluc3RydWN0aW9uc0xhbmcsIHByb21wdHMsIGZpbmlzaCkge1xuXHRcdFx0ZmluaXNoKFtzZWxmLmluZm8ucGFzc3dvcmRdKTtcblx0XHR9KTtcblx0XHRzZWxmLnNzaDIuY29ubmVjdChzZWxmLmluZm8pO1xuXG5cdFx0cmV0dXJuIHNlbGY7XG5cdH1cblxuXHRDb25uZWN0b3JTRlRQLnByb3RvdHlwZS5kaXNjb25uZWN0ID0gZnVuY3Rpb24gKGNvbXBsZXRlZCkge1xuXHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdHNlbGYuc3RhdHVzID0gJ2Rpc2Nvbm5lY3RlZCc7XG5cblx0XHRpZiAoc2VsZi5zZnRwKSB7XG5cdFx0XHRzZWxmLnNmdHAuZW5kKCk7XG5cdFx0XHRzZWxmLnNmdHAgPSBudWxsO1xuXHRcdH1cblxuXHRcdGlmIChzZWxmLnNzaDIpIHtcblx0XHRcdHNlbGYuc3NoMi5lbmQoKTtcblx0XHRcdHNlbGYuc3NoMiA9IG51bGw7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgW10pO1xuXG5cdFx0cmV0dXJuIHNlbGY7XG5cdH1cblxuXHRDb25uZWN0b3JTRlRQLnByb3RvdHlwZS5hYm9ydCA9IGZ1bmN0aW9uIChjb21wbGV0ZWQpIHtcblxuXHRcdC8vIFRPRE8gZmluZCBhIHdheSB0byBhYm9ydCBjdXJyZW50IG9wZXJhdGlvblxuXG5cdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgW10pO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRDb25uZWN0b3JTRlRQLnByb3RvdHlwZS5saXN0ID0gZnVuY3Rpb24gKHBhdGgsIHJlY3Vyc2l2ZSwgY29tcGxldGVkKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0aWYgKHNlbGYuaXNDb25uZWN0ZWQoKSkge1xuXHRcdFx0aWYgKHJlY3Vyc2l2ZSkge1xuXHRcdFx0XHR2YXIgZGlnZyA9IDAsXG5cdFx0XHRcdFx0bGlzdCA9IFtdO1xuXG5cdFx0XHRcdHZhciBlID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFtudWxsLCBsaXN0XSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0dmFyIGwgPSBmdW5jdGlvbiAocCkge1xuXHRcdFx0XHRcdCsrZGlnZztcblx0XHRcdFx0XHRzZWxmLnNmdHAucmVhZGRpcihwLCBmdW5jdGlvbiAoZXJyLCBsaXMpIHtcblx0XHRcdFx0XHRcdGlmIChlcnIpXG5cdFx0XHRcdFx0XHRcdHJldHVybiBlKCk7XG5cblx0XHRcdFx0XHRcdGxpcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRcdFx0XHRcdGl0ZW0uZmlsZW5hbWUgPSBQYXRoLmpvaW4ocCwgaXRlbS5maWxlbmFtZSkucmVwbGFjZSgvXFxcXC9nLCAnLycpO1xuXHRcdFx0XHRcdFx0XHRpdGVtLmRhdGUgPSBuZXcgRGF0ZSgpO1xuXHRcdFx0XHRcdFx0XHRpdGVtLmRhdGUuc2V0VGltZShpdGVtLmF0dHJzLm10aW1lICogMTAwMCk7XG5cdFx0XHRcdFx0XHRcdGxpc3QucHVzaCh7XG5cdFx0XHRcdFx0XHRcdFx0bmFtZTogaXRlbS5maWxlbmFtZSxcblx0XHRcdFx0XHRcdFx0XHR0eXBlOiBpdGVtLmF0dHJzLmlzRmlsZSgpID8gJ2YnIDogJ2QnLFxuXHRcdFx0XHRcdFx0XHRcdHNpemU6IGl0ZW0uYXR0cnMuc2l6ZSxcblx0XHRcdFx0XHRcdFx0XHRkYXRlOiBpdGVtLmRhdGVcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdGlmICghaXRlbS5hdHRycy5pc0ZpbGUoKSkge1xuXHRcdFx0XHRcdFx0XHRcdGwoaXRlbS5maWxlbmFtZSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRpZiAoLS1kaWdnID09IDApXG5cdFx0XHRcdFx0XHRcdGUoKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0XHRsKHBhdGgpO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdHNlbGYuc2Z0cC5yZWFkZGlyKHBhdGgsIGZ1bmN0aW9uIChlcnIsIGxpcykge1xuXHRcdFx0XHRcdHZhciBsaXN0ID0gW107XG5cblx0XHRcdFx0XHRpZiAoIWVycikge1xuXHRcdFx0XHRcdFx0bGlzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdFx0XHRcdFx0aXRlbS5maWxlbmFtZSA9IFBhdGguam9pbihwYXRoLCBpdGVtLmZpbGVuYW1lKS5yZXBsYWNlKC9cXFxcL2csICcvJyk7XG5cdFx0XHRcdFx0XHRcdGl0ZW0uZGF0ZSA9IG5ldyBEYXRlKCk7XG5cdFx0XHRcdFx0XHRcdGl0ZW0uZGF0ZS5zZXRUaW1lKGl0ZW0uYXR0cnMubXRpbWUgKiAxMDAwKTtcblx0XHRcdFx0XHRcdFx0bGlzdC5wdXNoKHtcblx0XHRcdFx0XHRcdFx0XHRuYW1lOiBpdGVtLmZpbGVuYW1lLFxuXHRcdFx0XHRcdFx0XHRcdHR5cGU6IGl0ZW0uYXR0cnMuaXNGaWxlKCkgPyAnZicgOiAnZCcsXG5cdFx0XHRcdFx0XHRcdFx0c2l6ZTogaXRlbS5hdHRycy5zaXplLFxuXHRcdFx0XHRcdFx0XHRcdGRhdGU6IGl0ZW0uZGF0ZVxuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFtlcnIsIGxpc3RdKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGVsc2Uge1xuXHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbJ05vdCBjb25uZWN0ZWQnXSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRDb25uZWN0b3JTRlRQLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAocGF0aCwgcmVjdXJzaXZlLCBjb21wbGV0ZWQsIHByb2dyZXNzKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0bG9jYWwgPSBzZWxmLmNsaWVudC50b0xvY2FsKHBhdGgpO1xuXG5cdFx0aWYgKHNlbGYuaXNDb25uZWN0ZWQoKSkge1xuXHRcdFx0c2VsZi5zZnRwLnN0YXQocGF0aCwgZnVuY3Rpb24gKGVyciwgc3RhdHMpIHtcblx0XHRcdFx0aWYgKGVycikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFtlcnJdKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc3RhdHMuaXNGaWxlKCkpIHtcblx0XHRcdFx0XHQvLyBGaWxlXG5cdFx0XHRcdFx0RlMubWFrZVRyZWVTeW5jKFBhdGguZGlybmFtZShsb2NhbCkpO1xuXHRcdFx0XHRcdHNlbGYuc2Z0cC5mYXN0R2V0KHBhdGgsIGxvY2FsLCB7XG5cdFx0XHRcdFx0XHRzdGVwOiBmdW5jdGlvbiAocmVhZCwgY2h1bmssIHNpemUpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBwcm9ncmVzcyA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdFx0XHRwcm9ncmVzcy5hcHBseShudWxsLCBbcmVhZCAvIHNpemVdKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9LCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFtlcnJdKTtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0XHRlbHNlIHtcblx0XHRcdFx0XHQvLyBEaXJlY3RvcnlcblxuXHRcdFx0XHRcdHNlbGYubGlzdChwYXRoLCByZWN1cnNpdmUsIGZ1bmN0aW9uIChlcnIsIGxpc3QpIHtcblx0XHRcdFx0XHRcdGxpc3QudW5zaGlmdCh7bmFtZTogcGF0aCwgdHlwZTogJ2QnfSk7XG5cdFx0XHRcdFx0XHRsaXN0LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsgaXRlbS5kZXB0aCA9IGl0ZW0ubmFtZS5yZXBsYWNlKC9eXFwvKy8sICcnKS5yZXBsYWNlKC9cXC8rJC8pLnNwbGl0KCcvJykubGVuZ3RoOyB9KTtcblx0XHRcdFx0XHRcdGxpc3Quc29ydChmdW5jdGlvbiAoYSwgYikge1xuXHRcdFx0XHRcdFx0XHRpZiAoYS5kZXB0aCA9PSBiLmRlcHRoKVxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiAwO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gYS5kZXB0aCA+IGIuZGVwdGggPyAxIDogLTE7XG5cdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0dmFyIGVycm9yID0gbnVsbCxcblx0XHRcdFx0XHRcdFx0dG90YWwgPSBsaXN0Lmxlbmd0aCxcblx0XHRcdFx0XHRcdFx0aSA9IC0xO1xuXHRcdFx0XHRcdFx0dmFyIGUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbZXJyb3IsIGxpc3RdKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHZhciBuID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHQrK2k7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YgcHJvZ3Jlc3MgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRcdFx0cHJvZ3Jlc3MuYXBwbHkobnVsbCwgW2kgLyB0b3RhbF0pO1xuXG5cdFx0XHRcdFx0XHRcdHZhciBpdGVtID0gbGlzdC5zaGlmdCgpO1xuXHRcdFx0XHRcdFx0XHRpZiAoaXRlbSA9PSBudWxsKVxuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBlKCk7XG5cdFx0XHRcdFx0XHRcdHZhciBsb2NhbCA9IHNlbGYuY2xpZW50LnRvTG9jYWwoaXRlbS5uYW1lKTtcblx0XHRcdFx0XHRcdFx0aWYgKGl0ZW0udHlwZSA9PSAnZCcgfHwgaXRlbS50eXBlID09ICdsJykge1xuXHRcdFx0XHRcdFx0XHRcdC8vbWtkaXJwKGxvY2FsLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdFx0RlMubWFrZVRyZWUobG9jYWwsIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGlmIChlcnIpXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGVycm9yID0gZXJyO1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIG4oKTtcblx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRzZWxmLnNmdHAuZmFzdEdldChpdGVtLm5hbWUsIGxvY2FsLCB7XG5cdFx0XHRcdFx0XHRcdFx0XHRzdGVwOiBmdW5jdGlvbiAocmVhZCwgY2h1bmssIHNpemUpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBwcm9ncmVzcyA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRwcm9ncmVzcy5hcHBseShudWxsLCBbKGkgLyB0b3RhbCkgKyAocmVhZCAvIHNpemUgLyB0b3RhbCldKTtcblx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHR9LCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoZXJyKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRlcnJvciA9IGVycjtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBuKCk7XG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdG4oKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdGVsc2Uge1xuXHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbJ05vdCBjb25uZWN0ZWQnXSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHNlbGY7XG5cdH1cblxuXHRDb25uZWN0b3JTRlRQLnByb3RvdHlwZS5wdXQgPSBmdW5jdGlvbiAocGF0aCwgY29tcGxldGVkLCBwcm9ncmVzcykge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdHJlbW90ZSA9IHNlbGYuY2xpZW50LnRvUmVtb3RlKHBhdGgpO1xuXG5cdFx0aWYgKHNlbGYuaXNDb25uZWN0ZWQoKSkge1xuXHRcdFx0Ly8gRmlsZVxuXHRcdFx0aWYgKEZTLmlzRmlsZVN5bmMocGF0aCkpIHtcblx0XHRcdFx0dmFyIGUgPSBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgW2VyciA/IGVyciA6IG51bGwsIFt7bmFtZTogcGF0aCwgdHlwZTogJ2YnfV1dKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRzZWxmLnNmdHAuZmFzdFB1dChwYXRoLCByZW1vdGUsIHtcblx0XHRcdFx0XHRzdGVwOiBmdW5jdGlvbiAod3JpdHRlbiwgY2h1bmssIHNpemUpIHtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YgcHJvZ3Jlc3MgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRcdHByb2dyZXNzLmFwcGx5KG51bGwsIFt3cml0dGVuIC8gc2l6ZV0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSwgZnVuY3Rpb24gKGVycikge1xuXHRcdFx0XHRcdGlmIChlcnIpIHtcblx0XHRcdFx0XHRcdGlmIChlcnIudHlwZSA9PSAnTk9fU1VDSF9GSUxFJykge1xuXHRcdFx0XHRcdFx0XHRzZWxmLm1rZGlyKFBhdGguZGlybmFtZShyZW1vdGUpLnJlcGxhY2UoL1xcXFwvZywgJy8nKSwgdHJ1ZSwgZnVuY3Rpb24gKGVycikge1xuXHRcdFx0XHRcdFx0XHRcdGlmIChlcnIpXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZShlcnIpO1xuXG5cdFx0XHRcdFx0XHRcdFx0c2VsZi5zZnRwLmZhc3RQdXQocGF0aCwgcmVtb3RlLCB7XG5cdFx0XHRcdFx0XHRcdFx0XHRzdGVwOiBmdW5jdGlvbiAod3JpdHRlbiwgY2h1bmssIHNpemUpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBwcm9ncmVzcyA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRwcm9ncmVzcy5hcHBseShudWxsLCBbd3JpdHRlbiAvIHNpemVdKTtcblx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHR9LCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZShlcnIpXG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gZShlcnIpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJldHVybiBlKCk7XG5cdFx0XHRcdH0pXG5cblx0XHRcdH1cblxuXHRcdFx0Ly8gRm9sZGVyXG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0c2VsZi5jbGllbnQuX3RyYXZlcnNlVHJlZShwYXRoLCBmdW5jdGlvbiAobGlzdCkge1xuXHRcdFx0XHRcdHNlbGYubWtkaXIocmVtb3RlLCB0cnVlLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHR2YXIgZXJyb3IsXG5cdFx0XHRcdFx0XHRcdGkgPSAtMSxcblx0XHRcdFx0XHRcdFx0dG90YWwgPSBsaXN0Lmxlbmd0aDtcblx0XHRcdFx0XHRcdHZhciBlID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgW2Vycm9yLCBsaXN0XSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR2YXIgbiA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHRcdFx0aWYgKCsraSA+PSBsaXN0Lmxlbmd0aClcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZSgpO1xuXHRcdFx0XHRcdFx0XHR2YXIgaXRlbSA9IGxpc3RbaV0sXG5cdFx0XHRcdFx0XHRcdFx0cmVtb3RlID0gc2VsZi5jbGllbnQudG9SZW1vdGUoaXRlbS5uYW1lKTtcblx0XHRcdFx0XHRcdFx0aWYgKGl0ZW0udHlwZSA9PSAnZCcgfHwgaXRlbS50eXBlID09ICdsJykge1xuXHRcdFx0XHRcdFx0XHRcdHNlbGYuc2Z0cC5ta2RpcihyZW1vdGUsIHt9LCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAoZXJyKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRlcnJvciA9IGVycjtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBuKCk7XG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0c2VsZi5zZnRwLmZhc3RQdXQoaXRlbS5uYW1lLCByZW1vdGUsIHtcblx0XHRcdFx0XHRcdFx0XHRcdHN0ZXA6IGZ1bmN0aW9uICh3cml0dGVuLCBjaHVuaywgc2l6ZSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZW9mIHByb2dyZXNzID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHByb2dyZXNzLmFwcGx5KG51bGwsIFsoaSAvIHRvdGFsKSArICh3cml0dGVuIC8gc2l6ZSAvIHRvdGFsKV0pO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdH0sIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGlmIChlcnIpXG5cdFx0XHRcdFx0XHRcdFx0XHRcdGVycm9yID0gZXJyO1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIG4oKTtcblx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIG4oKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGVsc2Uge1xuXHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbJ05vdCBjb25uZWN0ZWQnXSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHNlbGY7XG5cdH1cblxuXHRDb25uZWN0b3JTRlRQLnByb3RvdHlwZS5ta2RpciA9IGZ1bmN0aW9uIChwYXRoLCByZWN1cnNpdmUsIGNvbXBsZXRlZCkge1xuXHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdHJlbW90ZXMgPSBwYXRoLnJlcGxhY2UoL15cXC8rLywgJycpLnJlcGxhY2UoL1xcLyskLywgJycpLnNwbGl0KCcvJyksXG5cdFx0XHRkaXJzID0gWycvJyArIHJlbW90ZXMuc2xpY2UoMCwgcmVtb3Rlcy5sZW5ndGgpLmpvaW4oJy8nKV07XG5cblx0XHRpZiAoc2VsZi5pc0Nvbm5lY3RlZCgpKSB7XG5cdFx0XHRpZiAocmVjdXJzaXZlKSB7XG5cdFx0XHRcdGZvciAodmFyIGEgPSByZW1vdGVzLmxlbmd0aCAtIDE7IGEgPiAwOyAtLWEpXG5cdFx0XHRcdFx0ZGlycy51bnNoaWZ0KCcvJyArIHJlbW90ZXMuc2xpY2UoMCwgYSkuam9pbignLycpKTtcblx0XHRcdH1cblxuXHRcdFx0dmFyIG4gPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdHZhciBkaXIgPSBkaXJzLnNoaWZ0KCksXG5cdFx0XHRcdFx0bGFzdCA9IGRpcnMubGVuZ3RoID09IDA7XG5cblx0XHRcdFx0c2VsZi5zZnRwLm1rZGlyKGRpciwge30sIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0XHRpZiAobGFzdCkge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbZXJyID8gZXJyIDogbnVsbF0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gbigpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHRuKCk7XG5cdFx0fVxuXHRcdGVsc2Uge1xuXHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbJ05vdCBjb25uZWN0ZWQnXSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHNlbGY7XG5cdH1cblxuXHRDb25uZWN0b3JTRlRQLnByb3RvdHlwZS5ta2ZpbGUgPSBmdW5jdGlvbiAocGF0aCwgY29tcGxldGVkKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0bG9jYWwgPSBzZWxmLmNsaWVudC50b0xvY2FsKHBhdGgpLFxuXHRcdFx0ZW1wdHkgPSBuZXcgQnVmZmVyKCcnLCAndXRmOCcpO1xuXG5cdFx0aWYgKHNlbGYuaXNDb25uZWN0ZWQoKSkge1xuXHRcdFx0c2VsZi5zZnRwLm9wZW4ocGF0aCwgJ3cnLCB7fSwgZnVuY3Rpb24gKGVyciwgaGFuZGxlKSB7XG5cdFx0XHRcdGlmIChlcnIpIHtcblx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbZXJyXSk7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHNlbGYuc2Z0cC53cml0ZShoYW5kbGUsIGVtcHR5LCAwLCAwLCAwLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0aWYgKGVycikge1xuXHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbZXJyXSk7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdC8vbWtkaXJwKFBhdGguZGlybmFtZShsb2NhbCksIGZ1bmN0aW9uIChlcnIxKSB7XG5cdFx0XHRcdFx0RlMubWFrZVRyZWUoUGF0aC5kaXJuYW1lKGxvY2FsKSwgZnVuY3Rpb24gKGVycjEpIHtcblx0XHRcdFx0XHRcdEZTLndyaXRlRmlsZShsb2NhbCwgZW1wdHksIGZ1bmN0aW9uIChlcnIyKSB7XG5cdFx0XHRcdFx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbZXJyMSB8fCBlcnIyXSk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSlcblx0XHRcdH0pO1xuXHRcdH1cblx0XHRlbHNlIHtcblx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgWydOb3QgY29ubmVjdGVkJ10pO1xuXHRcdH1cblxuXHRcdHJldHVybiBzZWxmO1xuXHR9XG5cblx0Q29ubmVjdG9yU0ZUUC5wcm90b3R5cGUucmVuYW1lID0gZnVuY3Rpb24gKHNvdXJjZSwgZGVzdCwgY29tcGxldGVkKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0aWYgKHNlbGYuaXNDb25uZWN0ZWQoKSkge1xuXHRcdFx0c2VsZi5zZnRwLnJlbmFtZShzb3VyY2UsIGRlc3QsIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0aWYgKGVycikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFtlcnJdKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRGUy5yZW5hbWUoc2VsZi5jbGllbnQudG9Mb2NhbChzb3VyY2UpLCBzZWxmLmNsaWVudC50b0xvY2FsKGRlc3QpLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFtlcnJdKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdGVsc2Uge1xuXHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbJ05vdCBjb25uZWN0ZWQnXSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHNlbGY7XG5cdH1cblxuXHRDb25uZWN0b3JTRlRQLnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbiAocGF0aCwgY29tcGxldGVkKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0aWYgKHNlbGYuaXNDb25uZWN0ZWQoKSkge1xuXHRcdFx0c2VsZi5zZnRwLnN0YXQocGF0aCwgZnVuY3Rpb24gKGVyciwgc3RhdHMpIHtcblx0XHRcdFx0aWYgKGVycikge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YgY29tcGxldGVkID09PSAnZnVuY3Rpb24nKVxuXHRcdFx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFtlcnJdKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoc3RhdHMuaXNGaWxlKCkpIHtcblx0XHRcdFx0XHQvLyBGaWxlXG5cdFx0XHRcdFx0c2VsZi5zZnRwLnVubGluayhwYXRoLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mIGNvbXBsZXRlZCA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdFx0XHRcdFx0Y29tcGxldGVkLmFwcGx5KG51bGwsIFtlcnIsIFt7bmFtZTogcGF0aCwgdHlwZTogJ2YnfV1dKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0XHRlbHNlIHtcblx0XHRcdFx0XHQvLyBEaXJlY3Rvcnlcblx0XHRcdFx0XHRzZWxmLmxpc3QocGF0aCwgdHJ1ZSwgZnVuY3Rpb24gKGVyciwgbGlzdCkge1xuXHRcdFx0XHRcdFx0bGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7IGl0ZW0uZGVwdGggPSBpdGVtLm5hbWUucmVwbGFjZSgvXlxcLysvLCAnJykucmVwbGFjZSgvXFwvKyQvKS5zcGxpdCgnLycpLmxlbmd0aDsgfSk7XG5cdFx0XHRcdFx0XHRsaXN0LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcblx0XHRcdFx0XHRcdFx0aWYgKGEuZGVwdGggPT0gYi5kZXB0aClcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gMDtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGEuZGVwdGggPiBiLmRlcHRoID8gLTEgOiAxO1xuXHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdHZhciBkb25lID0gMDtcblxuXHRcdFx0XHRcdFx0dmFyIGUgPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRcdHNlbGYuc2Z0cC5ybWRpcihwYXRoLCBmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdFx0XHRcdFx0XHRjb21wbGV0ZWQuYXBwbHkobnVsbCwgW2VyciwgbGlzdF0pO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGxpc3QuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0XHRcdFx0XHQrK2RvbmU7XG5cdFx0XHRcdFx0XHRcdHZhciBmbiA9IGl0ZW0udHlwZSA9PSAnZCcgfHwgaXRlbS50eXBlID09ICdsJyA/ICdybWRpcicgOiAndW5saW5rJztcblx0XHRcdFx0XHRcdFx0c2VsZi5zZnRwW2ZuXShpdGVtLm5hbWUsIGZ1bmN0aW9uIChlcnIpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAoLS1kb25lID09IDApXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZSgpO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0aWYgKGxpc3QubGVuZ3RoID09IDApXG5cdFx0XHRcdFx0XHRcdGUoKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdGVsc2Uge1xuXHRcdFx0aWYgKHR5cGVvZiBjb21wbGV0ZWQgPT09ICdmdW5jdGlvbicpXG5cdFx0XHRcdGNvbXBsZXRlZC5hcHBseShudWxsLCBbJ05vdCBjb25uZWN0ZWQnXSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHNlbGY7XG5cdH1cblxuXHRyZXR1cm4gQ29ubmVjdG9yU0ZUUDtcbn0pKCk7XG4iXX0=