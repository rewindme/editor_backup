var __hasProp = ({}).hasOwnProperty,
    __extends = function __extends(child, parent) {
	for (var key in parent) {
		if (__hasProp.call(parent, key)) child[key] = parent[key];
	}function ctor() {
		this.constructor = child;
	}ctor.prototype = parent.prototype;child.prototype = new ctor();child.__super__ = parent.prototype;return child;
},
    path = require('path'),
    File = require('./file'),
    Model = require('theorist').Model;

module.exports = Directory = (function (parent) {
	__extends(Directory, parent);

	Directory.properties({
		parent: null,
		name: '',
		path: '',
		client: null,
		isExpanded: false,
		status: 0,
		folders: [],
		files: []
	});

	Directory.prototype.accessor('isRoot', function () {
		return this.parent == null;
	});

	Directory.prototype.accessor('local', function () {
		if (this.parent) return path.normalize(path.join(this.parent.local, this.name)).replace(/\\/g, '/');

		return atom.project.getPaths()[0];
		//return atom.project.path;
		//return atom.project.resolve('/' + this.name);
	});

	Directory.prototype.accessor('remote', function () {
		if (this.parent) return path.normalize(path.join(this.parent.remote, this.name)).replace(/\\/g, '/');
		return this.path;
	});

	Directory.prototype.accessor('root', function () {
		if (this.parent) return this.parent.root;
		return this;
	});

	function Directory() {
		Directory.__super__.constructor.apply(this, arguments);
	}

	Directory.prototype.destroy = function () {

		this.folders.forEach(function (folder) {
			folder.destroy();
		});
		this.folders = [];

		this.files.forEach(function (file) {
			file.destroy();
		});
		this.files = [];

		if (!this.isRoot) Directory.__super__.destroy.apply(this, arguments);
	};

	Directory.prototype.sort = function () {

		this.folders.sort(function (a, b) {
			if (a.name == b.name) return 0;
			return a.name > b.name ? 1 : -1;
		});

		this.files.sort(function (a, b) {
			if (a.name == b.name) return 0;
			return a.name > b.name ? 1 : -1;
		});
	};

	Directory.prototype.exists = function (name, isdir) {
		if (isdir) {
			for (var a = 0, b = this.folders.length; a < b; ++a) if (this.folders[a].name == name) return a;
		} else {
			for (var a = 0, b = this.files.length; a < b; ++a) if (this.files[a].name == name) return a;
		}
		return null;
	};

	Directory.prototype.open = function (recursive, complete) {
		var self = this,
		    client = self.root.client;

		client.list(self.remote, false, function (err, list) {
			if (err) return;

			self.status = 1;

			var folders = [],
			    files = [];

			list.forEach(function (item) {
				var index,
				    name = path.basename(item.name),
				    entry;
				if (item.type == 'd' || item.type == 'l') {
					if (name == '.' || name == '..') return;
					if ((index = self.exists(name, true)) === null) {
						entry = new Directory({
							parent: self,
							name: name
						});
					} else {
						entry = self.folders[index];
						self.folders.splice(index, 1);
					}
					folders.push(entry);
				} else {
					if ((index = self.exists(name, false)) === null) {
						entry = new File({
							parent: self,
							name: name
						});
					} else {
						entry = self.files[index];
						self.files.splice(index, 1);
					}
					entry.size = item.size;
					entry.date = item.date;
					files.push(entry);
				}
			});

			self.folders.forEach(function (folder) {
				folder.destroy();
			});
			self.folders = folders;

			self.files.forEach(function (file) {
				file.destroy();
			});
			self.files = files;

			if (recursive) {
				self.folders.forEach(function (folder) {
					if (folder.status == 0) return;

					folder.open(true);
				});
			}

			if (typeof complete === 'function') {
				complete.call(null);
			}
		});
	};

	Directory.prototype.openPath = function (path) {

		var self = this,
		    client = self.root.client;

		var remainingPath = path.replace(self.remote, '');
		if (remainingPath.startsWith('/')) remainingPath = remainingPath.substr(1);

		if (remainingPath.length > 0) {
			var remainingPathSplit = remainingPath.split('/');

			if (remainingPathSplit.length > 0 && self.folders.length > 0) {
				var nextPath = self.remote;

				if (!nextPath.endsWith('/')) nextPath += '/';

				nextPath += remainingPathSplit[0];

				self.folders.forEach(function (folder) {
					if (folder.remote === nextPath) {
						folder.isExpanded = true;

						if (folder.folders.length > 0) {
							folder.openPath(path);
						} else {
							folder.open(false, function () {
								folder.openPath(path);
							});
						}

						return false;
					}
				});
			}
		}
	};

	return Directory;
})(Model);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9uYXZlci8uYXRvbS9wYWNrYWdlcy9yZW1vdGUtZnRwL2xpYi9kaXJlY3RvcnkuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSSxTQUFTLEdBQUcsQ0FBQSxHQUFFLENBQUMsY0FBYztJQUNoQyxTQUFTLEdBQUcsU0FBWixTQUFTLENBQVksS0FBSyxFQUFFLE1BQU0sRUFBRTtBQUFFLE1BQUssSUFBSSxHQUFHLElBQUksTUFBTSxFQUFFO0FBQUUsTUFBSSxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsRUFBRSxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0VBQUUsQUFBQyxTQUFTLElBQUksR0FBRztBQUFFLE1BQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDO0VBQUUsQUFBQyxJQUFJLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQUFBQyxLQUFLLENBQUMsU0FBUyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsQUFBQyxLQUFLLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQUFBQyxPQUFPLEtBQUssQ0FBQztDQUFFO0lBQy9SLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDO0lBQ3RCLElBQUksR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDO0lBQ3hCLEtBQUssR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsS0FBSyxDQUFDOztBQUVuQyxNQUFNLENBQUMsT0FBTyxHQUFHLFNBQVMsR0FBRyxDQUFDLFVBQVUsTUFBTSxFQUFFO0FBQy9DLFVBQVMsQ0FBQyxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7O0FBRTdCLFVBQVMsQ0FBQyxVQUFVLENBQUM7QUFDcEIsUUFBTSxFQUFFLElBQUk7QUFDWixNQUFJLEVBQUUsRUFBRTtBQUNSLE1BQUksRUFBRSxFQUFFO0FBQ1IsUUFBTSxFQUFFLElBQUk7QUFDWixZQUFV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QUE7O0FBRUQsUUFBTyxTQUFTLENBQUM7Q0FDakIsQ0FBQSxDQUFFLEtBQUssQ0FBQyxDQUFDIiwiZmlsZSI6Ii9Vc2Vycy9uYXZlci8uYXRvbS9wYWNrYWdlcy9yZW1vdGUtZnRwL2xpYi9kaXJlY3RvcnkuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG5cdF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9LFxuXHRwYXRoID0gcmVxdWlyZSgncGF0aCcpLFxuXHRGaWxlID0gcmVxdWlyZSgnLi9maWxlJyksXG5cdE1vZGVsID0gcmVxdWlyZSgndGhlb3Jpc3QnKS5Nb2RlbDtcblxubW9kdWxlLmV4cG9ydHMgPSBEaXJlY3RvcnkgPSAoZnVuY3Rpb24gKHBhcmVudCkge1xuXHRfX2V4dGVuZHMoRGlyZWN0b3J5LCBwYXJlbnQpO1xuXG5cdERpcmVjdG9yeS5wcm9wZXJ0aWVzKHtcblx0XHRwYXJlbnQ6IG51bGwsXG5cdFx0bmFtZTogJycsXG5cdFx0cGF0aDogJycsXG5cdFx0Y2xpZW50OiBudWxsLFxuXHRcdGlzRXhwYW5kZWQ6IGZhbHNlLFxuXHRcdHN0YXR1czogMCxcblx0XHRmb2xkZXJzOiBbXSxcblx0XHRmaWxlczogW11cblx0fSk7XG5cblx0RGlyZWN0b3J5LnByb3RvdHlwZS5hY2Nlc3NvcignaXNSb290JywgZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzLnBhcmVudCA9PSBudWxsO1xuXHR9KVxuXG5cdERpcmVjdG9yeS5wcm90b3R5cGUuYWNjZXNzb3IoJ2xvY2FsJywgZnVuY3Rpb24gKCkge1xuXHRcdGlmICh0aGlzLnBhcmVudClcblx0XHRcdHJldHVybiBwYXRoLm5vcm1hbGl6ZShwYXRoLmpvaW4odGhpcy5wYXJlbnQubG9jYWwsIHRoaXMubmFtZSkpLnJlcGxhY2UoL1xcXFwvZywgJy8nKTtcblxuXHRcdHJldHVybiBhdG9tLnByb2plY3QuZ2V0UGF0aHMoKVswXTtcblx0XHQvL3JldHVybiBhdG9tLnByb2plY3QucGF0aDtcblx0XHQvL3JldHVybiBhdG9tLnByb2plY3QucmVzb2x2ZSgnLycgKyB0aGlzLm5hbWUpO1xuXHR9KTtcblxuXHREaXJlY3RvcnkucHJvdG90eXBlLmFjY2Vzc29yKCdyZW1vdGUnLCBmdW5jdGlvbiAoKSB7XG5cdFx0aWYgKHRoaXMucGFyZW50KVxuXHRcdFx0cmV0dXJuIHBhdGgubm9ybWFsaXplKHBhdGguam9pbih0aGlzLnBhcmVudC5yZW1vdGUsIHRoaXMubmFtZSkpLnJlcGxhY2UoL1xcXFwvZywgJy8nKTtcblx0XHRyZXR1cm4gdGhpcy5wYXRoO1xuXHR9KTtcblxuXHREaXJlY3RvcnkucHJvdG90eXBlLmFjY2Vzc29yKCdyb290JywgZnVuY3Rpb24gKCkge1xuXHRcdGlmICh0aGlzLnBhcmVudClcblx0XHRcdHJldHVybiB0aGlzLnBhcmVudC5yb290O1xuXHRcdHJldHVybiB0aGlzO1xuXHR9KTtcblxuXHRmdW5jdGlvbiBEaXJlY3RvcnkgKCkge1xuXHRcdERpcmVjdG9yeS5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcblx0fVxuXG5cdERpcmVjdG9yeS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuZm9sZGVycy5mb3JFYWNoKGZ1bmN0aW9uIChmb2xkZXIpIHtcblx0XHRcdGZvbGRlci5kZXN0cm95KCk7XG5cdFx0fSk7XG5cdFx0dGhpcy5mb2xkZXJzID0gW107XG5cblx0XHR0aGlzLmZpbGVzLmZvckVhY2goZnVuY3Rpb24gKGZpbGUpIHtcblx0XHRcdGZpbGUuZGVzdHJveSgpO1xuXHRcdH0pO1xuXHRcdHRoaXMuZmlsZXMgPSBbXTtcblxuXHRcdGlmICghdGhpcy5pc1Jvb3QpXG5cdFx0XHREaXJlY3RvcnkuX19zdXBlcl9fLmRlc3Ryb3kuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcblx0fVxuXG5cdERpcmVjdG9yeS5wcm90b3R5cGUuc29ydCA9IGZ1bmN0aW9uICgpIHtcblxuXHRcdHRoaXMuZm9sZGVycy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG5cdFx0XHRpZiAoYS5uYW1lID09IGIubmFtZSlcblx0XHRcdFx0cmV0dXJuIDA7XG5cdFx0XHRyZXR1cm4gYS5uYW1lID4gYi5uYW1lID8gMSA6IC0xO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5maWxlcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG5cdFx0XHRpZiAoYS5uYW1lID09IGIubmFtZSlcblx0XHRcdFx0cmV0dXJuIDA7XG5cdFx0XHRyZXR1cm4gYS5uYW1lID4gYi5uYW1lID8gMSA6IC0xO1xuXHRcdH0pO1xuXG5cdH1cblxuXHREaXJlY3RvcnkucHJvdG90eXBlLmV4aXN0cyA9IGZ1bmN0aW9uIChuYW1lLCBpc2Rpcikge1xuXHRcdGlmIChpc2Rpcikge1xuXHRcdFx0Zm9yICh2YXIgYSA9IDAsIGIgPSB0aGlzLmZvbGRlcnMubGVuZ3RoOyBhIDwgYjsgKythKVxuXHRcdFx0XHRpZiAodGhpcy5mb2xkZXJzW2FdLm5hbWUgPT0gbmFtZSlcblx0XHRcdFx0XHRyZXR1cm4gYTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Zm9yICh2YXIgYSA9IDAsIGIgPSB0aGlzLmZpbGVzLmxlbmd0aDsgYSA8IGI7ICsrYSlcblx0XHRcdFx0aWYgKHRoaXMuZmlsZXNbYV0ubmFtZSA9PSBuYW1lKVxuXHRcdFx0XHRcdHJldHVybiBhO1xuXHRcdH1cblx0XHRyZXR1cm4gbnVsbDtcblx0fVxuXG5cdERpcmVjdG9yeS5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uIChyZWN1cnNpdmUsIGNvbXBsZXRlKSB7XG5cdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0Y2xpZW50ID0gc2VsZi5yb290LmNsaWVudDtcblxuXHRcdGNsaWVudC5saXN0KHNlbGYucmVtb3RlLCBmYWxzZSwgZnVuY3Rpb24gKGVyciwgbGlzdCkge1xuXHRcdFx0aWYgKGVycilcblx0XHRcdFx0cmV0dXJuO1xuXG5cdFx0XHRzZWxmLnN0YXR1cyA9IDE7XG5cblx0XHRcdHZhciBmb2xkZXJzID0gW10sXG5cdFx0XHRcdGZpbGVzID0gW107XG5cblx0XHRcdGxpc3QuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuXHRcdFx0XHR2YXIgaW5kZXgsXG5cdFx0XHRcdFx0bmFtZSA9IHBhdGguYmFzZW5hbWUoaXRlbS5uYW1lKSxcblx0XHRcdFx0XHRlbnRyeTtcblx0XHRcdFx0aWYgKGl0ZW0udHlwZSA9PSAnZCcgfHwgaXRlbS50eXBlID09ICdsJykge1xuXHRcdFx0XHRcdGlmIChuYW1lID09ICcuJyB8fCBuYW1lID09ICcuLicpXG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0aWYgKChpbmRleCA9IHNlbGYuZXhpc3RzKG5hbWUsIHRydWUpKSA9PT0gbnVsbCkge1xuXHRcdFx0XHRcdFx0ZW50cnkgPSBuZXcgRGlyZWN0b3J5KHtcblx0XHRcdFx0XHRcdFx0cGFyZW50OiBzZWxmLFxuXHRcdFx0XHRcdFx0XHRuYW1lOiBuYW1lXG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0ZW50cnkgPSBzZWxmLmZvbGRlcnNbaW5kZXhdO1xuXHRcdFx0XHRcdFx0c2VsZi5mb2xkZXJzLnNwbGljZShpbmRleCwgMSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGZvbGRlcnMucHVzaChlbnRyeSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0aWYgKChpbmRleCA9IHNlbGYuZXhpc3RzKG5hbWUsIGZhbHNlKSkgPT09IG51bGwpIHtcblx0XHRcdFx0XHRcdGVudHJ5ID0gbmV3IEZpbGUoe1xuXHRcdFx0XHRcdFx0XHRwYXJlbnQ6IHNlbGYsXG5cdFx0XHRcdFx0XHRcdG5hbWU6IG5hbWVcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRlbnRyeSA9IHNlbGYuZmlsZXNbaW5kZXhdO1xuXHRcdFx0XHRcdFx0c2VsZi5maWxlcy5zcGxpY2UoaW5kZXgsIDEpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRlbnRyeS5zaXplID0gaXRlbS5zaXplO1xuXHRcdFx0XHRcdGVudHJ5LmRhdGUgPSBpdGVtLmRhdGU7XG5cdFx0XHRcdFx0ZmlsZXMucHVzaChlbnRyeSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHRzZWxmLmZvbGRlcnMuZm9yRWFjaChmdW5jdGlvbiAoZm9sZGVyKSB7IGZvbGRlci5kZXN0cm95KCk7IH0pO1xuXHRcdFx0c2VsZi5mb2xkZXJzID0gZm9sZGVycztcblxuXHRcdFx0c2VsZi5maWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChmaWxlKSB7IGZpbGUuZGVzdHJveSgpOyB9KTtcblx0XHRcdHNlbGYuZmlsZXMgPSBmaWxlcztcblxuXHRcdFx0aWYgKHJlY3Vyc2l2ZSkge1xuXHRcdFx0XHRzZWxmLmZvbGRlcnMuZm9yRWFjaChmdW5jdGlvbiAoZm9sZGVyKSB7XG5cdFx0XHRcdFx0aWYgKGZvbGRlci5zdGF0dXMgPT0gMClcblx0XHRcdFx0XHRcdHJldHVybjtcblxuXHRcdFx0XHRcdGZvbGRlci5vcGVuKHRydWUpO1xuXHRcdFx0XHR9KVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mKGNvbXBsZXRlKSA9PT0gXCJmdW5jdGlvblwiKVxuXHRcdFx0e1xuXHRcdFx0XHRjb21wbGV0ZS5jYWxsKG51bGwpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0RGlyZWN0b3J5LnByb3RvdHlwZS5vcGVuUGF0aCA9IGZ1bmN0aW9uIChwYXRoKSB7XG5cblx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRjbGllbnQgPSBzZWxmLnJvb3QuY2xpZW50O1xuXG5cdFx0dmFyIHJlbWFpbmluZ1BhdGggPSBwYXRoLnJlcGxhY2Uoc2VsZi5yZW1vdGUsIFwiXCIpO1xuXHRcdGlmIChyZW1haW5pbmdQYXRoLnN0YXJ0c1dpdGgoXCIvXCIpKVxuXHRcdFx0cmVtYWluaW5nUGF0aCA9IHJlbWFpbmluZ1BhdGguc3Vic3RyKDEpO1xuXG5cdFx0aWYgKHJlbWFpbmluZ1BhdGgubGVuZ3RoID4gMClcblx0XHR7XG5cdFx0XHR2YXIgcmVtYWluaW5nUGF0aFNwbGl0ID0gcmVtYWluaW5nUGF0aC5zcGxpdChcIi9cIik7XG5cblx0XHRcdGlmIChyZW1haW5pbmdQYXRoU3BsaXQubGVuZ3RoID4gMCAmJiBzZWxmLmZvbGRlcnMubGVuZ3RoID4gMClcblx0XHRcdHtcblx0XHRcdFx0dmFyIG5leHRQYXRoID0gc2VsZi5yZW1vdGU7XG5cblx0XHRcdFx0aWYgKCFuZXh0UGF0aC5lbmRzV2l0aChcIi9cIikpXG5cdFx0XHRcdFx0bmV4dFBhdGggKz0gXCIvXCI7XG5cblx0XHRcdFx0bmV4dFBhdGggKz0gcmVtYWluaW5nUGF0aFNwbGl0WzBdO1xuXG5cdFx0XHRcdHNlbGYuZm9sZGVycy5mb3JFYWNoKGZ1bmN0aW9uIChmb2xkZXIpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRpZiAoZm9sZGVyLnJlbW90ZSA9PT0gbmV4dFBhdGgpXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0Zm9sZGVyLmlzRXhwYW5kZWQgPSB0cnVlO1xuXG5cdFx0XHRcdFx0XHRpZiAoZm9sZGVyLmZvbGRlcnMubGVuZ3RoID4gMClcblx0XHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdFx0Zm9sZGVyLm9wZW5QYXRoKHBhdGgpXG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRlbHNlXG5cdFx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRcdGZvbGRlci5vcGVuKGZhbHNlLCBmdW5jdGlvbigpXG5cdFx0XHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdFx0XHRmb2xkZXIub3BlblBhdGgocGF0aClcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pXG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIERpcmVjdG9yeTtcbn0pKE1vZGVsKTtcbiJdfQ==